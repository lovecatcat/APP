<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<link href="css/form.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
	</head>
	
	<body class="BL-bg-f2f">
		<header id="Js-header" class="BL-bg-fff">
			<div class="BL-mod-headbar BL-mod-headbar-pos">
				<a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
				<h1 class="BL-title">选择车险</h1>
			</div>
		</header>
		<div id="Js-content" class="mui-content BL-rel BL-overFlow-autoY">
			<ul class="mui-table-view form-list-cell">
				<li class="fItem BL-ub BL-ub-f1">
					<label class="form-list-label BL-ub-f1">
						商业险
					</label>
					<div class="form-list-control" @click="openBusiness">
						<span class="form-float-right" :class="{'BL-col-3b9cf5': insList.commercial}">{{ insList.commercial? '投保': '不投保' }}</span>
					</div>
					<div class="form-list-icon">
						<div class="mui-icon mui-icon-arrowright"></div>
					</div>
				</li>
				<template v-show="insList.commercial && biCoverageList">
					<li class="fItem BL-ub BL-ub-f1" v-for="item in biCoverageList">
						<label class="form-list-label BL-ub BL-ub-ver BL-ub-f1 BL-col-999">{{item.coverageName}}</label>
						<div class="form-list-control BL-txt-r">
							<span v-if="item.insuredAmount == 'Y'&& item.coverageCode !='F'">投保</span>
							<span v-if="item.coverageCode =='F'">{{item.flag==1?'国产':'进口'}}玻璃</span>
							<span v-else-if="item.coverageCode =='Z2'">{{item.flag.split(',')[0]+'天，'+item.flag.split(',')[1]+'元'}}</span>
							<span v-if="item.insuredAmount != 'Y'"> {{item.insuredAmount / 10000}} 万</span>
						</div>
					</li>
				</template>
			</ul>
			<ul class="mui-table-view form-list-cell">
				<li class="fItem BL-ub BL-ub-f1">
					<div class="form-list-label">
						交强险+车船税交强险
					</div>
					<div class="form-list-control">
						<div class="input-switch">
							<input type="checkbox" class="switch" v-model="insList.forcepremium"/>
							<label></label>
						</div>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1" v-if="insList.forcepremium">
					<label class="form-list-label">交强险起保日期</label>
					<div class="form-list-control">
						<input type="text" class="date" data-options='{"type":"date"}' v-model="insList.ciBeginDate" placeholder="请选择" readonly>
					</div>
					<div class="form-list-icon">
						<div class="mui-icon mui-icon-arrowright"></div>
					</div>
				</li>
			</ul>
			<div class="form-button-group">
				<a type="button" class="form-btn" id="next">下一步</a>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script src="js/mui.picker.js"></script>
	<script src="js/mui.dtpicker.js"></script>
	<script src="js/vue.min.js"></script>
	<script src="js/Date.js"></script>
	<script src="js/auto2.js"></script>
	<script type="text/javascript">
		mui.init();
		var auto = new Vue({
			el: "#Js-content",
			data: {
                biCoverageList: [],  // 商业险种信息
				ciCoverageList: ciCoverageList,  // 交强险种信息
				insList: {
                    commercial: false,
                    forcepremium: true,
                    biBeginDate: new Date().addDays(1).Format('yyyy-MM-dd'),   // 商业险起期
                    ciBeginDate: new Date().addDays(1).Format('yyyy-MM-dd'),
                    biCoverageList: [],  // 商业险种信息
                    ciCoverageList: ciCoverageList  // 交强险种信息
				}
			},
			methods: {
                openBusiness: function () {
                    //打开商业险窗口
                    mui.openWindow({
                        id: "auto2c_business",
                        url: "auto2c-business.html",
                        show: animateObj.aniDetal,
                        extras:{
                            commercial: this.insList.commercial,    // 商业险
                            biCoverageList: this.biCoverageList   // 已投保的险种信息
                        }
                    });
                }
			}
		})
		mui.plusReady(function() {
			statusbar();
			var winH = window.innerHeight;
			var titHeight = document.querySelector('#Js-header').offsetHeight;
			document.querySelector('#Js-content').style.height = (winH - titHeight) +'px';

			// 获取本地存储的险种信息
			var insList = JSON.parse(plus.storage.getItem('insList'))
			if (insList) {
			    auto.insList.commercial = insList.commercial
                auto.biCoverageList = insList.biCoverageList
                auto.insList.forcepremium = insList.forcepremium
                auto.ciCoverageList = insList.ciCoverageList
			}

            //日期选择
            mui('.date').each(function (i, d) {
                d.addEventListener('tap', function () {
                    document.activeElement.blur();
                    var optionsJson = this.getAttribute('data-options') || '{}';
                    var options = JSON.parse(optionsJson);
                    var picker = new mui.DtPicker(options);
                    picker.show(function (rs) {
						auto.ciBeginDate = rs.text;
                        picker.dispose();
                    });
                }, false);
            });

            // 下一步
            document.querySelector('#next').addEventListener('click', function () {
                if (!auto.insList.commercial && !auto.insList.forcepremium) {
                    mui.toast('请至少选择一个险种', {duration: 'long', type: 'div'});
                    return false
                }
                // 合并交强险和商业险
				if (auto.insList.forcepremium) {
                    auto.insList.biCoverageList = auto.biCoverageList
					auto.insList.ciCoverageList = ciCoverageList
				} else {
                    auto.insList.biCoverageList = auto.biCoverageList
                    auto.insList.ciCoverageList = []
				}
                plus.storage.setItem('insList',JSON.stringify(auto.insList));
                // 进入险种选择页面
                  mui.openWindow({
                      url: 'auto2c-quotes.html',
                      id: 'auto2c_quotes',
                      show: animateObj.aniDetal
                  });
            })
		})
        window.addEventListener('updatebiCoverageList', function (e) {
            auto.insList.commercial = e.detail.commercial
            auto.biCoverageList = e.detail.biCoverageList
        });
	</script>
</html>
