<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>车险付款</title>
    <link href="css/mui.css" rel="stylesheet"/>
    <link href="css/common.css" rel="stylesheet"/>
    <link href="css/module.css" rel="stylesheet"/>
    <script src="js/config.js" type="text/javascript"></script>
</head>

<body class="BL-bg-f2f">
<header id="Js-header" class="BL-bg-fff">
    <div class="BL-mod-headbar BL-mod-headbar-pos">
        <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
        <a id="Js-closePage" class="BL-ctrl-close">关闭</a>
        <h1 class="BL-title">车险付款</h1>
    </div>
</header>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    (function ($) {
        $.plusReady(function () {
            statusbar();
            var topHeight = document.getElementById('Js-header').offsetHeight / sizeObj.dpl;

            var payLink = plus.webview.currentWebview().payLink;
            console.log(payLink)
            var embed = plus.webview.create(payLink, '', {top: topHeight + 'px', bottom: '0px'});
            plus.webview.currentWebview().append(embed);

            // 自定义返回事件
            mui.oldBack = mui.back;
            mui.back = function () {
                embed.canBack(function (e) {
                    if (e.canBack) {
                        embed.back();
                    } else {
                        mui.oldBack();
                    }
                })
            };
//
//            document.querySelector('#Js-closePage').addEventListener('tap', function () {
//
//                luckyAjax({
//                    data: {
//                        data: JSON.stringify({
//                            msg: {policy_id: plus.webview.currentWebview().policy_id},
//                            company_code: 'PingAn',
//                            method: 'pay'
//                        }),
//                        server: 'PolicyIns.onlineInsured',
//                        device: 'mobile'
//                    },
//                    timeout: 10000,
//                    success: function (res) {
//                        plus.nativeUI.showWaiting();
//                        console.log(JSON.stringify(res))
//                        if (res.code) {
//                            console.log('支付成功')
//                            setTimeout(function () {
//                                plus.nativeUI.closeWaiting();
//                                mui.openWindow({
//                                    url: '../member-warranty-manage.html',
//                                    id: 'member_warranty_manage',
//                                    show: animateObj.aniDetal
//                                })
//                                plus.webview.close('member_life_order');
//                                setTimeout(function () {
//                                    plus.webview.close('pa_pay');
//                                    plus.webview.close('pa_toinsure');
//                                    plus.webview.close('pa_question');
//                                    plus.webview.close('pa_insurance-index');
//                                }, 500)
//                            }, 3000)
//                        } else {
//                            console.log('支付失败')
//                            setTimeout(function () {
//                                plus.nativeUI.closeWaiting();
//                                mui.openWindow({
//                                    url: '../member-life-order.html',
//                                    id: 'member_life_order',
//                                    show: animateObj.aniDetal
//                                })
//                                setTimeout(function () {
//                                    plus.webview.close('pa_pay');
//                                    plus.webview.close('pa_toinsure');
//                                    plus.webview.close('pa_question');
//                                    plus.webview.close('pa_insurance-index');
//                                }, 500)
//                            }, 3000)
//                        }
//                    }
//                })
//            }, false);
        });
    })(mui);
</script>

</html>