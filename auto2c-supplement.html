<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>补充信息</title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<link href="css/form.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
	</head>

	<body class="BL-bg-f2f">
		<header id="Js-header" class="BL-bg-fff">
			<div class="BL-mod-headbar BL-mod-headbar-pos">
				<a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
				<h1 class="BL-title">补充信息</h1>
			</div>
		</header>
		<div id="Js-content" class="mui-content BL-rel BL-overFlow-autoY">
			<div class="form-notice BL-pad-t-1">这不是我的车？<a>修改车牌号</a></div>
			<ul class="mui-table-view form-list-cell">
				<li class="fItem BL-ub BL-ub-f1">
					<label class="form-list-label">车架号</label>
					<div class="form-list-control">
						<input type="text" placeholder="请输入" v-model.lazy="frameNo">
					</div>
					<div class="form-list-icon" v-show="frameNo!=''">
						<span class="mui-icon mui-icon-clear" @click="frameNo=''"></span>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1">
					<label class="form-list-label">发动机号</label>
					<div class="form-list-control">
						<input type="text" placeholder="请输入" v-model.lazy="engineNo">
					</div>
					<div class="form-list-icon" v-show="engineNo!=''">
						<span class="mui-icon mui-icon-clear" @click="engineNo=''"></span>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1">
					<label class="form-list-label">初登日期</label>
					<div class="form-list-control">
						<input type="text" class="date" data-options='{"type":"date"}' v-model="registerDate" placeholder="请选择" readonly>
					</div>
					<div class="form-list-icon">
						<div class="mui-icon mui-icon-arrowright"></div>
					</div>
				</li>
			</ul>
			<ul class="mui-table-view form-list-cell">
				<li class="fItem BL-ub BL-ub-f1">
					<a class="BL-ub-f3 form-list-label" @click="openBrands">
						品牌型号
					</a>
					<div class="form-list-icon">
						<div class="mui-icon mui-icon-arrowright"></div>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1" v-if="modelName">
					<div class="BL-ub-f3 form-list-label BL-txt-r">
						{{ modelName }}
					</div>
				</li>
			</ul>
			<ul class="mui-table-view form-list-cell">
				<li class="fItem BL-ub BL-ub-f1">
					<div class="BL-ub-f3 form-list-label">
						是否过户车
					</div>
					<div class="form-list-control">
						<div class="input-switch">
							<input type="checkbox" class="switch" v-model="isTrans"/>
							<label></label>
						</div>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1" :class="{'BL-hide': !isTrans}">
					<label class="form-list-label">过户日期</label>
					<div class="form-list-control">
						<input type="text" class="date" data-options='{"type":"date"}' v-model="transDate" placeholder="请选择">
					</div>
					<div class="form-list-icon">
						<div class="mui-icon mui-icon-arrowright"></div>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1">
					<label class="form-list-label">核定载客数</label>
					<div class="form-list-control">
						<input type="number" placeholder="请输入" v-model.lazy="seatCount">
					</div>
					<div class="form-list-icon" v-show="seatCount!=''">
						<span class="mui-icon mui-icon-clear" @click="seatCount=''"></span>
					</div>
				</li>
				<li class="fItem BL-ub BL-ub-f1">
					<div class="BL-ub-f3 form-list-label">
						是否贷款车
					</div>
					<div class="form-list-control">
						<div class="input-switch">
							<input type="checkbox" class="switch" v-model="isLoanCar"/>
							<label></label>
						</div>
					</div>
				</li>
			</ul>
			<div class="form-button-group">
				<a type="button" class="form-btn" href="auto2c-choose.html" data-wid="auto2c_choose">下一步</a>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script src="js/mui.picker.js"></script>
	<script src="js/mui.dtpicker.js"></script>
	<script src="js/vue.min.js"></script>
	<!-- auto2.js 专用js-->
	<script src="js/auto2.js"></script>
	<script type="text/javascript">
		mui.init();
        var auto = new Vue({
            el: '#Js-content',
            data: {
                frameNo: "",  // 车架号
                engineNo: "",  // 发动机号
                registerDate: "",  // 初登日期
                transDate: "",  // 过户日期
                seatCount: "",   // 核定载客人
                isTrans: false,     // 是否过户车
                isLoanCar: false,    // 是否贷款车
                modelName: ''        // 品牌名称
			},
			watch: {
                frameNo: function (val) {
                    // 校验
					if (val.length !== 17) {
                        mui.toast('请输入17位正确的车架号', {duration: 'short', type: 'div'});
                        return
					}
					// 根据车架号查询车辆信息
//                  mui.toast('正在查询车辆信息', {duration: 'short', type: 'div'});
                    plus.nativeUI.showWaiting('正在查询车辆信息', {
                        style: 'white',
                        width: '140px'
                    })
                    luckyAjax({
                        data: {
                            server: 'carIns.vehicleInfoByFrameNo',
							view: true,
                            data: JSON.stringify({frameNo: this.frameNo})
                        },
                        success:function(data){
                            console.log(JSON.stringify(data))
                            if(data.code == 1){
                            	if(data.data == '') {
                            		plus.nativeUI.closeWaiting();
                            		mui.toast('没有找到车辆信息，请继续填写', {duration: 'long', type: 'div'});
                            	} else {
                            		// 根据车架号、车牌号、响应码查询车型信息

                            	}
                            } else {
                            	plus.nativeUI.closeWaiting();
                            	mui.toast(data.msg, {duration: 'long', type: 'div'});
                            }
                        }
                    });
                }
			},
			methods: {
                openBrands: function () {
                    //打开新窗口
                    mui.openWindow({
                        id: "auto2c_brand",
                        url: "auto2c-brand.html",
                        show: animateObj.aniDetal,
                    });
                },
				checkForm: function () {
                }
			}
        })
		mui.plusReady(function() {
			statusbar();
			var winH = window.innerHeight;
			var titHeight = document.querySelector('#Js-header').offsetHeight;
			document.querySelector('#Js-content').style.height = winH - titHeight + 'px';

            //日期选择
            mui('.date').each(function (i, d) {
                d.addEventListener('tap', function () {
                    document.activeElement.blur();
                    var optionsJson = this.getAttribute('data-options') || '{}';
                    var options = JSON.parse(optionsJson);
                    var picker = new mui.DtPicker(options);
                    picker.show(function (rs) {
                        if (i === 0) {
                            auto.registerDate = rs.text;
                        } else if (i === 1) {
                            auto.transDate = rs.text;
                        }
                        picker.dispose();
                    });
                }, false);
            });
		})
        window.addEventListener('selectBrand', function (e) {
            var brand = e.detail.brand
			auto.seatCount = brand.seat
            auto.modelName = ([brand.brandName,brand.vehicleFgwName,brand.parentVehName].join(' ')).trim() //品牌名称
        });
	</script>
</html>
