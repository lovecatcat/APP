<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
</head>

<body>

<div id="Js-content" class="mui-content BL-rel">
    <!--弹窗 begin-->
    <div class="ins-dialog lg">
        <div class="dialog-header">
            <div class="mui-icon mui-icon-closeempty" id="close-ins-pop"></div>
            <p class="ins-font-md box-f-1">险种信息</p>
            <div class="header-btn-save">
                <button class="ins-btn sm-btn blue" id="saveGoods">保存</button>
            </div>
        </div>
        <div class="form-content margin-t-5_125 BL-pad-b-2" v-cloak>
            <div class="input-item BL-bg-fff">
                <div class="ins-lh-alone">总保费(元)</div>
                <div class="BL-ub BL-ub-pj BL-ub-f1">
                    <div class="input-wrap BL-ub-f1"></div>
                    <div class="ins-lh-alone BL-col-ff8201">{{totalFee}}</div>
                </div>
            </div>
            <div class="form-wrap">
                <div class="input-item">
                    <label class="">险种</label>
                    <div class="input-wrap box-f-1">
                        <div class="input" id="goods_type" @click="showType">
                            {{insurance.name}}
                        </div>
                        <div class="ins-down-icon"></div>
                    </div>
                </div>
            </div>
            <div class="BL-bg-fff BL-pad-b-1" v-show="insurance.safe_id">
                <div class="input-item ins-pd-r-0" style="margin-top: 0;" v-if="pay_year" v-cloak>
                    <label class="">交费期间</label>
                    <div class="input-wrap box-f-1 multi-btn">
                        <button class="ins-btn xs-btn" :class="{'blue':item.pay_year===insurance.pay_year}"
                                :disabled="item.pay_year===insurance.pay_year"
                                v-for="(item,index) in pay_year" @tap="insurance.pay_year=item.pay_year,resetMoney(),toblur()">
                            {{item.pay_year | payYearFilter}}
                        </button>
                    </div>
                </div>
                <div class="input-item ins-pd-r-0" v-if="safe_year" v-cloak>
                    <label class="">保险期间</label>
                    <div class="input-wrap box-f-1 multi-btn">
                        <button class="ins-btn xs-btn" :class="{'blue':item.year===insurance.safe_year}"
                                :disabled="item.year===insurance.safe_year"
                                v-for="(item,index) in safe_year"
                                @tap="insurance.safe_year=item.year,resetMoney(),toblur()">
                            {{item.year | safeYearFilter}}
                        </button>
                    </div>
                </div>
                <!--恒久健康-->
                <template v-if="insurance.code==hjjk">
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="insurance.money" @change="resetMoney()">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy=" insurance.period_money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--千万护航-->
                <template v-else-if="insurance.code==qwhh">
                    <div class="input-item ins-pd-r-0">
                        <label class="">基本保额(元)</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn" :class="{'blue':index===insurance.money}"
                                    :disabled="index===insurance.money"
                                    v-for="(item,index) in money_arr" @tap="insurance.money=index,resetMoney(),toblur()">
                                {{item}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy=" insurance.period_money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--福享金生-->
                <template v-else-if="insurance.code==fxjs">
                    <div class="input-item ins-pd-r-0">
                        <label class="">年金保障年限</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn blue" disabled >20年</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0" v-if="init&&init.nj_get_type">
                        <label class="">生存金领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn" :class="{'blue':item.value===insurance.shareDrawType}"
                                    v-for="(item,index) in init.nj_get_type"
                                    v-if="item.value!==zrwnzh"
                                    :disabled="item.value===insurance.shareDrawType"
                                    @tap="insurance.shareDrawType=item.value,toblur()">
                                {{item.text}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="insurance.period_money" @change="resetMoney()">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy=" insurance.money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--万年红-->
                <template v-else-if="insurance.code==wnh">
                    <div class="input-item ins-pd-r-0" v-if="init&&init.nj_get_way">
                        <label class="">年金领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn" :class="{'blue':item.value===insurance.draw_freq}"
                                    v-for="(item,index) in init.nj_get_way"
                                    :disabled="item.value===insurance.draw_freq"
                                    @tap="insurance.draw_freq=item.value,toblur()">
                                {{item.text}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0" v-if="addonsSelected[cjb]">
                        <label class="">分红领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn blue" disabled>转入万能账户</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="insurance.period_money"
                                   @change="resetMoney()">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy=" insurance.money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--万年福-->
                <template v-else-if="insurance.code==wnf">
                    <div class="input-item ins-pd-r-0">
                        <label class="">年金保障年限</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn blue" disabled >20年</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0" v-if="init&&init.nj_get_way">
                        <label class="">年金领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn" :class="{'blue':item.value===insurance.draw_freq}"
                                    v-for="(item,index) in init.nj_get_way"
                                    :disabled="item.value===insurance.draw_freq"
                                    @tap="insurance.draw_freq=item.value,toblur()">
                                {{item.text}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0" v-if="addonsSelected[cjb]">
                        <label class="">生存金领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn blue" disabled>转入万能账户</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="insurance.period_money"
                                   @change="resetMoney()">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy="insurance.money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--万年青-->
                <template v-else>
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="insurance.money"
                                   @change="resetMoney()">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201" v-model.number.lazy="insurance.period_money"
                                       readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney()">点击计算</div>
                        </div>
                    </div>
                </template>
                <div class="input-item box-f-1">
                    <div class="box-f-3 ins-font-sm">是否自动垫交保费</div>
                    <div class="input-switch">
                        <input type="checkbox" class="switch" v-model="insurance.autoApl"/>
                        <label></label>
                    </div>
                </div>
            </div>

            <div class="form-wrap margin-t_875" v-show="hasAddons" v-for="(item,index) in Addons"
                 v-if="addonIns[index]">
                <div class="input-item box-f-1">
                    <div class="box-f-3 ins-font-sm">{{item.name}}</div>
                    <div class="form-switch-note">投保</div>
                    <div class="input-switch">
                        <input type="checkbox" class="switch" v-model="addonsSelected[index]" @change="chAddon"/>
                        <label></label>
                    </div>
                </div>
                <!--附加投保人豁免2017-->
                <div class="mui-row form-bgc-eee BL-pad-a1" v-if="index==tbrhm" v-show="addonsSelected[index] === true">
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            保险金额(元)&nbsp;<span class="BL-col-ff8201">{{addonIns[index].money}}</span>
                        </li>
                    </div>
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            保障期间(年)&nbsp;<span class="BL-col-ff8201">终身</span>
                        </li>
                    </div>
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            交费期间(年)&nbsp;<span class="BL-col-ff8201">{{addonIns[index].pay_year | payYearFilter}}</span>
                        </li>
                    </div>
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            年缴保费(元)&nbsp;<span class="BL-col-ff8201">{{addonIns[index].period_money}}</span>
                        </li>
                    </div>
                </div>
                <!--传家宝-->
                <div class="mui-row form-bgc-eee BL-pad-a1" v-if="index==cjb" v-show="addonsSelected[index] === true">
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            交费期间(年)&nbsp;<span class="BL-col-ff8201">趸交</span>
                        </li>
                    </div>
                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            保障期间(年)&nbsp;<span class="BL-col-ff8201">终身</span>
                        </li>
                    </div>

                    <div class="mui-col-sm-6">
                        <li class="ins-font-xs">
                            保费(元)&nbsp;<span class="BL-col-ff8201">100</span>
                        </li>
                    </div>
                </div>
                <!--附加尊享安康-->
                <template v-if="index==zxak && addonsSelected[index] === true">
                    <div class="input-item ins-pd-r-0">
                        <label class="">交费期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>趸交</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>1年</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险金额</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn" :class="{'blue':addonIns[index].money==ind}"
                                    :disabled="addonIns[index].money==ind"
                                    @tap="changeAddon(index,ind),toblur()" v-for="(ite,ind) in zxmoney_arr">{{ite}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201"
                                       v-model.number.lazy="addonIns[index].period_money" readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney(index)">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--附加恒顺意外-->
                <template v-if="index==hs && addonsSelected[index] === true">
                    <div class="input-item ins-pd-r-0">
                        <label class="">交费期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>趸交</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>1年</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">基本保额(元)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="addonIns[index].money"
                                   @change="addonIns[index].period_money=''">
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201"
                                       v-model.number.lazy="addonIns[index].period_money" readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney(index)">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--附加恒久安心-->
                <template v-if="index==hjax && addonsSelected[index] === true">
                    <div class="input-item ins-pd-r-0">
                        <label class="">交费期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>趸交</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>1年</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险金额(元)</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn" :class="{'blue':addonIns[index].money==ind}"
                                    :disabled="addonIns[index].money==ind"
                                    @tap="changeAddon(index,ind),toblur()" v-for="(ite,ind) in axmoney_arr">{{ite}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201"
                                       v-model.number.lazy="addonIns[index].period_money" readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney(index)">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--附加养老年金-->
                <template v-if="index==ylnj && addonsSelected[index] === true">
                    <div class="input-item ins-pd-r-0">
                        <label class="">交费期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>{{insurance.pay_year | payYearFilter}}</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险金额(元)</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>{{insurance.period_money}}</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">年金领取方式</label>
                        <div class="input-wrap box-f-1 multi-btn">
                            <button class="ins-btn xs-btn blue" disabled>年领</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">年金领取年龄</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn" :class="{'blue':addonIns[index].draw_age==ind}"
                                    :disabled="addonIns[index].draw_age==ind"
                                    @tap="changeAddon(index,ind),toblur()" v-for="(ite,ind) in njage_arr">{{ite}}
                            </button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0" v-if="addonIns[index].draw_age">
                        <label class="">保险期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>{{addonIns[index].draw_age==70?'至74周岁':'至84周岁'}}</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201"
                                       v-model.number.lazy="addonIns[index].period_money" readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney(index)">点击计算</div>
                        </div>
                    </div>
                </template>
                <!--附加恒祥住院-->
                <template v-if="index==hx && addonsSelected[index] === true">
                    <div class="input-item ins-pd-r-0">
                        <label class="">交费期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>趸交</button>
                        </div>
                    </div>
                    <div class="input-item ins-pd-r-0">
                        <label class="">保险期间</label>
                        <div class="input-wrap box-f-1">
                            <button class="ins-btn xs-btn blue" disabled>1年</button>
                        </div>
                    </div>
                    <div class="input-item">
                        <label class="">保额(元/天)</label>
                        <div class="input-wrap box-f-1">
                            <input type="number" placeholder="请输入" v-model.number.lazy="addonIns[index].money"
                                   @change="addonIns[index].period_money=''">
                        </div>
                    </div>
                    <div class="input-item ins-font-xs BL-col-999">保额范围是<span class="BL-col-ff8201">50~{{assu_age > 17 ? '200' : '100'}}</span>（元/天）
                    </div>
                    <div class="input-item">
                        <label class="">年缴保费(元)</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" class="BL-col-ff8201"
                                       v-model.number.lazy="addonIns[index].period_money" readonly>
                            </div>
                            <div class="right-btn orange" @click="calMoney(index)">点击计算</div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>
</div>
<!--弹窗 end-->

</div>
</body>
<script src="../js/mui.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script src="../js/mui.picker.js"></script>
<script src="../js/mui.poppicker.js"></script>
<script src="../js/IDValidator.min.js"></script>
<script src="method.js"></script>
<script type="text/javascript">
    mui.init();
    var safegoods = new mui.PopPicker();

    var safe = new Vue({
        el: '#Js-content',
        data: function() {
            return {
                assu_age: '',
                assu_sex: '',
                appl_age: '',
                assured: {},
                applicant: {},
                init: {}, //初始化数据
                safegoods: null, //所有产品
                money_arr: { //千万护航保额选项
                    '50000': '5万',
                    '100000': '10万',
                    '150000': '15万',
                    '200000': '20万'
                },
                zxmoney_arr: { //尊享安康保额选项
                    '500000': '50万',
                    '1000000': '100万',
                    '1500000': '150万'
                },
                axmoney_arr: { //恒久安心保额选项
                    '5000': '5000',
                    '10000': '10000'
                },
                njage_arr: { //附加养老年金（年金领取年龄）
                    '70': '70周岁',
                    '80': '80周岁'
                },
                totalFee: 0,
                insurances: [], //保存的险种
                Addons: {}, //所有附加险
                hasAddons: false, //是否有附加险
                noSamePerson: true, //被保人非本人
                addonsSelected: {}, //附加险投保状态
                showAddonIns: {}, // 可投附加险
                addonIns: {},//附加险信息
                userinfo: {}, //用户信息
                pay_year: {}, //交费期间下拉数据
                safe_year: {},//保险期间下拉数据
                main_insurance: {},//主险信息
                insurance: { // 主险投保信息
                    is_main: 1,
                    name: '请选择',//主险名称
                    safe_id: '',//险种id
                    code: '', //险种代码
                    safe_year: '',
                    pay_year: '',
                    money: '', // 基本保险金额
                    period_money: '', // 年交保费
                    guarantee_term: '',//年金保障年限  20
                    draw_freq: '',//年金领取方式 年领 月领
                    draw_age: '',//年金领取年龄
                    shareDrawType: '',//生存金领取方式 累计生息 转入万能账户 现金领取
                    autoApl: false //是否自动垫交
                }
            }
        },
        //过滤器
        filters: {
            //保障期间
            safeYearFilter: function (value) {
                if (value > 50 && value !== '999' && value !== 999) {
                    return '至' + value + '岁';
                } else if (value < 50 && value > 0) {
                    return value + '年';
                } else {
                    return '终身';
                }
            },
            //交费期间
            payYearFilter: function (value) {
                if (value === 1) {
                    return '趸交';
                } else if (value < 60) {
                    return value + '年交';
                } else {
                    return '至' + value + '岁';
                }
            },
            IntFilter: function (value) {
                return parseInt(value)
            }
        },
        methods: {
            toblur:function(){
                document.activeElement.blur();
            },
            changeAddon: function (index, val) {
                if (index == ylnj) {
                    this.addonIns[index].draw_age = val
                    this.addonIns[index].safe_year = Number(val) + 4
                } else {
                    this.addonIns[index].money = val
                }
                this.addonIns[index].period_money = ''
                this.$forceUpdate()
            },
            // 重置主险信息
            resetMainIns: function () {
                this.insurance = {
                    is_main: 1,
                    safe_id: '',//险种id
                    code: '', //险种代码
                    safe_year: '',
                    pay_year: '',
                    money: '', // 基本保险金额
                    period_money: '', // 年交保费
                    guarantee_term: '',//年金保障年限
                    draw_freq: '',//年金领取方式
                    draw_age: '',//年金领取年龄
                    shareDrawType: '',//生存金领取方式
                    autoApl: false //是否自动垫交
                }
            },
            insChanged:function(init) {
                console.log('insChanged')
                const vm = this

                var safecode = vm.insurance.code
                //
                //保险期间
                var mainSyAttr = unique(vm.main_insurance.ratio, 'safe_year') // 去重
                // 排序
                mainSyAttr = mainSyAttr.sort(function (a, b) {
                    return a.safe_year - b.safe_year
                });

                //长度为1直接赋值，不为1置为空
                if (mainSyAttr.length === 1) {
                    vm.insurance.safe_year = mainSyAttr[0].year
                } else {
                    vm.insurance.safe_year = init ? vm.insurance.safe_year : ''
                }
                vm.safe_year = mainSyAttr;

                //交费期间
                var mainPyAttr = unique(vm.main_insurance.ratio, 'pay_year'); // 去重
                // 排序
                mainPyAttr = mainPyAttr.sort(function (a, b) {
                    return a.pay_year - b.pay_year;
                });
                if (mainPyAttr.length === 1) {
                    vm.insurance.pay_year = mainPyAttr[0].pay_year;
                } else {
                    vm.insurance.pay_year = init ? vm.insurance.pay_year : '';
                }
                vm.pay_year = mainPyAttr;
                //对应的附加险
                var child = vm.main_insurance.child
                var obj = {}
                for (var i in child) {
                    obj[child[i]['code']] = child[i]
                }
                vm.Addons = obj
                //
                if (init && vm.insurances.length > 0) {
                    console.log('初始化险种')
                    var insurance = vm.insurances[0]
                    console.log(JSON.stringify(vm.insurance))
                    if (safecode === insurance.code) {
                        vm.$nextTick(function(){
                            if (vm.insurances.length === 1) {
                                vm.calMoney()
                            }
                            vm.resetAddons(init)
                        })
                        return
                    }
                } else {
                    // 清除附加险
                    vm.resetMoney()
                }
            },
            //计算标保
            bbcal: function (pay_year, money) {
                if (Number(pay_year) < 10) {
                    return Number(pay_year) * Number(money) / 10
                } else {
                    return money
                }
            },
            //主险change
            showType: function () {
                var vm = this
                safegoods.show(function (items) {
                    vm.resetMainIns(); //重置主险信息
                    vm.insurance.safe_id = items[0].value;
                    vm.insurance.code = items[0].code;
                    vm.insurance.name = items[0].text;
                    vm.main_insurance = items[0];
                    vm.insChanged();
                });
            },
            resetAddons: function (init) {
                console.log('resetAddons' + init)
                var vm = this
                var safe_id = vm.insurance.code
                var money = vm.insurance.money
                var pay_year = vm.insurance.pay_year
                var period_money = vm.insurance.period_money
//                console.log('重置对应附加险' + safe_id + safe_year + pay_year + money + period_money);
                for (var a in vm.addonsSelected) {
                    vm.addonsSelected[a] = false
                }
                var tempdata = {}
                switch (safe_id) {
                    case hjjk: //恒久健康
                        tempdata[tbrhm] = vm.noSamePerson //投保人豁免
                        tempdata[zxak] = money >= 200000 || period_money > 3000//尊享安康
                        tempdata[hs] = money >= 200000 //恒顺意外
                        tempdata[hx] = money >= 200000 //恒祥住院
                        tempdata[hjax] = money >= 50000 && period_money >= 3000 //恒久安心
                        tempdata[ylnj] = true //养老年金
                        vm.showAddonIns = tempdata
                        break
                    case qwhh: // 千万护航
                        tempdata[tbrhm] = false, //投保人豁免
                        tempdata[zxak] = money >= 100000 //尊享安康
                        tempdata[hs] = money >= 200000 //恒顺意外
                        tempdata[hx] = money >= 200000 //恒祥住院
                        tempdata[hjax] = money >= 200000 //恒久安心
                        vm.showAddonIns = tempdata
                        break
                    case wnq: //万年青终身重大疾病保险
                        tempdata[tbrhm] = pay_year !== 30 && vm.noSamePerson //投保人豁免 30年缴不可附加
                        tempdata[zxak] = money >= 50000 && period_money >= 3000 //尊享安康
                        tempdata[hs] = true //恒顺意外
                        tempdata[hx] = true //恒祥住院
                        tempdata[hjax] = money >= 50000 && period_money >= 3000 //恒久安心
                        tempdata[ylnj] = true //养老年金
                        vm.showAddonIns = tempdata
                        break
                    case fxjs: //福享金生终身年金保险
                        tempdata[tbrhm] = pay_year > 5 && vm.noSamePerson //投保人豁免
                        tempdata[zxak] = period_money >= 10000 //尊享安康
                        tempdata[hs] = true //恒顺意外
                        tempdata[hx] = true //恒祥住院
                        tempdata[hjax] = period_money >= 5000 //恒久安心
                        vm.showAddonIns = tempdata
                        break
                    case wnh: //万年红终身年金保险
                        tempdata[cjb] = true //传家宝
                        tempdata[zxak] = period_money >= 10000 //尊享安康
                        tempdata[hs] = true //恒顺意外
                        tempdata[hx] = true //恒祥住院
                        tempdata[hjax] = period_money >= 5000 //恒久安心
                        vm.showAddonIns = tempdata
                        break
                    case wnf: //万年福年金保险
                        tempdata[cjb] = true //传家宝
                        tempdata[zxak] = period_money >= 10000 //尊享安康
                        tempdata[hs] = true //恒顺意外
                        tempdata[hx] = true //恒祥住院
                        tempdata[hjax] = period_money >= 5000 //恒久安心
                        vm.showAddonIns = tempdata
                        break
                }
                vm.$nextTick(function () {
                    return vm.setAddonsShow(init)
                });
            },
            setAddonsShow: function (init) {
                console.log('setAddonsShow')
                var vm = this
                var hasAddons = false
                for (var i in vm.showAddonIns) {
//                    console.log(i)
                    if (vm.showAddonIns[i] === true) {
//                        console.log('true')
                        hasAddons = true
                        if (vm.Addons[i]) {
                            vm.setAddons(i, init)
                        }
                    }
                }

                vm.hasAddons = hasAddons
                vm.$forceUpdate();
            },
            setAddons: function (i, init) {
                console.log('setAddons' + i + 'init:' + init)
                var vm = this
                var tml = {
                    name: vm.Addons[i].name,
                    safe_id: vm.Addons[i].id, //险种
                    code: i, //险种
                    safe_year: '', //保险期间
                    pay_year: '', //交费年期
                    money: '', //基本保险金额
                    period_money: '' //年缴保费
                }
                if (i === tbrhm) {
                    tml.pay_year = Number(vm.insurance.pay_year) - 1
                    tml.safe_year = 999
                    vm.Addons[i].attr2 = unique(vm.Addons[i].ratio, 'safe_year')
                    tml.money = vm.insurance.period_money
                } else if (i === ylnj) {
                    var item = {}
                    for (var j in vm.Addons[i].ratio) {
                        item = vm.Addons[i].ratio[j]
                        if (vm.insurance.pay_year === +item.pay_year) {
                            tml.pay_year = item.pay_year
                            break
                        }
                    }
                    tml.safe_year = ''
                    tml.money = vm.insurance.period_money
                } else if (i === cjb) {
                    tml.safe_year = 999
                    tml.pay_year = 1
                    tml.money = 0
                    tml.period_money = 100
                } else {
                    if (vm.Addons[i].ratio.length === 1) {
                        tml.safe_year = vm.Addons[i].ratio[0].year
                        tml.pay_year = vm.Addons[i].ratio[0].pay_year
                    }
                    tml.money = ''
                }
                console.log('设置附加险,ID:' + i)
                vm.addonIns[i] = tml
                console.log(JSON.stringify(tml))
                if (init) {
                    console.log('设置附加险,ID:' + i +'init:'+init)
                    var kitem = {}
                    for (var k in vm.insurances) {
                        kitem = vm.insurances[k]
                        if (k > 0 && kitem.code === i) {
                            vm.addonsSelected[kitem.code] = true
                            console.log('act')

                            vm.addonIns[kitem.code] = {
                                name: tml.name,
                                safe_id: kitem.safe_id,
                                code: kitem.code,
                                safe_year: kitem.safe_year,
                                pay_year: kitem.pay_year,
                                money: parseInt(kitem.money),
                                period_money: kitem.period_money,
                                draw_age: kitem.draw_age
                            }
                            vm.calMoney(i)
                        }
                    }
                }
            },
            chAddon: function (index) {
                const vm = this
                if (!vm.addonIns[index]) return
                vm.$nextTick(function () {
                    if (vm.addonsSelected[index]) {
                        if (index === cjb) {
                            vm.insurance.shareDrawType = zrwnzh; //转入万能账户
                            vm.addonIns[index].period_money = 100
                            vm.addonIns[index].money = 0
                            vm.addonIns[index].pay_year = 1
                            vm.addonIns[index].safe_year = 999
                            vm.countFee()
                        }
                        var toast_text = null
                        var name = vm.Addons[index].name
                        var safe_id = vm.insurance.code
                        switch (index) {
                            case tbrhm:
                                if (!this.noSamePerson) {
                                    toast_text = '投保人和被保人是同一人时，不能附加' + name
                                }
                                vm.isExempted = vm.addonsSelected[index]
                                vm.healthinfoOk = false
                                break
                            case zxak: // 附加尊享安康费用补偿医疗保险
                                if ((safe_id === wnh || safe_id === wnf) && vm.insurance.pay_year === 1) {
                                    toast_text = '主险【' + vm.insurance.name + '】趸交不可' + name
                                }
                                break
                            default:
                                break
                        }
                        if (toast_text) {
                            mui.toast(toast_text, {duration: 'short', type: 'div'});
                            vm.addonsSelected[index] = false
                            return false
                        }
                    } else {
                        if (index === ylnj) {
                            vm.addonIns[tbrhm].money = vm.insurance.period_money
//                            vm.calMoney(tbrhm)
                        }
                        if (index === cjb) {
                            vm.insurance.shareDrawType = ''
                        }
                    }
                    vm.$forceUpdate()
                })
            },
            resetMoney: function (i) {
                i = (i || this.insurance.code).toString()
//                console.log('重置【' + i + '】附加险')
                if (i === fxjs || i === wnh || i === wnf) {
                    this.insurance.money = ''
                } else {
                    this.insurance.period_money = ''
                }
                // 附加险重置
                this.hasAddons = false
                this.addonsSelected = {}
                this.addonIns = {}
                this.$forceUpdate()
            },
            checkAge: function (index) {
                var toast_text = null
                var pay_year = this.insurance.pay_year
                var age = this.assu_age
                var assu_sex = this.assu_sex
                var applAge = this.appl_age
                var id = index === 0 ? this.insurance.code : index
                var name = this.Addons[id] ? this.Addons[id].name : this.insurance.name
//              console.log(age + applAge + pay_year + id + name)

                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    return false
                }

                if (!id) return false
                switch (id) {
                    case hjjk: // 恒久健康终身重大疾病保险2017
                        if ([1, 2, 5, 10].indexOf(pay_year) > -1 && age > 65) {
                            toast_text = (pay_year === 1 ? '趸交' : pay_year + '年交') + '投保年龄上限为65岁'
                        } else if (pay_year === 15 && age > 60) {
                            toast_text = '15年交投保年龄上限为60岁'
                        } else if (pay_year === 20 && age > 55) {
                            toast_text = '20年交投保年龄上限为55岁'
                        }
                        break
                    case tbrhm: // 附加投保人豁免
                        if (applAge > 65) {
                            toast_text = '投保人年龄大于65岁不能附加【' + name + '】'
                        } else if (applAge < 66 && applAge > 60 && pay_year > 10) {
                            toast_text = '投保人年龄大于60岁附加【' + name + '】时，主险只可选10年交'
                        } else if (applAge < 61 && applAge > 55 && pay_year > 15) {
                            toast_text = '投保人年龄大于55岁附加【' + name + '】时，主险只可选10年交、15年交'
                        }
                        if (toast_text) {
                            mui.toast(toast_text, {duration: 'short', type: 'div'});
                            return false
                        }
                        break
                    case ylnj: // 附加养老年金
                        if (pay_year < 10 && (age > 65)) {
                            toast_text = pay_year + '年交投保年龄上限为65周岁'
                        } else if (pay_year === 10 && age > 60) {
                            toast_text = pay_year + '年交投保年龄上限为60周岁'
                        } else if (pay_year === 15 && age > 55) {
                            toast_text = pay_year + '年交投保年龄上限为55周岁'
                        } else if (pay_year === 20 && age > 50) {
                            toast_text = pay_year + '年交投保年龄上限为50周岁'
                        } else if (pay_year === 30 && age > 40) {
                            toast_text = pay_year + '年交投保年龄上限为40周岁'
                        }
                        if (toast_text) {
                            mui.toast(toast_text, {duration: 'short', type: 'div'});
                            return false
                        }
                        break
                    case qwhh: // 千万护航两全保险
                        if (age < 18 || age > 55) {
                            toast_text = '投保年龄范围在18-55周岁'
                        }
                        break
                    case zxak: //尊享
                    case hs: // 恒顺
                    case hx: //恒祥
                        if (age > 55) {
                            toast_text = '投保年龄上限为55周岁'
                        }
                        break
                    case wnq: // 万年青
                        if (pay_year + age > 70) {
                            toast_text = pay_year + '年交投保年龄上限为' + (70 - pay_year) + '周岁'
                        }
                        break
                    case fxjs: //福享金生
                        if (this.assured.insured_gender === MALE && pay_year + age > 60) {
                            toast_text = pay_year + '年交男性投保年龄上限为' + (60 - pay_year) + '周岁'
                        } else if (this.assured.insured_gender === FEMALE && pay_year + age > 55) {
                            toast_text = pay_year + '年交女性投保年龄上限为' + (55 - pay_year) + '周岁'
                        }
                        break
                    case wnh: //万年红
                        if ((pay_year === 3 || pay_year === 5) && (age > 65)) {
                            toast_text = pay_year + '年交投保年龄上限为65周岁'
                        } else if (pay_year === 10 && age > 60) {
                            toast_text = pay_year + '年交投保年龄上限为60周岁'
                        } else if (pay_year === 1 && age > 70) {
                            toast_text = pay_year + '年交投保年龄上限为70周岁'
                        }
                        break
                    case wnf: //万年福
                        if (assu_sex === MALE) {
                            if (pay_year === 1 && (age > 59)) {
                                toast_text = pay_year + '年交男性投保年龄上限为59周岁'
                            } else if (pay_year === 3 && age > 57) {
                                toast_text = pay_year + '年交男性投保年龄上限为57周岁'
                            } else if (pay_year === 5 && age > 55) {
                                toast_text = pay_year + '年交男性投保年龄上限为55周岁'
                            } else if (pay_year === 10 && age > 50) {
                                toast_text = pay_year + '年交男性投保年龄上限为50周岁'
                            }
                        } else if (assu_sex === FEMALE) {
                            if (pay_year === 1 && (age > 54)) {
                                toast_text = pay_year + '年交女性投保年龄上限为54周岁'
                            } else if (pay_year === 3 && age > 52) {
                                toast_text = pay_year + '年交女性投保年龄上限为52周岁'
                            } else if (pay_year === 5 && age > 50) {
                                toast_text = pay_year + '年交女性投保年龄上限为50周岁'
                            } else if (pay_year === 10 && age > 45) {
                                toast_text = pay_year + '年交女性投保年龄上限为45周岁'
                            }
                        }
                        break
                    default:
                        break
                }
                if (toast_text) {
                    mui.toast('【' + name + '】的' + toast_text, {duration: 'short', type: 'div'});
                    return false
                }
                return true
            },
            checkForm: function () {
//                console.log('checkform');
                const vm = this
                var toast_text = null
                var id = vm.insurance.code
                if (!id) {
                    toast_text = '请选择险种'
                } else if (!vm.insurance.pay_year) {
                    toast_text = '请选择交费期间'
                } else if (!vm.insurance.safe_year) {
                    toast_text = '请选择保险期间'
                } else if (!vm.checkAge(0)) {
                    return false
                } else if ([hjjk, wnq, qwhh].indexOf(id) > -1 && !vm.insurance.money) { //保额
                    toast_text = '请填写基本保险金额'
                } else if (id === fxjs) { // 福享金生
                    if (!vm.insurance.period_money) {
                        toast_text = '请填写年缴保费'
                    } else if (!vm.insurance.shareDrawType) {
                        toast_text = '请选择生存金领取方式'
                    }
                } else if (id === wnh || id === wnf) { // 万年红、万年福
                    if (!vm.insurance.period_money) {
                        toast_text = '请填写年缴保费'
                    } else if (!vm.insurance.draw_freq) {
                        toast_text = '请选择年金领取方式'
                    }
                }
                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    return false
                }
                return vm.checkMoney()
            },
            checkMoney: function() {
                var money = Number(this.insurance.money)
                var period_money = Number(this.insurance.period_money)
                var name = this.insurance.name
                var pay_year = this.insurance.pay_year
                var toast_text = null
                switch (this.insurance.code) {
                    case hjjk: // 恒久健康终身重大疾病保险2017
                        if (money < 10000) {
                            toast_text = '【' + name + '】的最低保额为1万元'
                        } else if (money % 1000 !== 0) {
                            toast_text = '【' + name + '】的保额需为1千元整数倍'
                        }
                        break
                    case wnq: // 万年青终身重大疾病保险
                        if (money < 50000) {
                            toast_text = '【' + name + '】的最低保额为5万元'
                        } else if (money % 1000 !== 0) {
                            toast_text = '【' + name + '】的保额需为1千元整数倍'
                        }
                        break
                    case fxjs: // 福享金生终身年金保险
                        if (period_money < 5000) {
                            toast_text = '【' + name + '】的最低保费为5千元'
                        } else if (period_money % 1000 !== 0) {
                            toast_text = '【' + name + '】的保费需为1千元整数倍'
                        }
                        break
                    case wnh: // 万年红终身年金保险
                        if (period_money < 1000) {
                            toast_text = '【' + name + '】的最低保费为1千元'
                        } else if (pay_year === 10 && period_money < 20000) {
                            toast_text = '【' + name + '】10年交最低保费为2万元'
                        } else if (period_money % 1000 !== 0) {
                            toast_text = '【' + name + '】的保费需为1千元整数倍'
                        }
                        break
                    case wnf: // 万年福年金保险
                        if (period_money < 1000) {
                            toast_text = '【' + name + '】的最低保费为1千元'
                        } else if (period_money % 1000 !== 0) {
                            toast_text = '【' + name + '】的保费需为1千元整数倍'
                        }
                        break
                }
                if (toast_text) {
                    mui.toast(toast_text, {duration: 'long', type: 'div'});
                    return false
                }
                return true
            },
            //试算
            calMoney: function (index) {
                document.activeElement.blur();
                console.log('试算中'+index);
                var vm = this
                var id = vm.insurance.code;
                if (!vm.checkForm()) {
                    return false
                }
                var basedata = {
                    user_id: vm.userinfo.id,
                    productInfo: [],
                    insurant: {
                        name: vm.assured.insured_name, //vm.assured.insured_name
                        birthday: vm.assured.insured_birthday, //vm.assured.insured_birthday
                        genderCode: vm.assured.insured_gender //vm.assured.insured_gender
                    },
                    applicant: {
                        name: vm.applicant.holder_name, //vm.applicant.holder_name,
                        birthday: vm.applicant.holder_birthday, //vm.applicant.hpo5  older_birthday,
                        genderCode: vm.applicant.holder_gender //vm.applicant.holder_gender
                    }
                };
                var main = {}
                main.productId = vm.insurance.safe_id;
                main.pay = vm.insurance.pay_year;
                main.insure = vm.insurance.safe_year;
                console.log(typeof id + id)
                if ([hjjk, wnq].indexOf(id) > -1) { //恒久 万年青
                    main.amount = vm.insurance.money.toString()
                } else if (id === qwhh) { //千万
                    main.quantity = (vm.insurance.money / 50000).toString()
                }
                if ([fxjs, wnf].indexOf(id) > -1) {
                    main.guarantee_term = njbznx
                }
                if ([fxjs, wnh, wnf].indexOf(id) > -1) {
                    main.premium = vm.insurance.period_money.toString()
                }

                basedata.productInfo.push(main)
                console.log(JSON.stringify(basedata))
                //是附加险
                if (index) {
                    if (!vm.checkAddonsForm(index)) {
                        return false
                    }
                    if (index && vm.addonIns[index]) {
                        if (index === tbrhm && vm.addonsSelected[ylnj]) {
                            vm.addonIns[index].money = (Number(vm.insurance.period_money) + Number(vm.addonIns[ylnj].period_money)).toFixed(2)
                        }
                        console.log(JSON.stringify(vm.addonIns[index]))
                        var product = {}
                        product.productId = vm.addonIns[index].safe_id
                        product.pay = vm.addonIns[index].pay_year
                        product.insure = vm.addonIns[index].safe_year
                        product.amount = vm.addonIns[index].money.toString()
                        product.premium = vm.addonIns[index].period_money.toString()
                        console.log(JSON.stringify(product))
                        if (index === zxak || index === hjax) { //尊享安康、恒久安心
                            basedata.insurant.social_security = vm.assured.insured_has_SSID ? has_social_security : no_social_security
                        } else if (index === hs) { //恒顺
                            basedata.insurant.occupationCode = vm.assured.insured_job_code
                        }
                        basedata.productInfo.push(product)
                        if (index === tbrhm && vm.addonsSelected[ylnj]) {
                            basedata.productInfo.push({
                                productId :vm.addonIns[ylnj].safe_id,
                                pay :vm.addonIns[ylnj].pay_year,
                                insure :vm.addonIns[ylnj].safe_year,
                                amount :vm.addonIns[ylnj].money.toString(),
                                premium :vm.addonIns[ylnj].period_money.toString()
                            })
                        }
                    }
                }
                console.log(JSON.stringify(basedata))
                //开始试算
                luckyAjax({
                    data: {
                        data: JSON.stringify({
                            msg: basedata,
                            company_code: 'HengDa',
                            method: 'test_calc'
                        }),
                        server: 'PolicyIns.onlineInsured',
                        device: 'mobile'
                    },
                    timeout: 5000,
                    success: function (res) {
                        if (res.code && res.data) {
                            var data = res.data
                            if (data.result === 'success') {
                                  console.log('cal-success')
                                if (index) {
                                      console.log('试算附加险' + index + '成功')
                                    //试算附加险成功
                                    vm.addonIns[index].period_money = data.data.product[1].premium;
                                    console.log(typeof index + ';' + typeof vm.addonsSelected[ylnj])
                                    if (index === ylnj && vm.addonsSelected[ylnj] && vm.addonIns[tbrhm]) {
                                        vm.addonIns[tbrhm].period_money = ''
                                        vm.addonIns[tbrhm].money = (Number(vm.addonIns[index].period_money) + Number(vm.insurance.period_money)).toFixed(2)
                                        vm.$forceUpdate()
                                        vm.calMoney(tbrhm)
                                    }
                                    vm.$forceUpdate()
                                } else {
                                      console.log('试算主险' + index + '成功')
                                    if (id === fxjs || id === wnh || id === wnf) {
                                        vm.insurance.money = data.data.product[0].amount.substr(0, data.data.product[0].amount.length - 1);
                                    } else {
                                        vm.insurance.period_money = data.data.product[0].premium;
                                    }
                                    // 重置附加险
                                    vm.resetAddons();
                                }
                                vm.countFee()
                                vm.$forceUpdate()
                            } else {
                                  console.log('cal-failure')
                                if (index) {
                                    vm.addonIns[index].period_money = ''
                                } else {
                                    if (id === fxjs || id === wnh || id === wnf) {
                                        vm.insurance.money = ''
                                    } else {
                                        vm.insurance.period_money = ''
                                    }
                                }
                                mui.toast(data.resultMsg, {duration: 'short', type: 'div'});
                                return false;
                            }
                        } else {
                            mui.toast('网络繁忙，请稍后再试', {duration: 'short', type: 'div'});
                            return false;
                        }
                    }
                });
            },
            checkAddonsForm: function (index) {
//                console.log('附加险表单校验' + index)
                var addon = this.addonIns[index]
                var name = this.Addons[index].name
                var toast_text = null
                if (index === cjb) {
                    return true
                } else if (!addon.safe_year) {
                    toast_text = '请选择【' + name + '】的保险期间'
                } else if (!addon.pay_year) {
                    toast_text = '请选择【' + name + '】的交费期间'
                } else if (!addon.money && index !== tbrhm) {
                    toast_text = '请填写【' + name + '】的基本保险金额'
                } else if (!this.noSamePerson && index === tbrhm) {
                    toast_text = '投保人和被保人是同一人时，不能附加' + name
                }

                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    return false
                }
                return this.checkAddonMoney(index) && this.checkAge(index)
            },
            checkAddonMoney: function (index) {
                var toast_text = null
                var period_money = Number(this.insurance.period_money)
                var mainMoney = Number(this.insurance.money)

                var name = '【' + this.Addons[index].name + '】'
                var money = +this.addonIns[index].money
//                console.log(index + money + '校验附加险保额')
                switch (index) {
                    case hs: // 附加恒顺意外伤害医疗保险
                        if (money < 2000) {
                            toast_text = '最低保额为2千元'
                        } else if (money > 50000) {
                            toast_text = '最高保额为5万元'
                        } else if (money % 1000 !== 0) {
                            toast_text = '保额需为1千元的整数倍'
                        } else if (this.insurance.code !== fxjs && this.insurance.code !== wnh && this.insurance.code !== wnf && money > mainMoney / 5) {
                            toast_text = '保额不超过主险保额的20%'
                        } else if ((this.insurance.code === fxjs || this.insurance.code === wnh || this.insurance.code === wnf) && money > period_money * this.insurance.pay_year / 5) {
                            toast_text = '保额不超过主险总保费的20%'
                        }
                        break
                    case hx: // 附加恒祥住院津贴医疗保险
                        if (money < 50) {
                            toast_text = '最低保额50元/天'
                        } else if ((money > 200 && this.assu_age > 17) || (money > 100 && this.assu_age < 18)) {
                            toast_text = '最高保额' + (this.assu_age > 17 ? '200' : '100') + '元/天'
                        } else if (money % 10 !== 0) {
                            toast_text = '保额需为10的整数倍'
                        }
                        break
                    case hjax: //恒久安心
                        var biaob = this.bbcal(this.insurance.pay_year, this.insurance.period_money)
                        console.log('标保：' + biaob)
                        if ((this.insurance.code === fxjs || this.insurance.code === wnh || this.insurance.code === wnf) && biaob < 5000) {
                            toast_text = '此主险标保大于等于5000元方可附加'
                        }
                        break
                    default:
                        break
                }
                if (toast_text) {
                    mui.toast(name + toast_text, {duration: 'short', type: 'div'});
                    return false
                }
                return true
            },
            countFee: function() {
                var sum = 0
                if (this.insurance.period_money) {
                    sum += Number(this.insurance.period_money)
                }
                for (var i in this.addonsSelected) {
                    if (this.addonsSelected[i]) {
                        sum += Number(this.addonIns[i].period_money)
                    }
                }
                this.totalFee = sum.toFixed(2)
            }
        }
    });

    mui.plusReady(function () {
        var popu = new ClosePopu(); // 实例化关闭窗口对象
        var userinfo = JSON.parse(plus.storage.getItem('userinfo'));
        safe.userinfo = userinfo;

        var init = plus.webview.currentWebview().data;
        safe.init = init;
//
        var applicant = plus.storage.getItem('hengda_applicant') ? JSON.parse(plus.storage.getItem('hengda_applicant')) : ''
        var assured = plus.storage.getItem('hengda_assured') ? JSON.parse(plus.storage.getItem('hengda_assured')) : ''
        var goods = plus.storage.getItem('hengda_safegoods') ? JSON.parse(plus.storage.getItem('hengda_safegoods')) : ''
        console.log('+++++++++++++')
        console.log(plus.storage.getItem('hengda_safegoods'))
        if(goods){
            safe.insurances = goods
            mui.each(goods,function (index,item) {
                if(item.is_main){
                    safe.insurance = deepClone(item)
                }
            })
        }

        safe.assu_age = getAge(assured.insured_birthday)
        safe.appl_age = getAge(applicant.holder_birthday)
        safe.assu_sex = assured.insured_gender
        safe.applicant = applicant
        safe.assured = assured
        safe.noSamePerson = assured.rel_insured_holder === ISASSURED ? false : true;
//
        getIns(); //获取险种列表
        //安卓监听返回事件
        plus.key.addEventListener("backbutton",function(){
            popu.closepop();
        });
        //保存
        document.querySelector('#saveGoods').addEventListener('tap', function () {
            document.activeElement.blur();
            if (!safe.checkForm()) {
                return false
            }
            if ((safe.insurance.code === fxjs || safe.insurance.code === wnh || safe.insurance.code === wnf) && !safe.insurance.money) {
                mui.toast('请先点击计算主险的基本保额', {duration: 'short', type: 'div'});
                return false
            } else if ((safe.insurance.code !== fxjs && safe.insurance.code !== wnh && safe.insurance.code !== wnf) && !safe.insurance.period_money) {
                mui.toast('请先点击计算主险的年交保费', {duration: 'short', type: 'div'});
                return false
            }
            // 附加险
            var addonIns = []
            var countAddon = 0 // 险种个数
            for (var k in safe.addonsSelected) {
                if (safe.addonsSelected[k] === true) {
                    var name = safe.Addons[k].name
                    safe.addonIns[k].name = name
                    countAddon += 1
                    if (safe.checkAddonsForm(k)) {
                        if (!safe.addonIns[k].period_money) {
                            mui.toast('请计算【' + name + '】的年缴保费', {duration: 'short', type: 'div'});
                            return false
                        }
                        addonIns.push(safe.addonIns[k])
                    } else {
                        return false
                    }
                }
            }
            //
            var insurances = []
            insurances.push(safe.insurance);
            safe.addonIns && mui.each(safe.addonIns, function (index, item) {
                if (safe.addonsSelected[item.code]) {
                    insurances.push(item)
                }
            })
            plus.storage.setItem('hengda_safegoods', JSON.stringify(insurances));
            console.log(JSON.stringify(plus.storage.getItem('hengda_safegoods')))
            mui.fire(plus.webview.getWebviewById('hd_insurance-index'), 'saveFlag', {
                item: 'hengda_safegoods',
                data: 'safegoods'
            });
            popu.closepop();
            mui.back();
        })
        //
        mui('body').on('tap', '#close-ins-pop', function () {
            // 关闭遮罩层，弹框
            popu.closepop();
        });
        //获取险种列表
        function getIns() {
            console.log('getInslist')
            luckyAjax({
                data: {
                    data: JSON.stringify({'supplier_id': SCID}),
                    server: 'PolicyIns.getProductList'
                }, //获取险种列表
                success: function (res) {
                    if (res.code == 1) {
                        console.log(JSON.stringify(res.data))
                        var data = []
                        safe.safegoods = res.data;
                        mui.each(res.data, function (index, item) {
                            if (onlineIns.indexOf(item.code) > -1) {
                                data.push({
                                    value: item.id,
                                    text: item.name,
                                    ratio: item.ratio,
                                    child: item.child,
                                    code: item.code
                                })
                            }
                        });
                        safegoods.setData(data);
                        //
                        mui.each(data, function (index, item) {
                            for (var k in safe.insurances) {
                                var kitem = safe.insurances[k]
                                if (kitem.is_main && item.code === kitem.code) {
                                    safe.main_insurance = item
                                    console.log('11111')
                                    safe.insChanged(true)
                                }
                            }
                        });
                        //
                    } else {
                        mui.toast('加载失败', {duration: 'short', type: 'div'});
                        return false;
                    }
                }
            });
        }
    });
    //去重
    const unique = function (a, key) {
        var res = [];
        for (var i = 0, len = a.length; i < len; i++) {
            for (var j = 0, jLen = res.length; j < jLen; j++) {
                if (res[j][key] === a[i][key]) {
                    break;
                }
            }
            if (j === jLen) {
                res.push(a[i]);
            }
        }
        return res;
    };
</script>

</html>