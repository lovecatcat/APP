<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/form.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
    <link href="../css/signature.css" rel="stylesheet"/>
</head>

<body class="BL-bg-f2f">
<header id="Js-header" class="BL-bg-fff">
    <div class="BL-mod-headbar BL-mod-headbar-pos">
        <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
        <h1 class="BL-title">信息确认</h1>
    </div>
</header>
<div id="Js-content" class="mui-content BL-rel BL-overFlow-autoY" v-cloak>
        <div class="BL-mar-t-1">
            <div class="form-wrap" v-if="orderinfo">
                <div class="BL-bg-fff BL-mar-t-1">
                    <ul class="mui-table-view">
                        <li class="mui-table-view-cell mui-collapse">
                            <a class="mui-navigate-right info-collapse" href="#">投保人信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_type_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_expire_end=='9999-12-31'?'长期有效':orderinfo.insData.holder_ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">身高(cm)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_height}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">体重(kg)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_weight}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">职业</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_job_code_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">收入来源</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_salary_from_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年收入(万元)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_salary_avg}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">工作单位</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_company}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">投保地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_province_text}}{{orderinfo.insData.holder_home_city_text}}{{orderinfo.insData.holder_home_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_province_text}}{{orderinfo.insData.holder_contact_city_text}}{{orderinfo.insData.holder_contact_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">手机号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_mobile}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">电子邮箱</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_email}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是否有社保</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_has_SSID == has_social_security?'是':'否'}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell mui-collapse" v-if="orderinfo.insured.rel_insured_holder != ISASSURED">
                            <a class="mui-navigate-right info-collapse" href="#">被保人信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是投保人的</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.rel_insured_holder_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{typename[orderinfo.insured.insured_ID_type]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_ID_expire_end=='9999-12-31'?'长期有效':orderinfo.insured.insured_ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">身高(cm)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_height}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">体重(kgs)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_weight}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">职业</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_job_code_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">收入来源</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_salary_from_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年收入(万元)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_salary_avg}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">工作单位</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_company}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">投保地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_province_text}}{{orderinfo.insured.insured_home_city_text}}{{orderinfo.insured.insured_home_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">手机号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_mobile}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">电子邮箱</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_email}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是否有社保</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_has_SSID == has_social_security?'是':'否'}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell" v-else><a class="mui-navigate-right info-collapse" href="#">被保人：<span class="BL-col-333">本人</span></a></li>
                        <li class="mui-table-view-cell mui-collapse" v-if="!orderinfo.insData.is_legal_benefic">
                            <a class="mui-navigate-right info-collapse" href="#">受益人信息</a>
                            <div class="mui-collapse-content" >
                                <div class="form-wrap margin-t_875" v-for="(item,index) in orderinfo.beneficList">
                                    <div class="ins-font-xs BL-pad-lr-1 BL-col-333" v-show="index>0">第{{index+1}}个受益人</div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是被保人的</label>
                                        <div class="flex-2 ins-font-sm">{{benerelname[item.beneficiary_is_insured]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{item.fullname}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{typename[item.ID_type]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{item.ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{item.ID_expire_end=='9999-12-31'?'长期有效':item.ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{item.gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{item.birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">受益顺序</label>
                                        <div class="flex-2 ins-font-sm">{{item.sort_order}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">受益比例(%)</label>
                                        <div class="flex-2 ins-font-sm">{{item.rate}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯地区</label>
                                        <div class="flex-2 ins-font-sm">{{item.province_text + ' ' + item.city_text + ' ' + item.district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{item.address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{item.zip}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell" v-else><a class="mui-navigate-right info-collapse" href="#">受益人：<span class="BL-col-333">法定</span></a></li>
                        <li class="mui-table-view-cell mui-collapse" v-if="orderinfo.contentList">
                            <a class="mui-navigate-right info-collapse" href="#">险种信息</a>
                            <div class="mui-collapse-content" >
                                <div class="form-wrap">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm">合计保费(元)</label>
                                        <div class="flex-2 ins-font-sm BL-col-ff8201">{{orderinfo.insData.total}}</div>
                                    </div>
                                </div>
                                <div class="form-wrap margin-t_875" v-for="(item,index) in orderinfo.contentList">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">险种名称</label>
                                        <div class="flex-2 ins-font-sm">{{item.product_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">交费期间</label>
                                        <div class="flex-2 ins-font-sm">{{item.period_payment | payYearFilter}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">保障期间</label>
                                        <div class="flex-2 ins-font-sm">{{item.period_guanantee | safeYearFilter}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">保险金额(元)</label>
                                        <div class="flex-2 ins-font-sm">{{item.amount}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年缴保费(元)</label>
                                        <div class="flex-2 ins-font-sm BL-col-ff8201">{{item.fee}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell mui-collapse">
                            <a class="mui-navigate-right info-collapse" href="#">付款信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">银行卡号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">开户行</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_name_text}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-wrap">
                <div class="border-b-e7e7e7">
                    <div class="item-title">签名提示</div>
                </div>
                <div class="BL-pad-a1">
                    <p class="BL-ftz-46 BL-col-333"><i class="mui-icon mui-icon-info"></i>分享签名链接操作提示：</p>
                    <div class="BL-ftz-46 BL-pad-l-2_5">
                        1. 点击下方按钮，复制链接<br>
                        2. 切换到微信或QQ，选择好友并粘贴发送<br>
                        3. 待客户（投被保人）完成签名后，并在签名处点击获取签名<br>
                    </div>
                    <div class="BL-ub BL-ub-ac BL-ub-pc BL-pad-t-1">
                        <button class="form-btn ins-btn sm-btn btn-copy" :data-url="config.domain + '/ins_sign/signature3.0.html?owner=appl_signature&war_id='+war_id">复制投保人签名链接
                        </button>
                    </div>
                    <div class="BL-ub BL-ub-ac BL-ub-pc BL-pad-t-1" v-if="assured.rel_insured_holder!==ISASSURED">
                        <button class="form-btn ins-btn sm-btn btn-copy" :data-url="config.domain + '/ins_sign/signature3.0.html?owner=assu_signature&war_id='+war_id">复制被保人签名链接
                        </button>
                    </div>
                </div>
            </div>
            <div class="form-wrap margin-t_875">
                <div class="border-b-e7e7e7">
                    <div class="item-title">信息确认</div>
                </div>
                <div class="BL-pad-a1">
                    <div v-if="newproduct">
                        <div class="mui-input-row mui-checkbox mui-left BL-mar-t-1" >
                            <label style="padding-left: 3rem;line-height: 2rem;">本人已阅读保险条款、产品说明书和投保提示书，了解本产品的特点和保单利益的不确定性。
                                <input name="checkbox" v-model="agree" type="checkbox" style="top: 20px; left: 0px;"></label>
                        </div>
                        <div class="mui-input-row BL-ftz-42 BL-pad-lr-1_25" style="line-height: 2rem;">
                            <a class="BL-col-3b9cf5" type="button" disabled @tap="showStatement(item.safe_id,item.name)" v-for="(item,index) in safegoods" v-show="item.name"><strong>《{{item.name}}保险条款》</strong></a>
                            、<a type="button" @tap="cjbdesc" class="BL-col-3b9cf5"><strong>《恒大传家宝年金保险（万能型）产品说明书 》</strong></a>、
                            <a type="button" id="safenotice" class="BL-col-3b9cf5"><strong>《人身保险投保提示书》</strong></a>、
                            <a type="button" id="mustknow" class="BL-col-3b9cf5"><strong>《投保须知》</strong></a>、
                            <a type="button" id="statement" class="BL-col-3b9cf5"><strong>《银行自动转账授权事项》</strong></a>、
                            <a type="button" id="signstatement" class="BL-col-3b9cf5"><strong>《声明授权与签名》</strong></a>
                        </div>
                    </div>
                    <div class="mui-input-row mui-checkbox mui-left BL-mar-t-1" v-else>
                        <label style="padding-left: 3rem;line-height: 2rem;">本人已阅读
                            <a class="BL-col-3b9cf5" type="button" disabled @tap="showStatement(item.safe_id,item.name)" v-for="(item,index) in safegoods" v-show="item.name"><strong>《{{item.name}}保险条款》</strong></a>
                            、和<a type="button" id="safenotice" class="BL-col-3b9cf5"><strong>《人身保险投保提示书》</strong></a>、
                            <a type="button" id="mustknow" class="BL-col-3b9cf5"><strong>《投保须知》</strong></a>、
                            <a type="button" id="statement" class="BL-col-3b9cf5"><strong>《银行自动转账授权事项》</strong></a>、
                            <a type="button" id="signstatement" class="BL-col-3b9cf5"><strong>《声明授权与签名》</strong></a>
                            ，并确认上述信息无误
                            <input name="checkbox" v-model="agree" type="checkbox" style="top: 20px; left: 0px;">
                        </label>
                    </div>
                </div>
            </div>
            <div class="form-wrap margin-t_875">
                <div class="border-b-e7e7e7">
                    <div class="item-title">手写签名</div>
                </div>
                <!-- 投保人签名Begin -->
                <div class="BL-pad-a1">
                    <div class="BL-ub BL-ub-ac BL-ub-pc">
                        <button class="form-btn ins-btn sm-btn" @click="getSignature(1)">获取投保人签名</button>
                    </div>
                    <div class="input-item sign-item">
                        <label>投保人签名：</label>
                        <div class="input-wrap">
                            <img class="signature-img" slot="input" :src="previewImg[1]" v-if="previewImg[1]">
                        </div>
                        <div class="sign-btn" @tap="showSign[1] = !showSign[1]">签名</div>
                    </div>
                    <sign v-if="showSign[1]" index="1"></sign>
                </div>
                <!-- 投保人签名End -->
                <!-- 被保人签名Begin -->
                <div class="BL-pad-a1" v-if="assured.rel_insured_holder!==ISASSURED">
                    <div class="BL-ub BL-ub-ac BL-ub-pc">
                        <button class="form-btn ins-btn sm-btn" @click="getSignature(2)">获取被保人签名</button>
                    </div>
                    <div class="input-item sign-item">
                        <label>被保人签名：</label>
                        <div class="input-wrap">
                            <img class="signature-img" slot="input" :src="previewImg[2]" v-if="previewImg[2]">
                        </div>
                        <div class="sign-btn" @tap="showSign[2] = !showSign[2]">签名</div>
                    </div>
                    <sign v-if="showSign[2]" index="2"></sign>
                </div>
                <!-- 被保人签名End -->
            </div>
            <div class="BL-mar-t-3 BL-pad-lr-1_5">
                <a type="button" id="saveSign" class="form-btn blue">提交</a>
            </div>
            <br>
            <br>
        </div>
</div>
<!--弹窗 end-->
<template id="sign">
    <div class="signature-box">
        <div :id="'signature-pad' + index" class="m-signature-pad">
            <div class="m-signature-pad--body" :style="styles">
                <canvas :id="'canvas'+index"></canvas>
            </div>
            <div class="m-signature-pad--footer">
                <div class="description">请用正楷字体签名</div>
                <div class="left">
                    <button type="button" class="ins-btn xs-btn clear" @click="clear">清除</button>
                </div>
                <div class="right">
                    <button type="button" class="ins-btn xs-btn save" @click="save(index)">保存</button>
                </div>
            </div>
        </div>
    </div>
</template>
</body>
<script src="../js/mui.min.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script src="../js/signature/signature_pad.js" type="text/javascript"></script>
<script src="../js/copy.js" type="text/javascript"></script>
<script src="../js/pdf.js" type="text/javascript"></script>
<script src="method.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    mui('body').on('tap', '#statement', function () {
        mui.openWindow({
            url: 'pay-statement.html',
            id: 'pay_statement',
            show: animateObj.aniDetal
        })
        return false
    })
    mui('body').on('tap', '#safenotice', function () {
        mui.openWindow({
            url: 'safe-notice.html',
            id: 'safe_notice',
            show: animateObj.aniDetal
        })
        return false
    })
    mui('body').on('tap', '#mustknow', function () {
        mui.openWindow({
            url: 'mustknow.html',
            id: 'mustknow',
            show: animateObj.aniDetal
        })
        return false
    })
    mui('body').on('tap', '#signstatement', function () {
        mui.openWindow({
            url: 'sign-statement.html',
            id: 'sign_statement',
            show: animateObj.aniDetal
        })
        return false
    })
    mui.plusReady(function () {
        statusbar();
        var winH = window.innerHeight;
        var titHeight = document.querySelector('#Js-header').offsetHeight;
        document.querySelector('#Js-content').style.height = winH - titHeight + 'px';

        var war_id = plus.webview.currentWebview().war_id;
        if (war_id) {
            img.war_id = war_id
        } else {
            mui.toast("保单不存在", {duration: 'long', type: 'div'})
            return false;
        }

        var itemName = ['hengda_applicant','hengda_assured','hengda_beneficiary','hengda_safegoods','hengda_healthinfo','hengda_bank','hengda_upload','hengda_ids'];
        var assured = plus.storage.getItem('hengda_assured') ? JSON.parse(plus.storage.getItem('hengda_assured')): ''
        var applicant = plus.storage.getItem('hengda_applicant') ? JSON.parse(plus.storage.getItem('hengda_applicant')): ''
        var safegoods = plus.storage.getItem('hengda_safegoods') ? JSON.parse(plus.storage.getItem('hengda_safegoods')): ''
        img.safegoods = safegoods
        console.log(JSON.stringify(safegoods))
        mui.each(safegoods, function (index, item) {
            if (item.code === cjb || item.code === fxjs) {
                img.newproduct = true
            }
        })
        img.assured = assured
        //赋值
        img.getSignature(1,true);
        img.getSignature(2,true);
        //安卓监听返回事件
        plus.key.addEventListener("backbutton",function(){
            mui.fire(plus.webview.getWebviewById('hd_insurance-index'), 'resetLoading');
        });
        //保存
        document.querySelector('#saveSign').addEventListener('tap', function () {
            if (!img.agree) {
                mui.toast("请确认阅读相关条款声明并同意转账授权与声明", {duration: 'short', type: 'div'})
                return false;
            }
            if (!img.checkForm()) {
                return false
            }
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {insured_ID_no: assured.insured_ID_no},
                        company_code: 'HengDa',
                        method: 'getLastInsured'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 10000,
                success: function (res) {
                    if (res.code) {
                        mui.toast('核保中...', {duration: 'long', type: 'div'})
                        online_ins()
                    } else {
                        mui.toast("该被保人有正在处理的保单，请稍后再次尝试。", {duration: 'long', type: 'div'})
                        return false;
                    }
                }
            });
        })
        //

        mui('body').on('tap', '.btn-copy', function (e) {
            var copy_url = this.getAttribute('data-url')
            if (Clipbord(copy_url)) {
                mui.toast("复制成功", {duration: 'short', type: 'div'})
            }
        });

        //核保
        function online_ins() {
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {policy_id: img.war_id},
                        company_code: 'HengDa',
                        method: 'insure'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 30000,
                success: function (res) {
                    if (res.code) {
                        if (res.data.resultCode === '00') {
                            mui.toast('自核通过，影像上传中', {duration: 'short', type: 'div'})
                            upload_img(img.war_id)
                        } else if (res.data.resultCode === '02') {
                            mui.toast('进入人工核保，影像上传中', {duration: 'short', type: 'div'})
                            upload_img(img.war_id)
                        } else {
                            mui.toast(res.data && res.data.resultMsg ? res.data.resultMsg : '网络出错，请稍后再试', {
                                duration: 'long',
                                type: 'div'
                            })
                            return false
                        }
                    } else {
                        mui.toast(res.data.resultMsg, {duration: 'long', type: 'div'})
                        return false
                    }
                }
            });
        };

        //上传影像
        function upload_img(id) {
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {policy_id: id},
                        company_code: 'HengDa',
                        method: 'update_img'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 10000,
                success: function (res) {
                    for (var i = 0; i < 8; i++) {
                        console.log(itemName[i])
                        plus.storage.removeItem(itemName[i])
                    }
                    if (res.code) {
                        if (res.data.resultCode === '00') {
                            mui.toast('上传成功，承保中', {duration: 'short', type: 'div'})
                            ins_pay(id)
                        } else {
                            mui.toast(res.data && res.data.resultMsg ? res.data.resultMsg : '网络出错，请稍后再试', {duration: 'long', type: 'div'})
                            return false
                        }
                    } else {
                        mui.toast(res.data.resultMsg, {duration: 'long', type: 'div'})
                        return false
                    }
                }
            });
        };
        //承保接口调完后
        function afterPay(clear, ispay) {
            if (clear) {
                //清除本地缓存
                for (var i = 0; i < itemName.length; i++) {
                    plus.storage.removeItem(itemName[i])
                }
            }
            setTimeout(function () {
                if (ispay) {
                    mui.openWindow({
                        url: '../member-warranty-manage.html',
                        id: 'member_warranty_manage',
                        show: animateObj.aniDetal
                    })
                    setTimeout(function () {
                        plus.webview.close('hd-insurance-sign');
                        plus.webview.close('hd_insurance-index');
                    }, 500)
                } else {
                    mui.openWindow({
                        url: '../member-life-order.html',
                        id: 'member_life_order',
                        show: animateObj.aniDetal
                    })
                    setTimeout(function () {
                        plus.webview.close('hd-insurance-sign');
                        plus.webview.close('hd_insurance-index');
                        mui.fire(plus.webview.getWebviewById('member_life_order'), 'reload');
                    }, 500)
                }
            }, 3000)
        }
        //承保
        function ins_pay(id) {
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {policy_id: id},
                        company_code: 'HengDa',
                        method: 'pay'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 10000,
                success: function (res) {
                    if (res.code) {
                        if (res.data.resultCode === '00') {
                            mui.toast('承保成功', {duration: 'long', type: 'div'});
                            afterPay(true,true)
                        } else if (res.data.resultCode === '02') {
                            mui.toast(res.data.resultMsg, {duration: 'long', type: 'div'});
                            afterPay(true,false)
                        } else if (res.data.resultCode === '01') {
                            if (res.data.data && res.data.data.signed) {
                                mui.openWindow({
                                    url: 'pay-status.html',
                                    id: 'pay_status',
                                    show: animateObj.aniDetal,
                                    extras: {
                                        'data': res.data,
                                        'war_id': id,
                                        'tel': applicant.holder_mobile
                                    }
                                })
                            } else {
                                mui.toast(res.data.resultMsg, {duration: 'long', type: 'div'});
                                return false
                            }
                        }
                    } else {
                        mui.toast('网络出错，请稍后再试', {duration: 'long', type: 'div'})
                        return false
                    }
                }
            });
        };
        //
    });

    Vue.component('sign', {
        template: '#sign',
        props: ['index'],
        data:function() {
            return {
                signature: null,
                styles: null
            }
        },
        mounted:function() {
            const lwRatio = 2 / 5
            var canvas = document.getElementById('canvas' + this.index)
            if (!canvas) return
            this.styles = {
                height: (canvas.parentNode.offsetWidth * lwRatio).toFixed(0) + 'px'
            }
            var vm = this

            function resizeCanvas() {
                var ratio = Math.max(window.devicePixelRatio || 1, 1)
                canvas.width = canvas.offsetWidth * ratio
                canvas.height = canvas.offsetWidth * lwRatio * ratio
                canvas.getContext('2d').scale(ratio, ratio)
            }

            window.onresize = resizeCanvas
            resizeCanvas()
            vm.signature = new SignaturePad(canvas, {
                minWidth: 2,
                maxWidth: 3.5
            })
        },
        destroyed:function() {
            this.signature.off()
            this.signature = null
        },
        methods: {
            clear:function() {
                this.signature && this.signature.clear()
            },
            save:function(index) {
                if (this.signature.isEmpty()) {
                    mui.toast("签名不能为空", {duration: 'short', type: 'div'})
                    return
                }
                var base64 = this.signature.toDataURL()
                if (index == 1) {
                    this.setApplSN(base64)
                } else if (index == 2) {
                    this.setAssuSN(base64)
                }
                this.$parent.save_ins(index)
                this.$parent.showSign[this.index] = false
                this.clear()
            },
            setApplSN:function(base64) {
                base64 && (this.$parent.appl_signature = base64, this.$parent.previewImg[1] = base64)
                this.$forceUpdate()
            },
            setAssuSN:function(base64) {
                base64 && (this.$parent.assu_signature = base64, this.$parent.previewImg[2] = base64)
                this.$forceUpdate()
            },
        }
    });
    var img = new Vue({
        el: '#Js-content',
        data:function() {
            return {
                agree: false,
                safegoods: '',
                newproduct: false, //是否含新型产品（福享金生、传家宝）
                war_id: '',
                assured: {},
                appl_signature: '',
                assu_signature: '',
                showSign: {
                    1: false,
                    2: false
                },
                previewImg: [], //上传图片
                orderinfo: '' //保单详情
            }
        },
        //过滤器
        filters: {
            //保障期间
            safeYearFilter: function (value) {
                if (value > 50 && value !== '999' && value !== 999) {
                    return '至' + value + '周岁';
                } else if (value < 50 && value > 0) {
                    return value + '年';
                } else {
                    return '终身';
                }
            },
            //交费期间
            payYearFilter: function (value) {
                if (value === 1) {
                    return '趸交';
                } else if (value < 60) {
                    return value + '年交';
                } else {
                    return '至' + value + '周岁';
                }
            }
        },
        methods: {
            cjbdesc: function () {
                mui.openWindow({
                    url: '../pdf-modal.html',
                    id: 'pdf_modal',
                    show: animateObj.aniDetal,
                    extras: {
                        pdf: config.domain + '/static/file/cjb.pdf',
                        name: '恒大传家宝年金保险（万能型）产品说明书'
                    },
                    waiting: {
                        auto: false,
                    }
                });
            },
            //主险条款
            showStatement: function (id, name) {
                luckyAjax({
                    data: {
                        data: JSON.stringify({product_id: id}),
                        server: 'lifeProduct.getProductInfo'
                    },
                    success: function (data) {
                        plus.nativeUI.closeWaiting();
                        if (data.code === 1) {
                            if (data.data.statement) {
                                mui.openWindow({
                                    url: '../pdf-modal.html',
                                    id: 'pdf_modal',
                                    show: animateObj.aniDetal,
                                    extras: {
                                        pdf: data.data.statement,
                                        name: name
                                    },
                                    waiting: {
                                        auto: false,
                                    }
                                });
                            } else {
                                mui.toast('暂无条款详情', {duration: 'short', type: 'div'});
                                return false;
                            }
                        }
                    }
                })
            },
            //保存签名
            save_ins: function(type) {
                const vm = this
                var data = {}
                if (type == 1) {
                    data.img_json = {
                        '06': vm.appl_signature
                    }
                } else {
                    data.img_json = {
                        '07': vm.assu_signature
                    }
                }
                data.id = vm.war_id
                luckyAjax({
                    data: {
                        data: JSON.stringify(data),
                        server: 'PolicyIns.saveImg',
                        view: true,
                        device: 'mobile'
                    },
                    timeout: 10000,
                    success: function (res) {
                        if (res.code) {
                            mui.toast(res.msg, {duration: 'short', type: 'div'})
                        } else {
                            mui.toast(res.msg, {duration: 'short', type: 'div'})
                        }
                    }
                });
            },
            checkForm: function () {
                var toast_text = null;
                if (!this.appl_signature) {
                    toast_text = '投保人签名不能为空';
                } else if (this.assured.rel_insured_holder!==ISASSURED && !this.assu_signature) {
                    toast_text = '被保人签名不能为空';
                }
                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    return false;
                }
                return true;
            },
            getSignature: function (index,notoast) {
                var toast_text = null
                var vm = this
                if (!index) return
                // 获取签名的ajax
                luckyAjax({
                    data: {
                        data: JSON.stringify({policy_id: this.war_id}),
                        server: 'PolicyIns.edit',
                        device: 'mobile'
                    },
                    success: function (res) {
                        if (res.code) {
                            var image = res.data.insData.img_json
                            vm.orderinfo = res.data
                            if ( index === 1 && image['06']) {
                                toast_text = '成功获取投保人签名'
	                        	vm.appl_signature = config.domain + image['06']
                                vm.$set(vm.previewImg, 1, config.domain + image['06'])
	                        } else if ( index === 2 && image['07']) {
                                toast_text = '成功获取被保人签名'
                                vm.assu_signature = config.domain + image['07']
                                vm.$set(vm.previewImg, 2,  config.domain + image['07'])
	                        } else {
                                toast_text = '签名不存在'
                            }
                            if (toast_text && !notoast) {
                                mui.toast(toast_text, {duration: 'short', type: 'div'});
                                return false;
                            }
                        } else {
                            if (!notoast) {
                                mui.toast('签名不存在', {duration: 'short', type: 'div'});
                                return false;
                            }
                        }
                    }
                });
            },
        }
    })
</script>
</html>