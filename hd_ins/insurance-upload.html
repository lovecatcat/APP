<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/form.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
</head>

<body>

<div id="Js-content" class="mui-content BL-rel">
    <!--弹窗 begin-->
    <div class="ins-dialog md">
        <div class="dialog-header">
            <div class="mui-icon mui-icon-closeempty" id="close-ins-pop"></div>
            <p class="ins-font-md box-f-1">上传证件</p>
            <div class="header-btn-save">
                <button class="ins-btn sm-btn blue" id="saveUpload">保存</button>
            </div>
        </div>
        <div class="form-content margin-t-6_125 BL-pad-b-1">
            <div class="form-wrap">
                <div class="mui-row form-row">
                    <div class="mui-col-sm-6 BL-mar-b-1">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-r-1" model="appl_front_img" :style="previewImg[0]"
                                 data-id="0">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">投保人身份证正面</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-l-1" model="appl_negative_img" :style="previewImg[1]"
                                 data-id="1">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">投保人身份证反面</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1" v-show="assured.rel_insured_holder!==ISASSURED" v-if="assured.insured_ID_type===IDcard">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-r-1" model="assu_front_img" :style="previewImg[2]"
                                 data-id="2">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">被保人身份证正面</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1" v-show="assured.rel_insured_holder!==ISASSURED" v-if="assured.insured_ID_type===IDcard">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-l-1" model="assu_negative_img" :style="previewImg[3]"
                                 data-id="3">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">被保人身份证反面</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1" v-show="assured.rel_insured_holder!==ISASSURED" v-if="assured.insured_ID_type===BOOKLET">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-l-1" model="assu_booklet_img" :style="previewImg[4]"
                                 data-id="4">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">被保人户口本</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1" v-show="assured.rel_insured_holder!==ISASSURED" v-if="assured.insured_ID_type===BORNid">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-l-1" model="assu_born_img" :style="previewImg[5]"
                                 data-id="5">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">被保人出生证</span>
                        </div>
                    </div>
                    <div class="mui-col-sm-6 BL-mar-b-1">
                        <div class="BL-txt-c">
                            <div class="form-upload BL-mar-r-1" model="bank_front_img" :style="previewImg[6]"
                                 data-id="6">
                                <input type="file" accept="image/*" class="form-upload-img">
                            </div>
                            <span class="form-p BL-col-999">银行卡正面</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--弹窗 end-->
</div>
</body>
<script src="../js/mui.min.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script src="method.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    var popu;

    var img = new Vue({
        el: '#Js-content',
        data: {
            assured: {},
            previewImg: [],           //上传图片
            appl_front_img: '',   // 投保人身份证正面
            assu_front_img: '',   // 被保人身份证正面
            appl_negative_img: '', // 投保人身份证反面
            assu_negative_img: '', // 被保人身份证反面
            assu_booklet_img: '', // 被保人户口本
            assu_born_img: '', // 被保人出生证
            bank_front_img: '' //银行卡
        },
        methods: {
            sure: function () {
                var toastText = null
                if (!this.appl_front_img) {
                    toastText = '请上传投保人身份证正面照片'
                } else if (!this.appl_negative_img) {
                    toastText = '请上传投保人身份证反面照片'
                }
                if(this.assured.rel_insured_holder!==ISASSURED){
                    if (this.assured.insured_ID_type === IDcard && !img.assu_front_img) {
                        toastText = '请上传被保人身份证正面照片'
                    } else if (this.assured.insured_ID_type === IDcard && !img.assu_negative_img) {
                        toastText = '请上传被保人身份证反面照片'
                    } else if (this.assured.insured_ID_type === BOOKLET && !img.assu_booklet_img) {
                        toastText = '请上传被保人户口本照片'
                    } else if (this.assured.insured_ID_type === BORNid && !img.assu_born_img) {
                        toastText = '请上传被保人出生证照片'
                    }
                }
                if (!img.bank_front_img) {
                    toastText = '请上传银行卡正面照片'
                }
                if (toastText) {
                    mui.toast(toastText, {duration: 'short', type: 'div'})
                    return false;
                }
                return true
            }
        }
    })
    // 图片字段名
    const fileName = [
        'appl_front_img',
        'appl_negative_img',
        'assu_front_img',
        'assu_negative_img',
        'assu_booklet_img',
        'assu_born_img',
        'bank_front_img'
    ]
    mui.plusReady(function () {
        popu = new ClosePopu(); // 实例化关闭窗口对象

        var upload = plus.storage.getItem('hengda_upload') ? JSON.parse(plus.storage.getItem('hengda_upload')) : ''
        var assured = plus.storage.getItem('hengda_assured') ? JSON.parse(plus.storage.getItem('hengda_assured')) : ''
        img.assured = assured
        //赋值
        var tempName = {
            '00': 'appl_front_img',
            '01': 'appl_negative_img',
            '08': 'bank_front_img'
        }
        if (assured.rel_insured_holder!==ISASSURED && assured.insured_ID_type === IDcard) {
            tempName['02'] = 'assu_front_img'
            tempName['03'] = 'assu_negative_img'
        } else if (assured.rel_insured_holder!==ISASSURED && assured.insured_ID_type === BOOKLET) {
            tempName['04'] = 'assu_booklet_img'
        } else if (assured.rel_insured_holder!==ISASSURED && assured.insured_ID_type === BORNid) {
            tempName['05'] = 'assu_born_img'
        }
        for (var i in tempName) {
            var j = i === '08' ? 6 : Number(i)
            if (upload && upload[i]) {
                img[tempName[i]] = upload[i]
                img.$set(img.previewImg, j, {
                    'backgroundImage': 'url(' + upload[i] + ')'
                })
            }
        }
        //安卓监听返回事件
        plus.key.addEventListener("backbutton",function(){
            popu.closepop();
        });
        //保存
        document.querySelector('#saveUpload').addEventListener('tap', function () {
            if (!img.sure()) {
                return false
            }
            var img_json = {}
            img_json['00'] = img.appl_front_img
            img_json['01'] = img.appl_negative_img
            if(img.assured.insured_ID_type === IDcard ){
                img_json['02'] = img.assu_front_img
                img_json['03'] = img.assu_negative_img
            } else if(img.assured.insured_ID_type === BOOKLET){
                img_json['04'] = img.assu_booklet_img
            } else if(img.assured.insured_ID_type === BORNid){
                img_json['05'] = img.assu_born_img
            }
            img_json['08'] = img.bank_front_img
            plus.storage.setItem('hengda_upload', JSON.stringify(img_json));
            mui.fire(plus.webview.getWebviewById('hd_insurance-index'), 'saveFlag', {
                item:'hengda_upload',
                data: 'upload'
            });
            popu.closepop();
            mui.back();
        })
        //
        mui('body').on('tap', '#close-ins-pop', function () {
            // 关闭遮罩层，弹框
            popu.closepop();
        });

        mui('body').on('tap', '.form-upload', function (e) {
            var id = this.getAttribute('data-id')
            // 打开遮罩层，弹框
            showPopu("upload-img.html", "upload_img", "bottom", {id: id});
        });
    });

    //获取要上传的头像
    window.addEventListener('uploadimg', function (event) {
        img[fileName[event.detail.id]] = event.detail.img
        img.$set(img.previewImg, event.detail.id, {
            'backgroundImage': 'url(' + event.detail.img + ')'
        })
    })
</script>

</html>