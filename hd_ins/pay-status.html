<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
</head>

<body class="BL-bg-f2f">
<header id="Js-header" class="BL-bg-fff">
    <div class="BL-mod-headbar BL-mod-headbar-pos">
        <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
        <h1 class="BL-title">支付信息</h1>
    </div>
</header>
<div id="Js-content" class="mui-content BL-rel BL-overFlow-autoY" v-cloak>
    <div class="BL-mar-t-1" v-if="res">
        <div class="form-wrap">
            <div class="input-item ins-font-xs BL-col-ff8201">{{res.resultMsg}}</div>
        </div>
        <div class="form-wrap">
            <div class="input-item">
                <label class="">身份证号</label>
                <div class="input-wrap box-f-1">
                    <div class="input" style="border: none;">{{res.data.idNo}}</div>
                </div>
            </div>
            <div class="input-item">
                <label class="">手机号码</label>
                <div class="input-wrap box-f-1">
                    <input type="number" v-model="tel"
                           @blur="checkPhone" placeholder="请输入">
                    <div class="form-clear-icon" v-show="tel!=''"
                         @click="tel=''">
                        <span class="mui-icon mui-icon-clear"></span>
                    </div>
                </div>
            </div>
            <div class="input-item">
                <label class="">验证码</label>
                <div class="BL-ub BL-ub-pj BL-ub-f1">
                    <div class="input-wrap BL-ub-f1">
                        <input type="number" v-model="smscode">
                    </div>
                    <button class="right-btn orange" :disabled="disabled" @click="sendsms">{{text}}</button>
                </div>
            </div>
        </div>
        <div class="BL-mar-t-3 BL-pad-lr-1_5">
            <a type="button" @tap="sign" class="form-btn blue">签约</a>
        </div>
    </div>
</div>
</body>
<script src="../js/mui.min.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();

    var paystatus = new Vue({
        el: '#Js-content',
        data: function () {
            return {
                idNo: '',
                tel: '',
                res: '',
                smscode: '',
                disabled: false,
                second: 60,
                time: 0
            }
        },
        computed: {
            text: function () {
                return this.time > 0 ? this.time + 's后可重新获取' : '点击获取'
            }
        },
        methods:{
            sign: function () {
                if (!this.checkPhone()) {
                    return false
                }
            },
            checkPhone: function () {
                var phone = this.tel
                var toast_text = null;
                if (!phone) {
                    toast_text = '手机号码不能为空';
                } else if (!/^1[3-9][0-9]{9}$/.test(phone)) {
                    toast_text = '手机号码格式不对';
                }
                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    return false;
                }
                return true
            },
            //07发送验证码
            sendsms: function () {
                const vm = this
                console.log('sendsms')
                luckyAjax({
                    data: {
                        data: JSON.stringify({
                            msg: {policy_id: vm.war_id, mobile: vm.tel},
                            company_code: 'HengDa',
                            method: 'applyForSign'
                        }),
                        server: 'PolicyIns.onlineInsured',
                        device: 'mobile',
                        view: true
                    },
                    timeout: 30000,
                    success: function (res) {
                        //
                    }
                });
            },
            run: function () {
                this.time = this.second
                this.timer()
            },
            sended: function () {
                this.run()
                this.disabled = true
            },
            timer: function () {
                if (this.time > 0) {
                    this.time--
                    setTimeout(function () {
                        img.timer()
                    }, 1000)
                } else {
                    this.disabled = false
                }
            }
        }
    })

    mui.plusReady(function () {
        statusbar();
        var winH = window.innerHeight;
        var titHeight = document.querySelector('#Js-header').offsetHeight;
        document.querySelector('#Js-content').style.height = winH - titHeight + 'px';

        var res = plus.webview.currentWebview().data;
        var war_id = plus.webview.currentWebview().war_id;
        var tel = plus.webview.currentWebview().tel;
        paystatus.res = res
        paystatus.war_id = war_id
        paystatus.tel = tel
    })

</script>
</html>