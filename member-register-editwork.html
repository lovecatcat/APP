<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>基本信息</title>
    <link href="css/mui.css" rel="stylesheet" />
    <link href="css/common.css" rel="stylesheet" />
    <link href="css/module.css" rel="stylesheet" />
    <link href="css/form.css" rel="stylesheet" />
    <script src="js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
</head>

<body class="BL-bg-f2f">
    <header id="Js-header" class="BL-bg-fff">
        <div class="BL-mod-headbar BL-mod-headbar-pos">
            <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
            <h1 class="BL-title">工作经历</h1>
            <div class="control">
                <a>编辑</a>
            </div>
        </div>
    </header>
    <div id="Js-content" class="mui-content BL-rel BL-overFlow-autoY" v-cloak>
        <div class="mui-table-view form-list-cell BL-mar-t-1">
            <a href="javacript:void(0);" class="fItem BL-ub BL-ub-f1" @click="addWork">
                <div class="form-list-label BL-ub-f1 BL-col-3b9cf5 BL-txt-c">+工作经历</div>
            </a>
        </div>
        <ul v-if="work_on" class="mui-table-view mui-table-view-chevron form-list-cell BL-mar-t-1">
            <li v-for="(item,index) in work_on"  class="mui-table-view-cell mui-media" :class="{'edit-active':delShow}">
                <span class="chevron-del" v-show="delShow" @click="delWork(index)"></span>
                <div class="mui-navigate-right" href="javascript:;">
                    <div class="mui-media-body">
                        {{ item.name }}
                        <p class="mui-ellipsis">{{ item.start.split('-').join('/') }} - {{ item.end.split('-').join('/') }}</p>
                    </div>
                </div>
                <span class="chevron-edit" v-show="editShow" @click="editWork(index,item)">修改</span>
            </li>
        </ul>
    </div>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/mui.picker.js"></script>
<script src="js/mui.dtpicker.js"></script>
<script src="js/mui.poppicker.js"></script>
<script src="js/vue.min.js"></script>
<script src="js/Date.js"></script>
<script type="text/javascript">
    mui.init({
        preloadPages:[{
            id:'member_register_addwork',
            url:'member-register-addwork.html'
        }]
    });
    mui.plusReady(function() {
        statusbar();
        var winH = window.innerHeight;
        var titHeight = document.querySelector('#Js-header').offsetHeight;
        document.querySelector('#Js-content').style.height = winH - titHeight + 'px';

        var info = new Vue({
            el: '#Js-content',
            data: {
                work_on: [],
                editShow: false,
                delShow: false,
                txt: '编辑'
            },
            mounted: function (){
                var vm = this;
                // 接收
                vm.work_on = plus.webview.currentWebview().work_on;
                //点击编辑
                document.querySelector('.control a').addEventListener('tap', function() {
                    var txt = this.innerHTML
                    this.innerHTML = txt == '编辑' ? '完成' : '编辑'
                    vm.delShow = !vm.delShow
                    vm.editShow = !vm.editShow
                }, false);
            },
            methods: {
                delWork: function (index) {
                    this.work_on.splice(index, 1)
                },
                addWork: function () {
                    mui.openWindow({
                        url: 'member-register-addwork.html',
                        id: 'member_register_addwork',
                        show: animateObj.aniDetal
                    })
                    setTimeout(function () {
                        plus.webview.currentWebview().close();
                    },200)
                },
                editWork: function (index, item) {
                    var vm = this;
                    item['index'] = index

                    // 通知
                    mui.fire(plus.webview.getWebviewById('member_register_addwork'),'editWork',{
                        w_item: item
                    });

                    mui.openWindow({
                        url: 'member-register-addwork.html',
                        id: 'member_register_addwork',
                        show: animateObj.aniDetal
                    })

                    setTimeout(function () {
                        plus.webview.currentWebview().close();
                    },200)
                }
            }
        })

        mui.back=function () {
            setTimeout(function(){
                plus.webview.currentWebview().close();
            },500);
            mui.fire(plus.webview.getWebviewById('member_register'),'refreshWork',{
                work_on: info.work_on
            });
        }
    })
</script>
</html>
