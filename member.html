<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<link href="css/member.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
	</head>

	<body class="member-skin">
		<div class="member-hr">
			<!--占位符，默认背景高度-->
		</div>
		<header id="Js-header">
			<div class="BL-mod-headbar BL-mod-headbar-pos BL-noBorder-b">
				<h1 class="BL-title"></h1>
				<div class="control">
					<a href="member-setup.html" data-wid="member_setup" data-ani="true" class="BL-col-fff">设置</a>
				</div>
			</div>
		</header>

		<div id="Js-content" class="BL-overFlow-autoY member-index">
		    <a href="member-personalinfo.html" data-wid="member_personalinfo" data-ani="true"
		       class="BL-ub BL-ub-ac BL-ub-pj mheader">
		        <div class="info BL-ub BL-ub-ac" v-if="userinfo">
		            <div class="topic">
		                <img :src="userinfo.avatar" @error="nofind">
		            </div>
		            <div class="context">
		                <div class="name">{{userinfo.user_name}}</div>
		                <div class="text"><span>{{userinfo.dept_name}}</span> &nbsp;&nbsp;|&nbsp;&nbsp;
		                    <span>{{userinfo.tel}}</span>
		                </div>
		            </div>
		        </div>
		        <div class="mui-icon mui-icon-arrowright"></div>
		    </a>
	    	<div class="mbody">
		        <div class="section section-myList">
		            <div class="BL-ub BL-ub-ac BL-ub-pj myList-hd">
		                <div class="title">我的订单</div>
		                <!--<a class="mui-icon mui-icon-arrowright"></a>-->
		            </div>
		            <div class="BL-ub BL-ub-ac BL-ub-f1">
		                <!--<a href="member-auto-order.html" data-wid="member_auto_order" class="BL-ub BL-ub-ac BL-ub-pc BL-ub-f1 myList-item">-->
		                <a class="BL-ub BL-ub-ac BL-ub-pc BL-ub-f1 myList-item" @tap="toastMsg">
							<div class="item item-car">
		                        <div class="icon"></div>
		                        <div class="name">
		                            	车险订单
		                        </div>
		                    </div>
		                </a>
		                <a href="member-life-order.html" data-wid="member_life_order" class="BL-ub BL-ub-ac BL-ub-pc BL-ub-f1 myList-item">
		                    <div class="item item-life">
		                        <div class="icon"></div>
		                        <div class="name">
		                            	寿险订单
		                        </div>
		                    </div>
		                </a>
		            </div>
		        </div>
				<div class="section section-manage">
					<div class="mui-row manage-group" v-if="menuitems" v-cloak>
						<div class="mui-col-sm-3 mui-col-xs-3" v-for="item in menuitems" v-show="memberItems.indexOf(item.module_sn)>-1&&item.state">
							<a :href="item.html" :data-wid="item.wid" class="a-link" v-if="item.is_complete">
								<div class="icon" :style="'backgroundImage: url('+ item.img_url_head+')'">&nbsp;</div>
								<div class="name">{{item.module_name}}</div>
							</a>
							<a @tap="toastMsg()" v-else>
								<div class="icon" :style="'backgroundImage: url('+ item.img_url_head+')'">&nbsp;</div>
								<div class="name">{{item.module_name}}</div>
							</a>
						</div>
					</div>
				</div>
				<div class="section section-manage">
					<div class="mui-row manage-group" v-if="menuitems" v-cloak>
						<div class="mui-col-sm-3 mui-col-xs-3" v-for="item in menuitems" v-show="memberItems2.indexOf(item.module_sn)>-1&&item.state">
							<a :href="item.html" :data-wid="item.wid" class="a-link" v-if="item.is_complete">
								<div class="icon" :style="'backgroundImage: url('+ item.img_url_head+')'">&nbsp;</div>
								<div class="name">{{item.module_name}}</div>
							</a>
							<a @tap="toastMsg()" v-else>
								<div class="icon" :style="'backgroundImage: url('+ item.img_url_head+')'">&nbsp;</div>
								<div class="name">{{item.module_name}}</div>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script src="js/vue.min.js" type="text/javascript"></script>
	<script type="text/javascript">
    mui.init();

    //主列表点击事件
    mui('body').on('tap', 'a', function () {
        var href = this.getAttribute('href');
        var id = this.getAttribute("data-wid");
        var anIn = this.getAttribute('data-ani'); // 使用fadeIn打开新页面
//      alert(id)

        //非plus环境，直接走href跳转
        if (!mui.os.plus) {
            location.href = href;
            return;
        }

        if (href && ~href.indexOf('.html')) {
            //打开新窗口
            if (anIn) {
                mui.openWindow({
                    url: href,
                    id: id,
                    show: animateObj.aniDetal
                });
            } else {
                mui.openWindow({
                    url: href,
                    id: id,
                    show: animateObj.aniPage
                });
            }
        }
    });

    var member = new Vue({
        el: '#Js-content',
        data: {
            userinfo: '',
			menuitems: '',
            memberItems: ['warranty','team','plans','commission','intergral','birthday','renewal','duty'],
            memberItems2: ['requirement','taxcal','clips','poster'],
			itemlink:{
                'warranty':{
                    'html':'member-warranty-manage.html',
					'wid': 'member_warranty_manage'
				},
                'team':{
                    'html':'member-team.html',
                    'wid': 'member_team'
                },
                'plans':{
                    'html':'member-plans-manage.html',
                    'wid': 'member_plans_manage'
                },
                'commission':{
                    'html':'member-commission-account.html',
                    'wid': 'member_commission_account'
                },
                'intergral':{
                    'html':'member-intergral.html',
                    'wid': 'member_intergral'
                },
                'birthday':{
                    'html':'member-birthday.html',
                    'wid': 'member_birthday'
                },
                'renewal':{
                    'html':'member-renewal.html',
                    'wid': 'member_renewal'
                },
                'duty':{
                    'html':'member-duty.html',
                    'wid': 'member_duty'
                },
                'requirement':{
                    'html':'requirement.html',
                    'wid': 'requirement'
                },
                'taxcal':{
                    'html':'member-tax-cal.html',
                    'wid': 'member_tax_cal'
                },
                'clips':{
                    'html':'member-clips.html',
                    'wid': 'member_clips'
                },
                'poster':{
                    'html':'member-poster.html',
                    'wid': 'member_poster'
                }
			}
        },
        methods:{
        	toastMsg: function () {
                mui.toast('功能开发中，敬请期待', {duration: 'short', type: 'div'})
                return false;
            }
        }
    })

    mui.plusReady(function () {
//        isLogin();
        var userinfo = plus.storage.getItem('userinfo') ? JSON.parse(plus.storage.getItem('userinfo')) : '';
        member.userinfo = userinfo;
        window.addEventListener('reload', function () {
            member.userinfo = plus.storage.getItem('userinfo') ? JSON.parse(plus.storage.getItem('userinfo')) : '';
        });

        window.addEventListener('loadpageMember', function (e) {
            setTimeout(function () {
                statusbar();
                var winH = window.innerHeight;
                var titHeight = document.querySelector('#Js-header').offsetHeight;
                var hrHeight = document.querySelector('.member-hr').offsetHeight;
                document.querySelector('#Js-content').style.height = (winH - titHeight) + 'px';
                document.querySelector('.mheader').style.height = (hrHeight - titHeight) + 'px';
            }, 100);
        })
		//菜单显隐
        window.addEventListener('showmenu', function (event) {
			var data = event.detail.data ? JSON.parse(event.detail.data) : ''
            mui.each(data, function (index, item) {
                if (member.itemlink[item.module_sn]) {
                    item.html = member.itemlink[item.module_sn].html
                    item.wid = member.itemlink[item.module_sn].wid
                }
            })
            member.menuitems = data
			console.log(JSON.stringify(data))
            member.$nextTick(function () {
                statusbar();
                var winH = window.innerHeight;
                var titHeight = document.querySelector('#Js-header').offsetHeight;
                var hrHeight = document.querySelector('.member-hr').offsetHeight;
                document.querySelector('#Js-content').style.height = (winH - titHeight) + 'px';
                document.querySelector('.mheader').style.height = (hrHeight - titHeight) + 'px';
            })
        })

    })
    function nofind() {
        var img = event.srcElement;
        img.src = "images/icon/avatar-default.png";
        img.onerror = null; //控制不要一直跳动
    }

</script>

</html>