<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>发现</title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<link href="css/news.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
	</head>

	<body class="BL-bg-f2f" >
		<header id="Js-header" class="BL-bg-fff">
			<div class="BL-mod-headbar BL-mod-headbar-pos">
				<a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
				<h1 class="BL-title">发现</h1>
				<a id="Js-openShare" class="BL-icon BL-icon-share"></a>
			</div>
		</header>
		
		<div id="Js-content"  class="mui-content BL-rel" v-cloak>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll news-detail">
					<div class="news-detail-contain">
						<div class="hd">
							<div class="title">
							{{newsDetail_data.title}}
							</div>	
							<div class="date">
								<span style="padding-right: .5rem;">
									{{newsDetail_data.create_time}} 
								</span>	
								<span>
									{{newsDetail_data.type_name}}
								</span>
							</div>
						</div>
						<div class="bd BL-pasual content" v-html="newsDetail_data.content">
							<img src="images/pic/p9.jpg" />
							<!--<div style="text-indent: 2rem;">
								冬季，正是吃柚子、橘子、橙子的时候，这些个头上看上去差不多，味道也都是酸酸甜甜的，可是，它们的营养价值却相差了十万八千里。
							</div><br />
							<div><img src="images/pic/p9.jpg" /></div><br />
							<div>1、柚子性寒最祛火，辅助降三高</div><br />
							<div style="text-indent: 2rem;">
							柚子家族有多个兄弟，红心柚、溪蜜柚、水晶柚、
沙田柚、西柚等。中医认为，柚子果肉性寒，味甘、酸
有止咳平喘、清热化痰、健脾消食、解酒除烦、食用柚
子有一定的去火功效。	
							</div>-->
						</div>
					</div>
				</div> 
			</div> 	
			<footer id="Js-footer" class="BL-footer BL-bg-fff">
				<div class="BL-ub BL-ub-pc">
					<div class="BL-ub BL-ub-pj" style="width: 50%;">
						<div class="reads">
							{{newsDetail_data.read_num}}
						</div>
						<div class="collect" :class="{'active': newsDetail_data.is_enshrine == '1'}" :data-enshrine="newsDetail_data.is_enshrine">
							<!--{{newsDetail_data.praise_num}}-->
						</div>
					</div>
				</div>
			</footer>
		</div>
	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/mui.zoom.js" ></script>
	<script type="text/javascript" src="js/mui.previewimage.js" ></script>
	<script src="js/vue.min.js"></script>
	<script src="js/plusShare.js"></script>
	
	<script type="text/javascript">
        mui.init();
		var newsDetail = new Vue({
			el: '#Js-content',
			data: {
				newsDetail_data: {}, // 列表数据
                operate: false
			}
		});

		//非plus环境
		if(!mui.os.plus) {
			mui.previewImage(); // H5 非原生图片预览		
		}
		
		mui('.mui-scroll-wrapper').scroll({
			scrollY: true, //是否竖向滚动
			scrollX: false, //是否横向滚动
			startX: 0, //初始化时滚动至x
			startY: 0, //初始化时滚动至y
			indicators: false, //是否显示滚动条
			deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
			bounce: false //是否启用回弹
		});
		
		mui.plusReady(function() {
			
			statusbar();
			
			var winH = window.innerHeight;
			var titHeight = document.querySelector('#Js-header').offsetHeight;
			var fotHeight = document.querySelector('#Js-footer').offsetHeight;
			document.querySelector('#Js-content').style.height = winH - titHeight - fotHeight + 'px';


			var parent_id = ""
			//添加productId自定义事件监听
            window.addEventListener('newsId', function (event) {
                mui('.mui-scroll-wrapper').scroll().scrollTo(0, 0);
                //获得事件参数
                var id = event.detail.id;
				parent_id = event.detail.parent_id;

                //100毫秒滚动到顶
                mui('.mui-scroll-wrapper').scroll().scrollTo(0, 0, 100);

                //根据id向服务器请求新闻详情
                luckyAjax({
                    data: {
                        server: 'Information.content',
                        device: 'mobile',
                        view: false,
                        data: JSON.stringify({id: id})
                    },
                    success: function (res) {
                        if (res.code == 1) {
                            newsDetail.newsDetail_data = res.data
                            newsDetail.$nextTick(function () {
                                var images = [].slice.call(document.querySelectorAll('.content img'));
                                images.forEach(function (item) {
                                    item.setAttribute('data-preview-src', item.src)
                                    item.setAttribute('data-preview-group', id)
                                });
                                mui.previewImage();
                            })
                        } else {
                            console.log(res.msg)
                        }
                    }
                });
            });
			
			// 点赞
//			document.querySelector('.goods').addEventListener('tap', function() {
//				luckyAjax({
//					data: {
//			            server: 'Information.praise',
//			           	view: true,
//			           	data: JSON.stringify({id: newsDetail.newsDetail_data.id})
//			        },
//			        success:function(res){
//			        	if(res.code == 1) {
//							newsDetail.newsDetail_data.praise_num = res.data.praise_num
//						} else{
//							console.log(res.msg)
//						}
//			        }
//				});
//			});
			// 收藏
            document.querySelector('.collect').addEventListener('tap', function() {
            	var _this = this
                var enshrine = _this.getAttribute('data-enshrine')
                var type = (enshrine == '1')? '0' : '1'
                luckyAjax({
                    data: {
                        server: 'information.enshrine',
                        data: JSON.stringify({
							info_id: newsDetail.newsDetail_data.id,
                            type: type
                        })
                    },
                    success:function(res){
                        if(res.code == 1) {
                            newsDetail.operate = !newsDetail.operate
                            enshrine == '1' ? newsDetail.newsDetail_data.is_enshrine = '0' : newsDetail.newsDetail_data.is_enshrine = '1'
                            mui.toast(res.msg, {duration: 'short', type: 'div'})
                        } else{
                            mui.toast(res.msg, {duration: 'short', type: 'div'})
                        }
                    }
                });
            });

            // 自定义返回事件
            oldBack = mui.back;

            mui.back = function () {
                if (parent_id == 'requirement' && newsDetail.operate) {
                    mui.fire(plus.webview.getWebviewById('requirement'), 'reload');
                    newsDetail.operate = !newsDetail.operate

                    setTimeout(function(){
                        plus.webview.currentWebview().hide();
                    },500);
				} else {
                    oldBack()
				}

            }

			document.getElementById("Js-openShare").addEventListener("tap", function() {
			    //分享内容，开发者可自定义
			    var message = {
			        title: newsDetail.newsDetail_data.title, //名字
			        content: "藏保图 ——为保险展业创造无限可能",
			        href: config.domain + "/share/AppShare.html#/Newsdetail?newId="+newsDetail.newsDetail_data.id, //分享出去后，点击跳转地址
			        thumbs: ["_www/images/pic/logo.png"] //分享缩略图
			    }
			    //调起分享
			    plusShare(message, function(res) {
			        //分享回调函数
			        if(res) {
			            plus.nativeUI.toast("分享成功");
			        } else {
			            plus.nativeUI.toast("分享失败");
			        }
			    })
			});
		})
	</script>

</html>