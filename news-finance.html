<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<link href="css/news.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
	</head>

	<body class="BL-bg-fff">

		<!------------资讯列表 begin------------->
		<div id="Js-newsList" class="news-list">
			<div class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<!--活动中，数据列表-->
					<ul class="mui-table-view news-list-cell">
						<li class="nItem">
							<a data-id="111" data-wid="news_detail" href="news-detail.html" class="BL-ub BL-ub-f1">
								<div class="img">
									<img src="images/pic/p7.jpg" />
								</div>
								<div class="context BL-ub BL-ub-ver BL-ub-f1">
									<h1 class="tit"><span class="tit-badg tit-badg-hot">热门</span>惠州龙门大观园温泉，鲁冰花童话园2日游</h1>
									<div class="name">行业资讯</div>
								</div>
							</a>
						</li>
						<li class="nItem">
							<a data-id="2" data-wid="news_tv_detail" href="news-tv-detail.html" class="BL-ub BL-ub-f1">
								<div class="img">
									<img src="images/pic/p7.jpg" />
								</div>
								<div class="context BL-ub BL-ub-ver BL-ub-f1">
									<h1 class="tit"><span class="tit-badg tit-badg-tv">视频</span>最补血的居然不是红枣！真正的“补血之王”原来是它</h1>
									<div class="name">公司VCR</div>
								</div>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!------------资讯列表 end  ------------->

	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script src="js/mui.pullToRefresh.js"></script>
	<script src="js/mui.pullToRefresh.material.js"></script>
	<script type="text/javascript">
		mui.init();
		
		(function($){
			//阻尼系数
			var deceleration = mui.os.ios ? 0.003 : 0.0009;
			$('#Js-newsList .mui-scroll-wrapper').scroll({
				bounce: true,
				indicators: false, //是否显示滚动条
				deceleration: deceleration
			});
			
			$.ready(function() {
				var winH = window.innerHeight;
				document.querySelector('#Js-newsList').style.height = winH + 'px';

				var i = 0;

				//循环初始化所有下拉刷新，上拉加载。
				
				$('#Js-newsList .mui-scroll').pullToRefresh({
						up: { // 上拉加载更多
							auto: true, // 自动上拉一次
							callback: function() {
								i++;

								var self = this;
								setTimeout(function() {
									var ul = self.element.querySelector('.mui-table-view');
									ul.appendChild(createFragment(ul, 5));
									if(i > 2) {
										self.endPullUpToRefresh(true);
									} else {
										self.endPullUpToRefresh();
									}
								}, 1000);
							}
						}
				});
				
				var createFragment = function(ul, count) {
					var length = ul.querySelectorAll('li').length;
					var fragment = document.createDocumentFragment();
					var li;
					for(var i = 0; i < count; i++) {
						li = document.createElement('li');
						li.className = 'nItem';
						li.innerHTML = '<a data-wid="news_detail" href="news-detail.html" class="BL-ub BL-ub-f1">' +
						'<div class="img"><img src="images/pic/p7.jpg" /></div>' +
						'<div class="context BL-ub BL-ub-ver BL-ub-f1"><h1 class="tit">惠州龙门大观园温泉，鲁冰花童话园2日游</h1>' +
						'<div class="name">行业资讯</div></div></a>';
						fragment.appendChild(li);
					}
					return fragment;
				};

			});	
		
		}(mui));
		
		//主列表点击事件
		var detailPage = null;
		mui('body').on('tap', 'a', function() {
			var href = this.getAttribute('href');
			var id = this.getAttribute("data-wid");
			var pid = this.getAttribute('data-id');

			//非plus环境，直接走href跳转
			if(!mui.os.plus) {
				location.href = href;
				return;
			};

			if(href && ~href.indexOf('.html')) {

				if(pid) {
					//获得详情页面
					if(!detailPage) {
						detailPage = plus.webview.getWebviewById(id);
					}
					//触发详情页面的newsId事件
					mui.fire(detailPage, 'newsId', {
						id: pid
					});
				};

				//打开新窗口
				mui.openWindow({
					id:id,
					show:animateObj.aniDetal
				});
			}

		});

	</script>

</html>