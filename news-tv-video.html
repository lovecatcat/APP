<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>发现</title>
	<link href="css/mui.css" rel="stylesheet" />
	<link href="css/common.css" rel="stylesheet" />
	<link href="css/module.css" rel="stylesheet" />
	<link href="css/news.css" rel="stylesheet" />
	<script src="js/config.js" type="text/javascript"></script>
</head>

<body class="BL-bg-f2f">
	<header id="Js-header" class="BL-bg-fff">
		<div class="BL-mod-headbar BL-mod-headbar-pos">
			<a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
				<h1 class="BL-title">发现</h1>
			<a id="Js-openShare" class="BL-icon BL-icon-share"></a>
		</div>
	</header>

	<footer id="Js-footer" class="BL-footer BL-bg-fff">
		<div class="BL-ub BL-ub-pc">
			<div class="BL-ub BL-ub-pj" style="width: 50%;">
				<div class="reads">
				{{ read_num }}
				</div>
				<div class="collect" :class="{'active': is_enshrine == '1'}" :data-enshrine="is_enshrine">
				<!--{{newsDetail_data.praise_num}}-->
				</div>
			</div>
		</div>
	</footer>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/vue.min.js"></script>
<script src="js/plusShare.js"></script>
<script type="text/javascript">
    mui.init();
    var parent_id = ""
    var newsDetail = new Vue({
        el: '#Js-footer',
        data: {
            new_id: "", //视频新闻ID-
            link: "",// 新闻链接
            title: "",    // 新闻标题
            read_num: "", // 阅读量
            is_enshrine: "", // 是否收藏
            operate: false   // 是否操作
        }
    });

    (function($) {
        $.plusReady(function() {

            statusbar();
            var topHeight = document.getElementById('Js-header').offsetHeight / sizeObj.dpl;
            var footHeight = document.getElementById('Js-footer').offsetHeight / sizeObj.dpl;

            newsDetail.video_url = plus.webview.currentWebview().video_url
            newsDetail.title = plus.webview.currentWebview().title
            newsDetail.new_id = plus.webview.currentWebview().new_id
            newsDetail.read_num = plus.webview.currentWebview().read_num
            newsDetail.is_enshrine = plus.webview.currentWebview().is_enshrine

            parent_id = plus.webview.currentWebview().parent_id

            var embed = plus.webview.create(newsDetail.video_url, '', {
                top: topHeight + 'px',
                bottom: footHeight + 'px'
            });
            plus.webview.currentWebview().append(embed);

        });
    })(mui);

    // 自定义返回事件
    oldBack = mui.back;

    mui.back = function () {
        if (parent_id == 'requirement'&& newsDetail.operate) {
            mui.fire(plus.webview.getWebviewById('requirement'), 'reload');
            newsDetail.operate = !newsDetail.operate

            setTimeout(function(){
                plus.webview.currentWebview().hide();
            },500);
        } else {
            oldBack()
        }
    }

    // 收藏
    document.querySelector('.collect').addEventListener('tap', function() {
        var _this = this
        var enshrine = _this.getAttribute('data-enshrine')
        var type = (enshrine == '1')? '0' : '1'
        luckyAjax({
            data: {
                server: 'information.enshrine',
                data: JSON.stringify({
                    info_id: newsDetail.new_id,
                    type: type
                })
            },
            success:function(res){
                if(res.code == 1) {
                    newsDetail.operate = !newsDetail.operate
                    enshrine == '1' ? newsDetail.is_enshrine = '0' : newsDetail.is_enshrine = '1'
                    plus.nativeUI.toast(res.msg);
                } else{
                    plus.nativeUI.toast(res.msg);
                }
            }
        });
    });
    // 分享
    document.getElementById("Js-openShare").addEventListener("tap", function() {
		//分享内容，开发者可自定义
		var message = {
			title: newsDetail.title, //名字
    		content: "藏保图 ——为保险展业创造无限可能",
    		href: newsDetail.video_url, //分享出去后，点击跳转地址
		    thumbs: ["_www/images/pic/logo.png"] //分享缩略图
		}
		    //调起分享
		plusShare(message, function(res) {
			//分享回调函数
			if(res) {
				plus.nativeUI.toast("分享成功");
			} else {
				plus.nativeUI.toast("分享失败");
			}
		})
	});
</script>
</html>