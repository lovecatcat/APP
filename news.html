<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="css/mui.css" rel="stylesheet"/>
    <link href="css/common.css" rel="stylesheet"/>
    <link href="css/module.css" rel="stylesheet"/>
    <link href="css/news.css" rel="stylesheet"/>
    <script src="js/config.js" type="text/javascript"></script>
</head>

<body class="BL-bg-f2f">


	<header id="Js-header" class="BL-bg-fff">
	    <!--<div class="BL-mod-headbar">
	        <div class="BL-ub BL-ub-ac headbar-search">
	            <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
	            <div class="search search-pro BL-ub BL-ub-ac BL-ub-f1">
	                <input type="search" name="Js-search" id="Js-search" value="搜索关键词" class="BL-ub BL-ub-f1"/>
	                <div class="button">
	                    <span class="BL-bimg-contain">&nbsp;</span>
	                </div>
	            </div>
	        </div>
	    </div>-->
	    <div class="BL-mod-headbar BL-mod-headbar-pos">
	        <h1 class="BL-title">发现</h1>
	        <a class="BL-icon BL-icon-search"></a>
	    </div>
	</header>

	<div id="Js-content" class="mui-content">
	    <div class="BL-pad-t-1">
	        <!--分类栏目 begin-->
	        <div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted BL-segmented-control">
	            <div class="mui-scroll">
	                <a data-id="0" data-wid="news_all.html" class="mui-control-item mui-active">
	                    <span>全部</span>
	                </a>
	                <a data-id="1" data-wid="news_cloud.html" class="mui-control-item">
	                    <span>云课堂</span>
	                </a>
	                <a data-id="2" data-wid="news_business.html" class="mui-control-item">
	                    <span>行业资讯</span>
	                </a>
	                <a data-id="3" data-wid="news_finance.html" class="mui-control-item">
	                    <span>财经报道</span>
	                </a>
	                <a data-id="4" data-wid="news_cream.html" class="mui-control-item">
	                    <span>精英榜</span>
	                </a>
	            </div>
	        </div>
	        <!--分类栏目 end -->
	    </div>
	</div>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/webviewGroup.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();

    mui.plusReady(function () {
    	statusbar();
        mui.preload({ // 预加载资讯详情页
            url: 'news-detail.html',
            id: 'news_detail', // id
        });

        mui.preload({ // 预加载资讯详情页
            url: 'news-tv-detail.html',
            id: 'news_tv_detail', // id
        });
        
        var user_id = JSON.parse(plus.storage.getItem("userinfo")).id
        var winH = window.screen.height;
        var navHeight = localStorage.getItem('navHeight');
        var topHeight = document.querySelector('#Js-header').offsetHeight;
        var divHeight = document.querySelector('#Js-content').offsetHeight;
        var _divH = Number(topHeight) / sizeObj.dpl + Number(divHeight) / sizeObj.dpl;
        var _viewH = Number(winH) / sizeObj.dpl - _divH - Number(navHeight) / sizeObj.dpl; // 内容区域高度
        var _self = plus.webview.currentWebview();
        var pid,wid;
		
        window.addEventListener('loadpage', function () {
        	
            var group = new webviewGroup(_self.id, {
                topHeight: _divH,
                viewHeight: _viewH,
                items: [{
                    id: "news_all.html",
                    url: "news-all.html",
                    extras: {}
                }, {
                    id: "news_cloud.html",
                    url: "news-cloud.html",
                    extras: {}
                }, {
                    id: "news_business.html",
                    url: "news-business.html",
                    extras: {}
                }, {
                    id: "news_finance.html",
                    url: "news-finance.html",
                    extras: {}
                }, {
                    id: "news_cream.html",
                    url: "news-cream.html",
                    extras: {}
                }],
                onChange: function (obj) {
                    var c = document.querySelector(".mui-control-item.mui-active");
                    if (c) {
                        c.classList.remove("mui-active");
                    }
                    var target = document.querySelector(".mui-scroll .mui-control-item:nth-child(" + (parseInt(obj.index) + 1) + ")");
                    target.classList.add("mui-active");
                    if (target.scrollIntoView) {
                        target.scrollIntoView();
                    }
                }
            });
        	
        	// 添加二级菜单弹窗
        	var sidemenu = plus.webview.create('news-sidemenu.html', 'news_sidemenu',{
        		top:_divH,
        		height:_viewH,
        		bottom:0,
        		background:'transparent'
        	});
        
	        mui(".mui-scroll").on("tap", ".mui-control-item", function (e) {
	            pid = this.getAttribute("data-id");
	            wid = this.getAttribute("data-wid");
	            group.switchTab(wid);
	            /*if(wid=='news_all.html'){
	            	// 若类型：全部，则不显示下拉菜单
	            	mui('.mui-control-item').each(function(){
		    			this.classList.remove('old-active');
		    		});
	            	mui('.mui-control-item')[0].classList.add('old-active');
	            	sidemenu.hide();	
	            	group.switchTab(wid);
	            }else{
	            	// 若类型：其他菜单项，显示下拉菜单，且通知发送窗口通讯，传输类型ID
	            	sidemenu.show();
	            	mui.fire(sidemenu, 'sidemenuId', {
	            		id:pid	
	            	})
	            };*/
	        });
	        
	        window.addEventListener('closeSidemenu', function(){
	        	//关闭下拉菜单
	    		sidemenu.hide();
	    		
	    		mui('.mui-control-item').each(function(){
	    			//console.log(this.classList)
	    			if(this.className.indexOf('old-active') > -1){
	    				this.classList.add('mui-active');
	    			}else{
	    				this.classList.remove('mui-active');
	    			}
	    		});
	    		
	    	}, false);
	        
	        window.addEventListener('itemCurrentId', function(data){
	        	// 接收到二级菜单回传的ID，关闭下拉菜单，切换指定的tab页面，加载数据
	    		sidemenu.hide();
	            group.switchTab(wid);
	            
	            mui('.mui-control-item').each(function(){
	    			this.classList.remove('old-active');
	    		});
	            mui('.mui-control-item')[pid].classList.add('old-active');
	            
//	            mui.fire(wid, 'newTabPage', {
//	            	id:data.detail.nid	
//	            });
	    	}, false);
	        
          	
	        
		});
    })

</script>

</html>