<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>职业分类搜索</title>
    <link href="css/mui.css" rel="stylesheet" />
    <link href="css/common.css" rel="stylesheet" />
    <link href="css/module.css" rel="stylesheet" />
    <link href="css/form.css" rel="stylesheet" />
    <script src="js/config.js" type="text/javascript"></script>
    <style>
		#Js-search.BL-mod-headbar {
            height: 5.5rem;
        }
        .BL-mod-headbar .headbar-search {
            padding: 1.1875rem 1.4375rem;
        }
        .BL-mod-headbar .headbar-search .search {
            margin-left: 1rem;
            border-radius: 1.5rem;
            -webkit-border-radius: 1.5rem;
        }
    </style>
</head>
<body class="BL-bg-f2f">
    <header id="Js-header" class="BL-bg-fff">
        <div class="BL-mod-headbar BL-mod-headbar-pos">
            <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
            <h1 class="BL-title">职业分类表</h1>
        </div>
    </header>
    <div id="Js-main" v-cloak>
	    <div id="Js-search" class="BL-mod-headbar BL-bg-fff">
	        <div class="BL-ub BL-ub-ac headbar-search">
	            <span class="BL-ftz-48" v-if="name">{{ name }}</span>
	            <div class="search search-pro BL-ub BL-ub-ac BL-ub-f1">
	                <input type="search" placeholder="搜索职业" class="BL-ub BL-ub-f1" v-model="keyword" @keyup.enter="queryJob" />
	                <div class="button" @click="queryJob">
	                    <span class="BL-bimg-contain">&nbsp;</span>
	                </div>
	            </div>
	        </div>
	    </div>
	    <div id="Js-content" class="BL-rel mui-content">
	        <div class="mui-content mui-scroll-wrapper">
	            <div class="mui-scroll">
	                <ul v-if="joblist&&joblist.length>0" class="mui-table-view form-list-cell" style="margin-top: 0rem !important;">
	                    <li class="fItem BL-ub BL-ub-f1" v-for="(item,key) in joblist">
	                        <a class="form-list-label BL-ub-f1">
	                            <div class="BL-ftz-48 BL-ellipsis BL-pad-r-2">
	                                {{ key + 1 }}.{{ item.name }}
	                                <div v-if="item.extend&&(item.extend.life_insurance!=''||item.extend.accident_insurance!=''||item.extend.medical_insurance!='')" class="BL-ftz-46 BL-ellipsis BL-pad-r-2">
	                                    风险等级：<span v-if="item.extend.life_insurance">寿险[{{item.extend.life_insurance}}]</span>&nbsp;&nbsp;&nbsp;<span v-if="item.extend.accident_insurance">意外[{{item.extend.accident_insurance}}]</span>&nbsp;&nbsp;&nbsp;<span v-if="item.extend.medical_insurance">医疗[{{item.extend.medical_insurance}}]</span>
	                                </div>
	                            </div>
	                        </a>
	                    </li>
	                </ul>
                    <div v-if="joblist&&joblist.length == 0" class="BL-pad-tb-1 BL-col-999 BL-txt-c BL-ftz-48">找不到您搜索的职业</div>
	            </div>
	        </div>
	    </div>
    </div>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/mui.pullToRefresh.js"></script>
<script src="js/mui.pullToRefresh.material.js"></script>
<script src="js/vue.min.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    var job = new Vue({
        el: '#Js-main',
        data: {
            name:'',
            supplier_id: '',
            joblist: null,
            keyword: "",    // 关键字
        },
        methods: {
            toblur:function(){
                document.activeElement.blur();
            },
            queryJob: function () {
                this.toblur();
                if (!this.keyword) {
                    mui.toast('关键词不能为空', {duration: 'short', type: 'div'});
                    return
                }
                // 模糊匹配品牌型号信息
                loadJobList()
            }
        }
    });
    (function($){
        //阻尼系数
        var deceleration = mui.os.ios ? 0.003 : 0.0009;
        $('#Js-content .mui-scroll-wrapper').scroll({
            scrollY: true, //是否竖向滚动
            scrollX: false, //是否横向滚动
            startX: 0, //初始化时滚动至x
            startY: 0, //初始化时滚动至y
            indicators: false, //是否显示滚动条
            deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
            bounce: true //是否启用回弹
        });

        $.plusReady(function() {
            // 设置内容区域
            statusbar();
            var winH = window.innerHeight;
            var titHeight = document.querySelector('#Js-header').offsetHeight;
            var divHeight = document.querySelector('#Js-search').offsetHeight;
            document.querySelector('#Js-content').style.height = (winH - titHeight - divHeight) +'px';
            job.name = plus.webview.currentWebview().name;
            job.supplier_id = plus.webview.currentWebview().supplier_id;
        });
    }(mui));
    //加载搜索列表
    var loadJobList = function () {
        luckyAjax({
            data: {
                server: 'PolicyIns.searchJob',
                data: JSON.stringify({
                    supplier_id: job.supplier_id,
                    name: job.keyword
                })
            },
            success:function(res){
                if (res.code == 1) {
                    job.joblist = res.data
                } else {
                    job.joblist = []
                }
            }
        });
    };
</script>
</html>
