<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <link href="css/mui.css" rel="stylesheet" />
        <link href="css/common.css" rel="stylesheet" />
        <link href="css/module.css" rel="stylesheet" />
        <script src="js/config.js" type="text/javascript"></script>
        <style>
            /* 列表——导航 */
            .BL-segmented-control.mui-scroll-wrapper{
                border-bottom: 1px solid #e7e7e7;
            }
            .BL-segmented-control.mui-scroll-wrapper, .BL-segmented-control.mui-scroll-wrapper .mui-scroll{
                height: 3.25rem;
            }
            .mui-fullscreen .mui-segmented-control ~ .mui-slider-group{
                top: 3.25rem !important;
            }
            .mui-slider .mui-segmented-control.mui-segmented-control-inverted ~ .mui-slider-group .mui-slider-item{
                border: 0 none !important;
            }
            .BL-segmented-control .mui-control-item {
                line-height: 0rem !important;
                padding: 0 1.25rem !important;
            }
            .BL-segmented-control .mui-control-item span{
                display: inline-block;
                line-height: 3.0625rem;
                padding: 0 .53125rem;
                border-bottom: 0.1875rem solid #ffffff !important;
            }
            .BL-segmented-control .mui-control-item.mui-active{
                border-bottom: 0 none !important;
            }
            .BL-segmented-control .mui-control-item.mui-active span{
                color: #3b9cf5 !important;
                border-bottom: 0.1875rem solid #3b9cf5 !important;
            }
            .mui-table-view-radio .mui-table-view-cell > a {
                padding: 1rem 1.25rem;
            }
            .mui-table-view-radio .mui-table-view-cell.mui-selected .mui-navigate-right:after {
                font-size: 3rem;
            }
        </style>
    </head>
    <body>
        <div id="Js-main">
            <header id="Js-header" class="BL-bg-fff">
                <div class="BL-mod-headbar BL-mod-headbar-pos">
                    <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
                    <h1 class="BL-title">职业分类表</h1>
                </div>
                <div id="Js-Filter" class="BL-mod-headbar BL-bg-fff">
                    <div class="BL-ub BL-ub-ac headbar-search">
                        <div class="BL-ub BL-ub-ac BL-ub-f1 mui-row" style="max-width: 10rem">
                            <div class="mui-col-xs-10 BL-ellipsis BL-ftz-48">
                                {{ company_item.txt }}
                            </div>
                            <div class="mui-col-xs-2" @click="show=true">
                                <span class="mui-icon mui-icon-arrowdown BL-ftz-2"></span>
                            </div>
                        </div>
                        <div class="search search-pro BL-ub BL-ub-ac BL-ub-pc BL-ub-f3 BL-col-999 BL-ftz-46">
                            <div class="button BL-noBorder-l">
                                <span class="BL-bimg-contain"></span>
                            </div>搜索职业
                        </div>
                    </div>
                </div>
            </header>

            <div id="Js-content" class="mui-content BL-rel">
                <div class="mui-slider mui-fullscreen">
                    <div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted BL-segmented-control">
                        <div class="mui-scroll" style="left: 0;right: 0" id="classify">
                            <a class="mui-control-item mui-active" href="#item_news1"><span>第一分类</span></a>
                            <a class="mui-control-item" href="#item_news2"><span>第二分类</span></a>
                            <a class="mui-control-item" href="#item_news3"><span>第三分类</span></a>
                        </div>
                    </div>
                    <div class="mui-slider-group" id="group"></div>
                </div>
            </div>
            <div class="BL-modal-bg" style="z-index: 10;" v-show="show">
                <div class="BL-modal BL-modal-w80" style="z-index: 10; border-radius: 0rem">
                    <p class="BL-ftz-52 BL-pad-tb-1 BL-pad-lr-1_25 BL-col-333 BL-Border-b">选择公司</p>
                    <ul v-if="company" class="mui-table-view mui-table-view-radio BL-overFlow-autoY" style="max-height: 30rem;">
                    	<li class="mui-table-view-cell BL-ftz-52" v-for="(item,index) in company" :class="{'mui-selected': item.id == company_item.id }">
                    		<a class="BL-pad-a1 mui-navigate-right" @click="setCompany(item),show = false">
                                {{ item.short_name != "" ? item.short_name : item.company_name }}
                            </a>
                    	</li>
                    </ul>
                </div>
            </div>
        </div>
    </body>
    <script src="js/mui.min.js" type="text/javascript"></script>
    <script src="js/interval-dtpicker.js" type="text/javascript"></script>
    <script src="js/mui.pullToRefresh.js"></script>
    <script src="js/mui.pullToRefresh.material.js"></script>
    <script src="js/vue.min.js"></script>
    <script type="text/javascript">
        mui.init();
        //相当于jq的append
        function append(parent, text) {
            if (typeof text === 'string') {
                var temp = document.createElement('div');
                temp.innerHTML = text;
                // 防止元素太多 进行提速
                var frag = document.createDocumentFragment();
                while (temp.firstChild) {
                    frag.appendChild(temp.firstChild);
                }
                parent.appendChild(frag);
            }
            else {
                parent.appendChild(text);
            }
        };
        mui.ready(function(){
            statusbar();
			var winH = window.innerHeight;
			var topHeight = document.querySelector('#Js-header').offsetHeight;
			document.getElementById('Js-content').style.height = (winH - topHeight) +'px';
			var job = new Vue({
				el: "#Js-main",
                data: {
                    company: null,
                    company_item: {
                        id: "",
                        txt: "请选择"
                    },
                    level:[],
                    show: false
                },
                methods: {
				    setCompany: function (item) {
                        getJobList(item)
                    }
                }
			})

			// 获取保险公司
            luckyAjax({
                data: {
                    server: 'PolicyIns.getDockedCompanyList',
                },
                success: function (res) {
                    if (res.code == 1) {
                        job.company = res.data
                        job.company_item = res.data[0]
                        getJobList(job.company_item)
                    }
                },
            });

			var getJobList = function (item) {
				job.company_item.id = item.id
				job.company_item.txt = item.short_name != ""? item.short_name : item.company_name
				for(var i = 0; i < item.job_level; i++) {
					job.level.push(i)
				}
                luckyAjax({
                    data: {
                        server: 'PolicyIns.getJobList',
                        data:JSON.stringify({
                            supplier_id: job.company_item.id
                        })
                    },
                    success: function (res) {
                        if(res.code == 1) {
                            var temp = ""
                            var divTemp = ""
                            if (job.level.length) {
                                mui.each(job.level, function (index, item) {
                                    if (index === 0) {
                                        temp += '<a class="mui-control-item mui-active" href="#item_news'+(index+1)+'"><span>第一分类</span></a>';
                                        divTemp += '<div class="news-list mui-slider-item mui-control-content mui-active" id="item_news'+(index+1)+'"><span>第一分类</span></div>'
                                    } else if(index === 1) {
                                        temp += '<a class="mui-control-item" href="#item_news'+(index+1)+'"><span>第二分类</span></a>'
                                        divTemp += '<div class="news-list mui-slider-item mui-control-content" id="item_news'+(index+1)+'"><span>第二分类</span></div>'
                                    } else if(index === 2) {
                                        temp += '<a class="mui-control-item" href="#item_news'+(index+1)+'"><span>第三分类</span></a>'
                                        divTemp += '<div class="news-list mui-slider-item mui-control-content" id="item_news'+(index+1)+'"><span>第三分类</span></div>'
                                    }
                                });
                                job.$nextTick(function () {
                                    append(document.getElementById("classify"), temp);
                                    append(document.getElementById("group"), divTemp);
                                    mui('.mui-slider').slider();
                                })
                            }
                        }
                    }
                });
            }
        });
    </script>
</html>