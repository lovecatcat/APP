<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/module.css" rel="stylesheet" />
		<script src="js/config.js" type="text/javascript"></script>
	</head>

	<body>
		<div id="modal" v-cloak>
			<!--在线投保(白豪)-->
			<div id="modal-list" class="BL-modal BL-modal-w90 BL-pad-lr-2 BL-pad-b-1 BL-ub BL-ub-ac" 
				:class="{'BL-hide': isHide !== 'modal-list'}" v-if="goIns">
				<div class="BL-modal-content BL-modal-plancontent">
					<div class="BL-modal-list" v-for="item in goIns_data" @click="goIns_sure(item.genre)">
						<i class="BL-modal-icon-2" v-if="item.istrue == true"></i>
						<i class="BL-modal-icon-3" v-else-if ="item.istrue == false"></i>
						<i class="BL-modal-icon-0" v-else></i>
						<span>{{item.name}}</span>
					</div>
				</div>
			</div>
			<!--列表(白豪)-->
			<div class="BL-modal BL-modal-w90 BL-pad-lr-2 BL-pad-b-1 BL-ub BL-ub-ac"
				:class="{'BL-hide': isHide !== 'modal-list'}" v-if="!goIns">
				<div class="BL-modal-content BL-modal-plancontent">
					<div class="BL-modal-list" v-for="item in goIns_data" @click="showStatement(item.genre)">
						<i class="BL-modal-icon-2" v-if="item.istrue == true"></i>
						<i class="BL-modal-icon-3" v-else-if ="item.istrue == false"></i>
						<i class="BL-modal-icon-0" v-else></i>
						<span>{{item.name}}</span>
					</div>
				</div>
			</div>
			<!-- 业绩表格(雨晴)-->
			<div id="modal-table-performance" class="BL-modal BL-modal-w100"  :class="{'BL-hide': isHide !== 'modal-table-performance'}" v-if="goIns_data && isHide == 'modal-table-performance'">
				<div class="BL-modal-content BL-modal-tab">
					<div class="BL-title">
						{{ goIns_data.rank_name }}
					</div> 
					<div class="BL-modal-tab-body">
						<table class="fixed-thead">
							<thead>
								<tr class="BL-col-3b9cf5">
									<th width="40%">
										<div>承保件数</div>
										<div>{{ goIns_data.count }}件</div>
									</th>
									<th width="40%">
										<div>承保标保</div>
										<div>{{ goIns_data.std_premium =="" ? 0 : goIns_data.std_premium }}元</div>
									</th>
									<th width="20%">出单件数</th>
								</tr>
							</thead>
						</table>
						<div class="BL-modal-tab-scroll">
							<table>
								<tbody>
									<template v-if="goIns_data.details">
										<tr v-for="(item,index) in goIns_data.details" :key="index">
											<td class="BL-txt-l" width="40%">{{ index+1 }}.{{ item.name }}</td>
											<td width="40%">标保 <span class="BL-col-3b9cf5">{{ item.std_premium }}</span>元</td>
											<td width="20%">{{ item.count }}件</td>
										</tr>
									</template>
									<template v-else>
										<tr>
											<td colspan="3" class="BL-col-999">暂无数据</td>
										</tr>
									</template>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<!-- 计划书表格(雨晴)-->
			<div id="modal-table-prospect" class="BL-modal BL-modal-w100"  :class="{'BL-hide': isHide !== 'modal-table-prospect'}" v-if="goIns_data && isHide == 'modal-table-prospect'">
				<div class="BL-modal-content BL-modal-tab">
					<div class="BL-title">
						{{ goIns_data.name }}
					</div>
					<div class="BL-modal-tab-body">
						<table class="fixed-thead">
							<thead>
								<tr class="BL-col-3b9cf5">
									<th width="40%">
										<div>险种</div>
									</th>
									<th width="20%">
										<div>保额(元)</div>
									</th>
									<th width="20%">
										<div>保费(元)</div>
									</th>
									<th width="20%">投保人</th>
								</tr>
							</thead>
						</table>
						<div class="BL-modal-tab-scroll">
							<table>
								<tbody>
									<template v-if="goIns_data.detail">
										<tr v-for="(item,index) in goIns_data.detail">
											<td class="BL-txt-l" width="40%">{{ index+1 }}.{{ item.product_name }}</td>
											<td width="20%">{{ item.base_money }}</td>
											<td width="20%">{{ item.fee }}</td>
											<td width="20%">{{ item.applicant }}</td>
										</tr>
									</template>
									<template v-else>
										<tr>
											<td colspan="4" class="BL-col-999">暂无数据</td>
										</tr>
									</template>
								</tbody>
							</table>
						</div>
					</div>
						
				</div>
			</div>
			<!-- 底部文字-->
			<div id="modal-bottom" class="BL-modal-bottom"  :class="{'BL-hide': isHide !== 'modal-bottom'}">
				<div class="BL-modal-content ">
					<div class="BL-modal-list">
						<i class="BL-modal-icon-0"></i>
						<span>工银安盛新丰盈</span>
					</div>
					<div class="BL-modal-list">
						<i class="BL-modal-icon-1"></i>
						<span>工银安盛新丰盈</span>
					</div>
				</div>
			</div>
			<!-- 确认删除提示 -->
			<div id="modal-config" class="BL-modal BL-modal-w70"  :class="{'BL-hide': isHide !== 'modal-config'}">
				<div class="BL-modal-content">
					<div class="BL-txt-c BL-pad-tb-1_5">确认删除 ?</div>
					<div class="BL-modal-content-button">
						<button type="button" @click="cancel">取消</button>
						<button type="button" @click="sure">确认</button>
					</div>
				</div>
			</div>
			<div id="modal-plan" class="BL-modal BL-modal-w70"  :class="{'BL-hide': isHide !== 'modal-plan'}">
				<div class="BL-modal-content">
					<div class="BL-txt-c BL-pad-tb-1_5">是否添加方案</div>
					<div class="BL-modal-content-button">
						<button type="button" @click="cancel('pushPlan')">不添加</button>
						<button type="button" @click="sure('addPlan')">添加</button>
					</div>
				</div>
			</div>
			<div id="modal-rank" class="BL-modal BL-modal-w80" :class="{'BL-hide': isHide !== 'modal-rank'}">
				<div class="BL-modal-content">
					<div class="BL-txt-c BL-pad-tb-1_5 BL-rel">
						排行榜说明
						<span class="mui-icon mui-icon-clear BL-modal-close"></span>
					</div>
					<div class="BL-pad-lr-1_5 BL-pad-b-2">
						<p class="BL-ftz-46">1、业务数据以核心业务系统和当期承保数据为准；</p>
						<p class="BL-ftz-46">2、若新增有效人数相同，所赠新人达成的标准保费高者优先排名；</p>
						<p class="BL-ftz-46">3、本排行榜最终解释权归汇盟运营中心。</p>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="js/vue.min.js" ></script>
	<script type="text/javascript">
		var popu;
		mui.init();
		var modal = new Vue({
			el: '#modal',
			data: {
				isHide: '' , //要弹哪个框
				formID: '', //来自哪个页面
				goIns: false, //是不是在线投保
				gonIns_genre: [272, 276, 340, 348, 370, 16217, 264], //目前只有恒大才能去在线投保
				goIns_data: ''
			},
			methods: {
				sure: function(addPlan){
					//点击确定，吧状态传回去
					if(addPlan == 'addPlan'){
						if(this.formID == 'prospect'){
							mui.fire(plus.webview.getWebviewById('prospect'), 'addPlan');
						}else if(this.formID == 'prospect_product'){
							mui.fire(plus.webview.getWebviewById('prospect_product'), 'addPlan');
						}
					}else{
						if(this.formID == 'member_plans_manage'){
							mui.fire(plus.webview.getWebviewById('member_plans_manage'), 'sure');
						}else if(this.formID == 'member_plans_total'){
							mui.fire(plus.webview.getWebviewById('member_plans_total'), 'sure');
						}else if(this.formID == 'member_plans_alone'){
							mui.fire(plus.webview.getWebviewById('member_plans_alone'), 'sure');
						}else if(this.formID == 'prospect'){
							mui.fire(plus.webview.getWebviewById('prospect'), 'sure', {data: modal.goIns_data});
						}else if(this.formID == 'prospect_product'){
							mui.fire(plus.webview.getWebviewById('prospect_product'), 'sure', {data: modal.goIns_data});
						}
					}

					popu.closepop();
				},
				cancel: function(addPlan){
					if(addPlan == 'pushPlan'){
						if(this.formID == 'prospect'){
							mui.fire(plus.webview.getWebviewById('prospect'), 'pushPlan');
						}else if(this.formID == 'prospect_product'){
							mui.fire(plus.webview.getWebviewById('prospect_product'), 'pushPlan');
						}
						popu.closepop();
					}else{
						popu.closepop();
					}

				},
				goIns_sure: function(genre){
					if(modal.gonIns_genre.indexOf(genre) > -1 && genre == 264){
						mui.openWindow({
							id: 'pa_insurance-index',
							url: 'paehis/pa-healthinfo.html',
							show: animateObj.aniDetal
						})
					}else if(modal.gonIns_genre.indexOf(genre) > -1){
						mui.openWindow({
							id: 'hd_insurance-index',
							url: 'hd_ins/insurance-index.html',
							show: animateObj.aniDetal
						})
					}else{
						mui.toast('该公司在线投保暂未开通！')
					}
				},
				showStatement: function(genre){
					var statement = ''
						luckyAjax({
							data: {
								server: 'Proposal.getProductInfo',
								device: 'mobile',
								view: false,
								data: JSON.stringify({
									code: '',
									id: genre
									
								})
							},
							success: function(res) {
								if(res.code == 1) {
//									aloneDetail.sub_treasury_id = res.data.child_id
//									popu.closepop();
									var url = res.data.statement
//									alert(url)
									console.log(JSON.stringify(res.data))
									if (url) {
									    mui.openWindow({
							                url: 'pdf-modal.html',
							                id: 'pdf_modal',
							                show: animateObj.aniDetal,
							                extras: {
								    			pdf:config.domain +  url,
								    			name:res.data.product_name
								    		},
								    		waiting:{
								    			auto:false,
								    		}
							            });
									    
									} else {
									    mui.toast('暂无条款详情', {duration: 'short', type: 'div'})
									    return false;
									}
								} else {
									mui.toast('加载失败')
								}
							}
						});
				}
			}
		})
		
		mui.plusReady(function() {
			popu = new ClosePopu();
			// 实例化关闭窗口对象
			var data = plus.webview.currentWebview().data;
			modal.isHide = data.modalID
			modal.formID = data.formID
			modal.goIns = data.goIns
			modal.goIns_data = data.goIns_data
//			alert(JSON.stringify(modal.goIns_data))
			
			// 点击关闭遮罩层，弹框
			mui('body').on('tap', '#maskInit', function(){
				// 关闭遮罩层，弹框
				popu.closepop();
			},false);
			
			mui('body').on('tap', '#close-ins-pop', function () {
	            // 关闭遮罩层，弹框
	            popu.closepop();
	        });
	        mui('body').on('tap', '.BL-modal-close', function () {
	            // 关闭遮罩层，弹框
	            popu.closepop();
	        });
	        
	        plus.key.addEventListener("backbutton",function(){
				popu.closepop();
			});
		});
	</script>

</html>