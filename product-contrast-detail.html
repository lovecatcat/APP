<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>产品对比详情</title>
    <link href="css/mui.css" rel="stylesheet"/>
    <link href="css/common.css" rel="stylesheet"/>
    <link href="css/module.css" rel="stylesheet"/>
    <link href="css/product.css" rel="stylesheet"/>
    <script src="js/config.js" type="text/javascript"></script>
</head>

<body class="BL-bg-f2f">
<header id="Js-header" class="BL-bg-fff">
    <div class="BL-mod-headbar BL-mod-headbar-pos">
        <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
        <h1 class="BL-title">产品对比详情</h1>
        <a class="BL-icon BL-icon-share"></a>
    </div>
</header>

<div id="Js-content" class="mui-content product">

    <!------------对比详情 begin------------->
    <div class="BL-ub BL-ub-f1 product-contrast">

        <div id="left_div" style="width: 28%;">
            <div id="left_div1" style="width: 100%;padding-bottom: 1rem;">
                <table id="left_table1" class="table table-bordered" style="background-color: #ebf5fe;">
                    <tr>
                        <th>
                            <div class="BL-ub BL-ub-ac BL-ub-pc BL-ub-ver">
                                <div class="contr-visible">
                                    隐藏相同
                                </div>
                            </div>
                        </th>
                    </tr>
                </table>
            </div>
            <div id="left_div2" style="width: 100%;overflow: hidden;background-color: #ebf5fe;">
                <table id="left_table2" class="table table-bordered">
                    <tr v-for="(item,index) in title">
                        <th class='contr-th-title'>{{item}}啊</th>
                    </tr>
                </table>
            </div>
        </div>

        <div id="right_div" style="width: 72%;">
            <div id="right_div1" style="width: 100%;overflow: hidden;padding-bottom: 1rem;">
                <div id="right_divx" style="background-color: #ffffff;">
                    <table id="right_table1" class="table table-bordered">
                        <tr>
                            <th v-for="(item,index) in goods_list">
                                <div class="contr-item">
                                    <!--<div class="close"></div>-->
                                    <div class="img">
                                        <img :src="item.desc" @error="item.desc='images/pic/p6.jpg'"/>
                                    </div>
                                    <div class="content">
                                        <div class="tit">
                                            {{name_list[index].desc}}
                                        </div>
                                        <div class="name">
                                            {{item.content}}
                                        </div>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="right_div2"
                 style="width: 100%;overflow: auto;background-color: #ffffff;-webkit-overflow-scrolling : auto !important;">
                <table id="right_table2" class="table table-bordered">
                    <tr v-for="(item,index) in content">
                        <td class="contr-th-text" v-for="(ite,ind) in item" v-html="ite.content"></td>
                    </tr>
                </table>
            </div>
        </div>

    </div>
    <!-----------对比详情  end ------------->

</div>

<!------------悬浮控制按钮 begin-------------->
<div class="popuer">
    <a data-wid="" href="javascript:;" class="popu-IconMenu"><img src="images/product/menu-prospect.png" alt="计划书"/></a>
</div>
<!------------悬浮控制按钮 end --------------->
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/vue.min.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    var detail = new Vue({
        el: '#Js-content',
        data: {
            goods_list: '',
            name_list: '',
            checkedGoods: '',
            title: '',
            content: ''
        },
        methods: {
            aaa: function () {
                this.$nextTick(function () {
                    second();
                })
            }
        }
    });

    function second() {
        var winH = window.innerHeight;
        var titHeight = document.querySelector('#Js-header').offsetHeight + 225;
//        alert('1:' + titHeight)
        setTimeout(function () {
            mui('#left_div tr').each(function (i, el) {
                var $tr = mui('#right_div tr')[i];
                var tr_Height = $tr.offsetHeight;
                if (this.offsetHeight > tr_Height) {
                    $tr.style.height = this.offsetHeight + 'px';
                } else {
                    this.style.height = tr_Height + 'px';
                }
            });
        }, 500)
        var left_div1_h = document.querySelector('#left_div1').offsetHeight;
        var content_h = winH - titHeight - left_div1_h;
//        alert('left_div1_h:' + left_div1_h + 'winH:' + winH + 'content_h:' + content_h)
        document.querySelector('#left_div2').style.height = content_h + 'px';
        document.querySelector('#right_div2').style.height = content_h + 'px';
    }

    mui.plusReady(function () {
        statusbar();
        var goods_id = plus.webview.currentWebview().goods_id
        detail.checkedGoods = goods_id
        getData(goods_id)

        function init() {
            var str = goods_id.split(",")
            var right_div1_halfW = document.querySelector('#right_div').offsetWidth / 2;
            document.querySelector('#right_divx').style.width = right_div1_halfW * str.length + 'px';
            document.querySelector('#right_table2').style.width = right_div1_halfW * str.length + 'px';

            //固定和滚动
            var right_div2 = document.getElementById("right_div2");
            right_div2.onscroll = function () {
                var right_div2_top = this.scrollTop;
                var right_div2_left = this.scrollLeft;
                document.getElementById("left_div2").scrollTop = right_div2_top;
                document.getElementById("right_div1").scrollLeft = right_div2_left;
            }
        }

        //
        function getData(e) {
            plus.nativeUI.showWaiting();
            mui.ajax('http://www.luckyins.com/api/api/invoke', {
                data: {
                    device: 'pad',
                    server: 'lifeProduct.compare',
                    data: JSON.stringify({product_id: e})
                },
                dataType: 'json',//服务器返回json格式数据
                type: 'post',//HTTP请求类型
                timeout: 10000,//超时时间设置为10秒；
                headers: {'Content-Type': 'application/json'},
                success: function (data) {
                    plus.nativeUI.closeWaiting();
                    console.log(JSON.stringify(data))
                    if (data.code) {
                        var data = data.data
                        var title = []
                        var content = []
                        mui.each(data, function (index, item) {
                            if (item.title === '公司名称') {
                                detail.goods_list = item.list
                            } else if (item.title === '产品名称') {
                                detail.name_list = item.list
                            } else {
                                title.push(item.title)
                                content.push(item.list)
                            }
                        });
                        detail.title = title
                        detail.content = content
                        init()
                        detail.aaa()
                    } else {
                        mui.toast(data.msg, {duration: 'short', type: 'div'});
                        return false;
                    }
                }, error: function (xhr, type, errorThrown) {
                    mui.toast(errorThrown, {duration: 'short', type: 'div'});
                    return false
                }
            });
        }

    })
</script>

</html>