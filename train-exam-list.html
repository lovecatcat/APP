<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="css/mui.css" rel="stylesheet"/>
    <link href="css/common.css" rel="stylesheet"/>
    <link href="css/module.css" rel="stylesheet"/>
    <link href="css/news.css" rel="stylesheet"/>
    <script src="js/config.js" type="text/javascript"></script>
</head>

<body class="BL-bg-f2f">
	<header id="Js-header" class="BL-bg-fff">
	    <div class="BL-mod-headbar BL-mod-headbar-pos">
	        <a class="mui-action-back mui-icon-left-nav BL-icon BL-icon-left"></a>
            <h1 class="BL-title">晋升之路<span id="grade_name"></span></h1>
	        <div class="control" id="exam">
	            <a>考试</a>
	        </div>
	    </div>
	</header>
    <div id="Js-content" class="mui-content BL-rel">
		<div class="mui-content mui-scroll-wrapper BL-bg-fff">
			<div class="mui-scroll">
                <ul class="mui-table-view train-list-cell">
                    <li class="nItem BL-mar-tb-1_5" v-for="(item,index) in list">
                        <a class="BL-ub BL-ub-f1" :data-type="item.media_type" :data-id="item.id">
                            <div class="img">
                                <img :src="item.img | setImg"/>
                            </div>
                            <div class="context BL-ub BL-ub-ver BL-ub-f1">
                                <h1 class="tit">
                                    <span class="tit-badg" v-if="item.media_type == 1" :class="{'tit-badg-tv': item.media_type == 1}">视频</span>
                                    <span class="tit-badg" v-if="item.media_type == 2" :class="{'tit-badg-ad': item.media_type == 2}">音频</span>
                                    {{ item.title }}
                                </h1>
                                <div class="remarks BL-ub BL-ub-ac">
                                    <i class="ico-remarks" :class="{'ico-picture': item.media_type == 0,'ico-tv': item.media_type == 1,'ico-ad': item.media_type == 2}"></i>
                                    <span>{{ item.play_count }}</span>
                                    <span>{{ item.create_time | setTime }}</span>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
       </div>
	</div>
</body>
<script src="js/mui.min.js" type="text/javascript"></script>
<script src="js/mui.pullToRefresh.js"></script>
<script src="js/mui.pullToRefresh.material.js"></script>
<script src="js/vue.min.js" type="text/javascript"></script>
<script src="js/Date.js" type="text/javascript"></script>
<script type="text/javascript">
	mui.init();
	var exam = new Vue({
		el: '#Js-content',
		data: {
			list: [],
            page: 0,
			row: 10
		}
	});
    //Vue过滤器
    Vue.filter('setTime', function(timestamp) {
    	var time = new Date(timestamp*1000)   // 时间戳转成日期
        var timeFormat = time.Format('yyyy-MM-dd')
        return timeFormat
    });

    Vue.filter('setImg', function(val) {
        return config.domain + val
    });

    
	(function($){
		//阻尼系数
		var deceleration = mui.os.ios ? 0.003 : 0.0009;
		$('#Js-content .mui-scroll-wrapper').scroll({
			bounce: true,
			indicators: false, //是否显示滚动条
			deceleration: deceleration
		});
		$.plusReady(function() {
            statusbar();
            var winH = window.innerHeight;
            var titHeight = document.querySelector('#Js-header').offsetHeight;
            document.querySelector('#Js-content').style.height = winH - titHeight + 'px';
            var self;
            //接收首页传来的考试阶数
            var grade = plus.webview.currentWebview().grade;
            var name = plus.webview.currentWebview().name;
            document.querySelector('#grade_name').innerHTML = '('+ name + ')'

			//循环初始化和上拉加载。
			/**
		     * 获取考试课程列表
		     */
		    var getExamList = function (e) {
				exam.page++
				luckyAjax({
					data: {
			            server: 'videoLearn.examMaterials',
			            data: JSON.stringify({
                            grade: grade,
			            	page: exam.page,
			            	row: exam.row
						}),
			        },
			        success: function (res) {
                        console.log(JSON.stringify(res))
                        if(res.code == 1) {
                            if (exam.page >= res.data.page) {
                                self.endPullUpToRefresh(true);
                            } else {
                                self.endPullUpToRefresh(false);
                            }
                            if (e) {
                                exam.list = res.data.list;
                            } else {
                                var list = res.data.list;
                                mui.each(list, function (index, item) {
                                    exam.list.push(item);
                                });
                            }
                        } else {
                            mui.toast(res.msg, {duration: 'long', type: 'div'})
                        }
					},
				});
			};
		    
		    $('#Js-content .mui-scroll').pullToRefresh({
				up: { // 上拉加载更多
					auto: true, // 自动上拉一次
					contentrefresh: '正在加载...',
    				contentnomore:'没有更多数据了',// 可选，请求完毕若没有更多数据时显示的提醒内容；
					callback: function() {
						self = this
                        getExamList()
					}
				}
			});

            // 去考试
            document.querySelector('#exam').addEventListener('click', function () {
                // 通知事件
                mui.openWindow({
                    id:'train_exam',
                    url: 'train-exam.html',
                    show: animateObj.aniDetal,
                    extras:{
                        name: name,
                        grade: grade
                    }
                });
            });

		    // 跳转课程详情页
			mui('.mui-table-view').on('tap', 'a', function(e) {
				var href = '', id = '';
		        var type = this.getAttribute("data-type");
		        var wid = this.getAttribute("data-id");

                if (type == 0) {
                    href = 'train-article.html'
                    id = 'train_article'
                } else if (type == 1) {
                    href = 'train-video.html'
                    id = 'train_video'
                } else if (type == 2) {
                    href = 'train-audio.html'
                    id = 'train_audio'
                }
		        //打开新窗口
		        mui.openWindow({
		            url: href,
		            id: id,
		            show: animateObj.aniDetal,
		            extras:{
                        wid: wid   // 课程详情ID
					}
		        });
			});
		});	
	}(mui));
</script>
</html>