<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <script src="../js/browser.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
</head>

<body>

<div id="Js-content" class="mui-content BL-rel">
    <!--弹窗 begin-->
    <div class="ins-dialog lg">
        <div class="dialog-header">
            <div class="mui-icon mui-icon-closeempty" id="close-ins-pop"></div>
            <p class="ins-font-md box-f-1">健康告知信息</p>
            <div class="header-btn-save">
                <button class="ins-btn sm-btn blue" id="saveHealthinfo">保存</button>
            </div>
        </div>
        <div class="form-content margin-t-6_125 BL-pad-b-2">
            <div class="form-wrap">
                <!--投保人-->
                <div class="table-wrap" v-if="showAppl&&matters" v-cloak>
                    <div class="item">
                        <ul class="flex table-title">
                            <li class="flex-1" style="line-height:3.125rem;">投保人健康告知</li>
                            <li class="item-operate" @tap="appfolder=!appfolder"><span class="bene-up-icon mui-icon mui-icon-arrowup" :class="{'bene-up-icon-rotate':appfolder}"></span></li>
                        </ul>
                    </div>
                    <div v-for="(item,index) in matters" v-if="isShow(index,1)" v-show="!appfolder">
                        <ul class="flex">
                            <li class="flex-1" v-html="index+1+'.'+item.content"></li>
                            <li class="item-operate BL-mar-t-1" v-if="['1049'].indexOf(item.entry)===-1">
                                <button class="ins-btn sm-btn BL-mar-b_5" :class="{'blue':clientvalue.app_amswer[item.id]}" :disabled="clientvalue.app_amswer[item.id]" @tap="appChange(item.id,true),toblur()">是</button>
                                <button class="ins-btn sm-btn" :class="{'blue':!clientvalue.app_amswer[item.id]}" :disabled="!clientvalue.app_amswer[item.id]" @tap="appChange(item.id,false),toblur()">否</button>
                            </li>
                        </ul>
                        <template v-if="appforms[item.id] && (clientvalue.app_amswer[item.id]||item.entry==1049)">
                            <app-form :forms="appforms[item.id]"></app-form>
                        </template>
                    </div>
                </div>
                <!--投保人-->
                <!--被保人-->
                <div class="table-wrap" v-if="matters" v-cloak>
                    <div class="item">
                        <ul class="flex table-title">
                            <li class="flex-1" style="line-height:3.125rem;">被保人健康告知</li>
                            <li class="item-operate" @tap="assfolder=!assfolder"><span class="bene-up-icon mui-icon mui-icon-arrowup" :class="{'bene-up-icon-rotate':assfolder}"></span></li>
                        </ul>
                    </div>
                    <div v-for="(item,index) in matters" v-if="isShow(index,2)" v-show="!assfolder">
                        <ul class="flex">
                            <li class="flex-1" v-html="index+1+'.'+item.content"></li>
                            <li class="item-operate BL-mar-t-1" v-if="['1049'].indexOf(item.entry)===-1">
                                <button class="ins-btn sm-btn BL-mar-b_5" :class="{'blue':clientvalue.ass_amswer[item.id]}" :disabled="clientvalue.ass_amswer[item.id]" @tap="assChange(item.id,true),toblur()">是</button>
                                <button class="ins-btn sm-btn" :class="{'blue':!clientvalue.ass_amswer[item.id]}" :disabled="!clientvalue.ass_amswer[item.id]" @tap="assChange(item.id,false),toblur()">否</button>
                            </li>
                        </ul>
                        <template v-if="assforms[item.id] && (clientvalue.ass_amswer[item.id]||item.entry==1049)">
                            <app-form :forms="assforms[item.id]"></app-form>
                        </template>
                    </div>
                </div>
                <!--被保人-->
                <div class="mui-input-row mui-checkbox mui-left">
                    <label>1. 本人承诺上述内容与客户告知事实一致，并无虚假和重大遗漏。<br>2. 本人愿意承担因不实告知带来的所有责任</label>
                    <input name="checkbox" value="Item 1" type="checkbox" v-model="promise">
                </div>
            </div>
        </div>
    </div>
    <!--弹窗 end-->

</div>
</body>
<script src="../js/mui.min.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script src="method.js"></script>
<script type="text/babel">
    mui.init();
    const assforms = {
        '198': [{
            id: 199,
            title: '每日吸烟量(支/天)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }, {
            id: 200,
            title: '吸烟年限(年)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }],
        '201': [{
            id: 202,
            title: '戒烟时间',
            type: 'date',
            value: ''
        }, {
            id: 203,
            title: '戒烟原因',
            type: 'text',
            value: ''
        }],
        '204': [{
            id: 205,
            title: '每周饮酒量(两/周)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }, {
            id: 206,
            title: '饮酒年限(年)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }],
        '207': [{
            id: 208,
            title: '停止饮酒时间',
            type: 'date',
            value: ''
        }, {
            id: 209,
            title: '停止饮酒原因',
            type: 'text',
            value: ''
        }],
        '210': [{
            type: 'textarea',
            value: ''
        }],
        '211': [{
            type: 'textarea',
            value: ''
        }],
        '212': [{
            type: 'textarea',
            value: ''
        }],
        '213': [{
            type: 'textarea',
            value: ''
        }],
        '214': [{
            type: 'textarea',
            value: ''
        }],
        '215': [{
            type: 'textarea',
            value: ''
        }],
        '216': [{
            type: 'textarea',
            value: ''
        }],
        '217': [{
            type: 'textarea',
            value: ''
        }],
        '218': [{
            type: 'textarea',
            value: ''
        }],
        '219': [{
            type: 'textarea',
            value: ''
        }],
        '220': [{
            type: 'textarea',
            value: ''
        }],
        '221': [{
            type: 'textarea',
            value: ''
        }],
        '222': [{
            type: 'textarea',
            value: ''
        }],
        '223': [{
            type: 'textarea',
            value: ''
        }],
        '225': [{
            id: 226,
            title: '检查原因',
            type: 'text',
            value: ''
        }, {
            id: 227,
            title: '检查结果',
            type: 'text',
            value: ''
        }],
        '228': [{
            id: 229,
            title: '智能障碍等级',
            type: 'text',
            value: ''
        }],
        '230': [{
            type: 'textarea',
            value: ''
        }],
        '235': [{
            id: 236,
            title: '怀孕周数',
            type: 'text',
            value: ''
        }],
        '237': [{
            type: 'textarea',
            value: ''
        }],
        '238': [{
            type: 'textarea',
            value: ''
        }],
        '239': [{
            id: 240,
            title: '患病对象',
            type: 'text',
            value: ''
        }, {
            id: 241,
            title: '所患疾病名称',
            type: 'text',
            value: ''
        }, {
            id: 242,
            title: '患病时年龄(周岁)',
            type: 'number',
            value: ''
        }, {
            id: 243,
            title: '生存情况(健在或者身故)',
            type: 'text',
            value: ''
        }, {
            id: 244,
            title: '身故时年龄(周岁)',
            type: 'number',
            value: ''
        }],
        '245': [{
            id: 246,
            title: 'A. 出生体重',
            type: 'number',
            msg: '请输入正确的出生体重，保留2位小数',
            reg: /^\d+$/,
            value: ''
        }],
        '247': [{
            type: 'textarea',
            value: ''
        }],
        '248': [{
            type: 'textarea',
            value: ''
        }],
        '249': [{
            id: 250,
            title: '参加的项目',
            type: 'text',
            value: ''
        }, {
            id: 251,
            title: '参加的次数',
            type: 'number',
            value: ''
        }],
        '252': [{
            id: 253,
            title: '驾照类型',
            type: 'text',
            value: ''
        }],
        '254': [{
            id: 255,
            title: '次数',
            type: 'number',
            value: ''
        }, {
            id: 256,
            title: '时间',
            type: 'date',
            value: ''
        }, {
            id: 257,
            title: '违章类型',
            type: 'text',
            value: ''
        }],
        '258': [{
            id: 259,
            title: '居住的国家或地区',
            type: 'text',
            value: ''
        }, {
            id: 260,
            title: '居住时间',
            type: 'text',
            value: ''
        }],
        '261': [{
            id: 262,
            title: '计划去的国家或地区',
            type: 'text',
            value: ''
        }, {
            id: 263,
            title: '目的',
            type: 'text',
            value: ''
        }, {
            id: 264,
            title: '居住时间(月)',
            type: 'text',
            value: ''
        }],
        '265': [{
            id: 266,
            title: '投保险种',
            type: 'text',
            value: ''
        }, {
            id: 267,
            title: '保险金额',
            type: 'text',
            value: ''
        }, {
            id: 268,
            title: '承保公司',
            type: 'text',
            value: ''
        }, {
            id: 269,
            title: '日期',
            type: 'date',
            value: ''
        }],
        '270': [{
            type: 'textarea',
            value: ''
        }]
    };
    const appforms = {
        '198': [{
            id: 199,
            title: '每日吸烟量(支/天)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }, {
            id: 200,
            title: '吸烟年限(年)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }],
        '201': [{
            id: 202,
            title: '戒烟时间',
            type: 'date',
            value: ''
        }, {
            id: 203,
            title: '戒烟原因',
            type: 'text',
            value: ''
        }],
        '204': [{
            id: 205,
            title: '每周饮酒量(两/周)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }, {
            id: 206,
            title: '饮酒年限(年)',
            type: 'number',
            msg: '请输入整数',
            reg: /^\d+$/,
            value: ''
        }],
        '207': [{
            id: 208,
            title: '停止饮酒时间',
            type: 'date',
            value: ''
        }, {
            id: 209,
            title: '停止饮酒原因',
            type: 'text',
            value: ''
        }],
        '210': [{
            type: 'textarea',
            value: ''
        }],
        '211': [{
            type: 'textarea',
            value: ''
        }],
        '212': [{
            type: 'textarea',
            value: ''
        }],
        '213': [{
            type: 'textarea',
            value: ''
        }],
        '214': [{
            type: 'textarea',
            value: ''
        }],
        '215': [{
            type: 'textarea',
            value: ''
        }],
        '216': [{
            type: 'textarea',
            value: ''
        }],
        '217': [{
            type: 'textarea',
            value: ''
        }],
        '218': [{
            type: 'textarea',
            value: ''
        }],
        '219': [{
            type: 'textarea',
            value: ''
        }],
        '220': [{
            type: 'textarea',
            value: ''
        }],
        '221': [{
            type: 'textarea',
            value: ''
        }],
        '222': [{
            type: 'textarea',
            value: ''
        }],
        '223': [{
            type: 'textarea',
            value: ''
        }],
        '225': [{
            id: 226,
            title: '检查原因',
            type: 'text',
            value: ''
        }, {
            id: 227,
            title: '检查结果',
            type: 'text',
            value: ''
        }],
        '228': [{
            id: 229,
            title: '智能障碍等级',
            type: 'text',
            value: ''
        }],
        '230': [{
            type: 'textarea',
            value: ''
        }],
        '235': [{
            id: 236,
            title: '怀孕周数',
            type: 'text',
            value: ''
        }],
        '237': [{
            type: 'textarea',
            value: ''
        }],
        '238': [{
            type: 'textarea',
            value: ''
        }],
        '239': [{
            id: 240,
            title: '患病对象',
            type: 'text',
            value: ''
        }, {
            id: 241,
            title: '所患疾病名称',
            type: 'text',
            value: ''
        }, {
            id: 242,
            title: '患病时年龄(周岁)',
            type: 'number',
            value: ''
        }, {
            id: 243,
            title: '生存情况(健在或者身故)',
            type: 'text',
            value: ''
        }, {
            id: 244,
            title: '身故时年龄(周岁)',
            type: 'number',
            value: ''
        }],
        '245': [{
            id: 246,
            title: 'A. 出生体重',
            type: 'number',
            msg: '请输入正确的出生体重，保留2位小数',
            reg: /^\d+$/,
            value: ''
        }],
        '247': [{
            type: 'textarea',
            value: ''
        }],
        '248': [{
            type: 'textarea',
            value: ''
        }],
        '249': [{
            id: 250,
            title: '参加的项目',
            type: 'text',
            value: ''
        }, {
            id: 251,
            title: '参加的次数',
            type: 'number',
            value: ''
        }],
        '252': [{
            id: 253,
            title: '驾照类型',
            type: 'text',
            value: ''
        }],
        '254': [{
            id: 255,
            title: '次数',
            type: 'number',
            value: ''
        }, {
            id: 256,
            title: '时间',
            type: 'date',
            value: ''
        }, {
            id: 257,
            title: '违章类型',
            type: 'text',
            value: ''
        }],
        '258': [{
            id: 259,
            title: '居住的国家或地区',
            type: 'text',
            value: ''
        }, {
            id: 260,
            title: '居住时间',
            type: 'text',
            value: ''
        }],
        '261': [{
            id: 262,
            title: '计划去的国家或地区',
            type: 'text',
            value: ''
        }, {
            id: 263,
            title: '目的',
            type: 'text',
            value: ''
        }, {
            id: 264,
            title: '居住时间(月)',
            type: 'text',
            value: ''
        }],
        '265': [{
            id: 266,
            title: '投保险种',
            type: 'text',
            value: ''
        }, {
            id: 267,
            title: '保险金额',
            type: 'text',
            value: ''
        }, {
            id: 268,
            title: '承保公司',
            type: 'text',
            value: ''
        }, {
            id: 269,
            title: '日期',
            type: 'date',
            value: ''
        }],
        '270': [{
            type: 'textarea',
            value: ''
        }]
    };

    var health = new Vue({
        el: '#Js-content',
        components: {
            'app-form': {
                template: `
		      	<li class="border-l-r">
		      		<div v-for="(item,index) in forms">
	                    <div class="input-item" v-if="item.type=='number'">
	                        <label class="">{{item.title}}</label>
	                        <div class="input-wrap box-f-1">
	                            <input type="number" v-model="item.value" placeholder="请输入" @change="$parent.change(item,true)">
	                        </div>
	                    </div>
	                    <div class="input-item box-f-1 box-align-center" v-else-if="item.type=='radio'">
		                    <div class="box-f-2 ins-font-sm">{{item.title}}</div>
		                    <div class="box-f-1">
		                        <div class="mui-switch mui-switch-mini" @click="item.value=!item.value,$parent.change(item,true)">
		                            <div class="mui-switch-handle"></div>
		                        </div>
		                    </div>
		                </div>
	                    <div class="input-item" v-else-if="item.type=='text'">
	                        <label class="">{{item.title}}</label>
	                        <div class="input-wrap box-f-1">
	                            <input type="text" v-model="item.value" placeholder="请输入" @change="$parent.change(item,true)">
	                        </div>
	                    </div>
	                    <div class="input-item" v-else-if="item.type=='date'">
                            <label class="">{{item.title}}</label>
                            <div class="input-wrap box-f-1">
                                <input type="date" v-model="item.value" placeholder="请选择" @change="$parent.change(item,true)">
                            </div>
                        </div>
                        <div class="input-item" v-else-if="item.type=='select'">
                        	<label class="">{{item.title}}</label>
                        	<div class="input-wrap box-f-1">
                                <select class="input" v-model="item.value" @change="$parent.change(item,true)">
                                  <option disabled value="">请选择</option>
                                  <option :value="ind" v-for="(ite,ind) in item.options" :key="ind">{{ite}}</option>
                                </select>
                            </div>
                        </div>
                    	<textarea name="" placeholder="请说明" v-else-if="item.type=='textarea'" v-model="item.value" @change="$parent.change(item,true)"></textarea>
                    </div>
                </li>
		      `,
                props: {
                    forms: Array,
                    index: String
                }
            }
        },
        data: function() {
            return {
                appfolder: false,
                assfolder: false,
                isAssuWm: false, //被保人是否为女性
                isApplWm: false, //投保人是否为女性
                matters: {},
                promise: false,
                showAppl: false,
                assuAge: '',//被保人年龄
                assforms,
                appforms,
                clientvalue: {
                    ass_amswer: {}, //被保险人勾选
                    fields: {}, //被保人用户字段
                    app_amswer: {}, //投保人勾选
                    app_fields: {} //投保人填写字段
                }
            }
        },
        methods:{
            toblur:function(){
                document.activeElement.blur();
            },
            change:function(item, auto) {
                console.log('change')
                var ret = {
                    status: true,
                    msg: ''
                }
                var msg = ''
                if (item.reg && item.msg && !item.reg.test(item.value)) { // 正则
                    ret = { status: false, msg: item.msg }
                } else if ((item.type === 'number') && !/^\d+\.?\d*$/.test(item.value)) {
                    msg = item.msg || '请输入正确的数字'
                    ret = { status: false, msg }
                } else if (item.type === 'text' && !item.value) {
                    msg = item.msg || '请输入' + item.title
                    ret = { status: false, msg }
                } else if (item.type === 'date' && !/^[1-2][0-9][0-9][0-9]-[0-1]{0,1}[0-9]-[0-3]{0,1}[0-9]$/.test(item.value)) {
                    msg = '请输入日期，形如 1999-12-31'
                    ret = { status: false, msg }
                } else if (item.type === 'textarea' && !item.value) {
                    msg = '请完成说明'
                    ret = { status: false, msg }
                } else if (item.type === 'select' && !item.value) {
                    msg = '请完成选择'
                    ret = { status: false, msg }
                }
                if (auto) {
                    if (msg) {
                        console.log('aaaaa')
                        mui.toast(msg, {duration: 'short', type: 'div'});
                        return false
                    }
                } else {
                    return ret
                }
            },
            isShow:function(i, type) {
                if (i === 36 || i === 35) {
                    return false
                }
                if ([21, 22, 23].indexOf(i) > -1 && type === 1 && !this.isApplWm) {
                    return false
                }
                if ([21, 22, 23].indexOf(i) > -1 && type === 2 && !this.isAssuWm) {
                    return false
                }
                if ([25, 26, 27].indexOf(i) > -1 && (type === 1 || ([25, 26, 27].indexOf(i) > -1 && type === 2 && this.assuAge > 2))) {
                    return false
                }
                return true
            },
            assChange:function(id,state){
                this.clientvalue.ass_amswer[id] = state;
                if(assforms[id]){
                    for (var i in assforms[id]) {
                        if(assforms[id][i]['id']){
                            this.clientvalue.ass_amswer[assforms[id][i]['id']] = state;
                        }
                    }
                }
                this.$forceUpdate();
            },
            appChange:function(id,state){
                this.clientvalue.app_amswer[id] = state;
                if(appforms[id]){
                    for (var i in appforms[id]) {
                        if(appforms[id][i]['id']){
                            this.clientvalue.app_amswer[appforms[id][i]['id']] = state;
                        }
                    }
                }
                this.$forceUpdate();
            },
            getIndex:function(id, chief) {
                for (var i in this.matters) {
                    var item = this.matters[i]
                    if (item.id === id && !chief) {
                        return Number(i) + 1
                    }
//                    if (item.id === chief) {
//                        for (var j = 0; j < item.child.length; j++) {
//                            if (item.child[j].id === id) {
//                                return i + item.child[j].entry
//                            }
//                        }
//                    }
                }
                return -1
            },
            checkForm:function() {
                var toast_text = null
                var input = null
                var title = ''
                var msg = ''

                console.log(JSON.stringify(this.clientvalue.ass_amswer))
                for (var i in this.clientvalue.ass_amswer) {
                    if (this.clientvalue.ass_amswer[i]) {
                        var item = this.assforms[i]
                        if (item && item.length) {
                            for (var k = 0; k <= item.length - 1; k++) {
                                input = item[k]
                                title = input.title ? input.title : ''
                                var who = this.showAppl ? '被保人' : ''
                                msg = '问题'+ this.getIndex(Number(i), Number(input.chief)) + who + ', '
                                if (input.must !== false || input.value) {
                                    var ret = this.change(input)
                                    if (!ret.status) {
                                        toast_text = msg + ret.msg
                                        console.log(toast_text)
                                        break
                                    }
                                }
                                if (item.length>1) {
                                    this.clientvalue.fields[input.id] = input.value
                                } else {
                                    if (input.id) {
                                        this.clientvalue.fields[input.id] = input.value
                                    } else {
                                        this.clientvalue.fields[i] = input.value
                                    }
                                }
                            }
//                            this.clientvalue.fields[i] = val.reverse().join('|')
                        }
                    } else {
                        this.clientvalue.fields[i] = ''
                    }
                }
                if (this.showAppl) {
                    for (var j in this.clientvalue.app_amswer) {
                        if (this.clientvalue.app_amswer[j]) {
                            var jitem = this.appforms[j]
                            if (jitem && jitem.length) {
                                for (var l = 0; l <= jitem.length - 1; l++) {
                                    input = jitem[l]
                                    title = input.title ? input.title : ''
                                    msg = '投保人问题 ' + this.getIndex(Number(j), Number(input.chief)) +', '

                                    if (input.must !== false || input.value) {
                                        var jret = this.change(input)
                                        if (!jret.status) {
                                            toast_text = msg + jret.msg
                                            break
                                        }
                                    }
                                    if (jitem.length>1) {
                                        this.clientvalue.app_fields[input.id] = input.value
                                    } else {
                                        if (input.id) {
                                            this.clientvalue.app_fields[input.id] = input.value
                                        } else {
                                            this.clientvalue.app_fields[i] = input.value
                                        }
                                    }
                                }
//                                this.clientvalue.app_fields[j] = jval.reverse().join('|')
                            }
                        } else {
                            this.clientvalue.app_fields[j] = ''
                        }
                    }
                }
                if (toast_text) {
                    mui.toast(toast_text, {duration: 'short', type: 'div'});
                    console.log(toast_text)
                    return false
                }
                //2周岁及以下
                if (this.assuAge <= 2) {
                    if (!this.assforms['245'][0].value) {
                        mui.toast('请填写被保人 26 题', {duration: 'short', type: 'div'});
                        return false
                    } else {
                        this.clientvalue.fields[245] = Number(this.assforms['245'][0].value).toFixed(2)
                    }
                }
                this.$forceUpdate()
                if (!this.promise) {
                    mui.toast('请阅读用户承诺并确认', {duration: 'short', type: 'div'});
                    return false
                }
                return true
            }
        }
    });
    mui.plusReady(function () {
        var popu = new ClosePopu(); // 实例化关闭窗口对象
        //安卓监听返回事件
        plus.key.addEventListener("backbutton",function(){
            popu.closepop();
        });
        //
        var safegoods = plus.storage.getItem('zhaos_safegoods') ? JSON.parse(plus.storage.getItem('zhaos_safegoods')) : '';
        var applicant = plus.storage.getItem('zhaos_applicant') ? JSON.parse(plus.storage.getItem('zhaos_applicant')) : '';
        var assured = plus.storage.getItem('zhaos_assured') ? JSON.parse(plus.storage.getItem('zhaos_assured')) : '';

        if (safegoods) {
            mui.each(safegoods, function (index, item) {
                if ([tbrhmds, tbrhmzj].indexOf(item.safe_id) > -1) {
                    health.showAppl = true
                    health.appfolder = false
                }
            })
        }

        //赋值
        console.log(plus.storage.getItem('zhaos_healthinfo'));
        var hinfo = plus.storage.getItem('zhaos_healthinfo') ? JSON.parse(plus.storage.getItem('zhaos_healthinfo')) : ''
        hinfo && setHealth(hinfo)

        function setHealth(data) {
            var arr = {}
            mui.each(data, function (index, item) {
                arr[item.mv_id] = item
            })
            mui.each(data, function (index, item) {
                var aitem = assforms[item.mv_id]
                if (item.insured_answer === '1') {
                    health.clientvalue.ass_amswer[item.mv_id] = true
                    console.log(item.mv_id +';'+item.insured_fields)
                    if (aitem && aitem.length === 1) {
                        if (aitem[0]['id']) {
                            aitem[0]['value'] = arr[aitem[0]['id']].insured_fields
                        } else {
                            console.log(item.mv_id )
                            aitem[0]['value'] = item.insured_fields
                        }
                    } else if (aitem && aitem.length > 1) {
                        for (var i in aitem) {
                            aitem[i]['value'] = arr[aitem[i]['id']].insured_fields
                        }
                    }
                }
                if (health.showAppl && item.holder_answer === '1') {
                    health.clientvalue.app_amswer[item.mv_id] = true
                    if (aitem && aitem.length === 1) {
                        aitem[0]['value'] = item.holder_fields
                        if(aitem[0]['id']){
                            aitem[0]['value'] = health.clientvalue.holder_fields[aitem[0]['id']]
                        }
                    } else if (aitem && aitem.length > 1) {
                        for (var i in aitem) {
                            aitem[i]['value'] = health.clientvalue.holder_fields[aitem[i]['id']]
                        }
                    }
                }
            })
            console.log(JSON.stringify(arr))
        }
        //

        health.assuAge = getAge(assured.insured_birthday)
        health.isApplWm = applicant.holder_gender === FEMALE ? true : false
        health.isAssuWm = assured.insured_gender === FEMALE ? true : false
        //保存
        document.querySelector('#saveHealthinfo').addEventListener('tap', function () {
            if (!health.checkForm()) {
                return false
            }
            console.log(JSON.stringify(health.clientvalue))
            //
            var appitems = []
            mui.each(health.matters, function (index, item) {
                var insured_answer = health.clientvalue.ass_amswer[item.id] ? '1' : '0'
                var holder_answer = health.clientvalue.app_amswer[item.id] ? '1' : '0'
                if (item.id === 245 && health.assuAge <= 2){
                    insured_answer = '1'
                }
                var insured_fields = health.clientvalue.fields[item.id]?health.clientvalue.fields[item.id]:''
                var holder_fields = health.clientvalue.app_fields[item.id]?health.clientvalue.app_fields[item.id]:''
                //社保
                if (item.id === 271) {
                    holder_answer = applicant.holder_has_SSID ? '1' : '0'
                    insured_answer = assured.insured_has_SSID ? '1' : '0'
                    holder_fields = ''
                    insured_fields = ''
                }
                //个人税收居民身份声明
                if (item.id === 272) {
                    holder_answer ='1'
                    insured_answer = '1'
                    holder_fields = TAXTYPE
                    insured_fields = TAXTYPE
                }
                //168: 2岁及以下
                //164: 女性补充告知
                if ((item.id === 245 && health.assuAge <= 2) || (item.id === 235 && ((health.showAppl && health.isApplWm) || health.isAssuWm)) || (item.id !== 245 && item.id !== 235)) {
                    appitems.push({
                        mv_id: item.id,
                        insured_answer: insured_answer,
                        holder_answer: holder_answer,
                        insured_fields: insured_fields,
                        holder_fields: holder_fields
                    })
                    //子题目
                    item.child && mui.each(item.child, function (key, value) {
                        appitems.push({
                            mv_id: value.id,
                            insured_answer: health.clientvalue.ass_amswer[value.id] ? '1' : '0',
                            holder_answer: health.clientvalue.app_amswer[value.id] ? '1' : '0',
                            insured_fields: health.clientvalue.fields[value.id] ? health.clientvalue.fields[value.id] : '',
                            holder_fields: health.clientvalue.app_fields[value.id] ? health.clientvalue.app_fields[value.id] : ''
                        })
                    })
                }
            })
            plus.storage.setItem('zhaos_healthinfo', JSON.stringify(appitems));
            mui.fire(plus.webview.getWebviewById('zs_insurance-index'), 'saveFlag', {
                item: 'zhaos_healthinfo',
                data: 'healthinfo'
            });
            popu.closepop();
            mui.back();
        })
        //
        mui('body').on('tap', '#close-ins-pop', function () {
            // 关闭遮罩层，弹框
            popu.closepop();
        });
        health.$nextTick(function () {
            plus.nativeUI.closeWaiting();
        })
        //获取健康告知题目
        luckyAjax({
            data: {data: JSON.stringify({'supplier_id': SCID, 'version': '1'}), server: 'PolicyIns.getMatterList'},
            success: function (res) {
                if (res.code) {
                    health.matters = res.data;
                } else {

                }
            }
        });
    });
</script>
</html>
