<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link href="../css/mui.css" rel="stylesheet"/>
    <link href="../css/common.css" rel="stylesheet"/>
    <link href="../css/module.css" rel="stylesheet"/>
    <link href="../css/form.css" rel="stylesheet"/>
    <link href="../css/insurance.css" rel="stylesheet"/>
    <script src="../js/config.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css"/>
    <link href="../css/signature.css" rel="stylesheet"/>
</head>

<body>

<div id="Js-content" class="mui-content BL-rel" v-cloak="">
    <!--弹窗 begin-->
    <div class="ins-dialog lg">
        <div class="dialog-header">
            <div class="mui-icon mui-icon-closeempty" id="close-ins-pop"></div>
            <p class="ins-font-md box-f-1">信息确认</p>
            <div class="header-btn-save" v-show="ispass">
                <button class="ins-btn sm-btn blue" id="saveSign">确认扣款</button>
            </div>
            <div class="header-btn-save" v-show="!ispass">
                <button class="ins-btn sm-btn blue" id="closepass">完成</button>
            </div>
        </div>
        <div class="form-content margin-t-6_125 BL-pad-b-1">
            <div class="form-wrap" v-if="orderinfo">
                <div class="BL-bg-fff BL-mar-t-1">
                    <ul class="mui-table-view">
                        <li class="mui-table-view-cell mui-collapse">
                            <a class="mui-navigate-right info-collapse" href="#">投保人信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_type_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_ID_expire_end=='9999-12-31'?'长期有效':orderinfo.insData.holder_ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">身高(cm)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_height}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">体重(kg)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_weight}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">职业</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_job_code_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年收入(万元)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_salary_avg}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">工作单位</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_company}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">投保地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_province_text}}{{orderinfo.insData.holder_home_city_text}}{{orderinfo.insData.holder_home_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_home_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_province_text}}{{orderinfo.insData.holder_contact_city_text}}{{orderinfo.insData.holder_contact_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_contact_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">手机号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_mobile}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">电子邮箱</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_email}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是否有社保</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.holder_has_SSID == has_social_security?'是':'否'}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell mui-collapse" v-if="orderinfo.insured.rel_insured_holder != ISASSURED">
                            <a class="mui-navigate-right info-collapse" href="#">被保人信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是投保人的</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.rel_holder_insured_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{typename[orderinfo.insured.insured_ID_type]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_ID_expire_end=='9999-12-31'?'长期有效':orderinfo.insured.insured_ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">身高(cm)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_height}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">体重(kgs)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_weight}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">职业</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_job_code_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年收入(万元)</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_salary_avg}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">工作单位</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_company}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">投保地区</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_province_text}}{{orderinfo.insured.insured_home_city_text}}{{orderinfo.insured.insured_home_district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">邮编</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_home_zip}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">手机号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_mobile}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">电子邮箱</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_email}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是否有社保</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insured.insured_has_SSID == has_social_security?'是':'否'}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell" v-else><a class="mui-navigate-right info-collapse" href="#">被保人：<span class="BL-col-333">本人</span></a></li>
                        <li class="mui-table-view-cell mui-collapse" v-if="!orderinfo.insData.is_legal_benefic">
                            <a class="mui-navigate-right info-collapse" href="#">受益人信息</a>
                            <div class="mui-collapse-content" >
                                <div class="form-wrap margin-t_875" v-for="(item,index) in orderinfo.beneficList">
                                    <div class="ins-font-xs BL-pad-lr-1 BL-col-333" v-show="index>0">第{{index+1}}个受益人</div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">是被保人的</label>
                                        <div class="flex-2 ins-font-sm">{{benerelname[item.beneficiary_is_insured]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">姓名</label>
                                        <div class="flex-2 ins-font-sm">{{item.fullname}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件类型</label>
                                        <div class="flex-2 ins-font-sm">{{typename[item.ID_type]}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件号码</label>
                                        <div class="flex-2 ins-font-sm">{{item.ID_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">证件有效期</label>
                                        <div class="flex-2 ins-font-sm">{{item.ID_expire_end=='9999-12-31'?'长期有效':item.ID_expire_end}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">性别</label>
                                        <div class="flex-2 ins-font-sm">{{item.gender == MALE?'男':'女'}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">出生日期</label>
                                        <div class="flex-2 ins-font-sm">{{item.birthday}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">受益顺序</label>
                                        <div class="flex-2 ins-font-sm">{{item.sort_order}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">受益比例(%)</label>
                                        <div class="flex-2 ins-font-sm">{{item.rate}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">通讯地区</label>
                                        <div class="flex-2 ins-font-sm">{{item.province_text + ' ' + item.city_text + ' ' + item.district_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{item.address}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">详细地址</label>
                                        <div class="flex-2 ins-font-sm">{{item.zip}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell" v-else><a class="mui-navigate-right info-collapse" href="#">受益人：<span class="BL-col-333">法定</span></a></li>
                        <li class="mui-table-view-cell mui-collapse" v-if="orderinfo.contentList">
                            <a class="mui-navigate-right info-collapse" href="#">险种信息</a>
                            <div class="mui-collapse-content" >
                                <div class="form-wrap">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm">合计保费(元)</label>
                                        <div class="flex-2 ins-font-sm BL-col-ff8201">{{orderinfo.insData.total}}</div>
                                    </div>
                                </div>
                                <div class="form-wrap margin-t_875" v-for="(item,index) in orderinfo.contentList">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">险种名称</label>
                                        <div class="flex-2 ins-font-sm">{{item.product_name}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">交费期间</label>
                                        <div class="flex-2 ins-font-sm">{{item.period_payment | payYearFilter}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">保障期间</label>
                                        <div class="flex-2 ins-font-sm">{{item.period_guanantee | safeYearFilter}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">保险金额(元)</label>
                                        <div class="flex-2 ins-font-sm">{{item.amount}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">年缴保费(元)</label>
                                        <div class="flex-2 ins-font-sm BL-col-ff8201">{{item.fee}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li class="mui-table-view-cell mui-collapse">
                            <a class="mui-navigate-right info-collapse" href="#">付款信息</a>
                            <div class="mui-collapse-content">
                                <div class="form-wrap margin-t_875">
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">银行卡号</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_no}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">账户类型</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_type_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">开户城市</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_province_text}}{{orderinfo.insData.bank_area_text}}</div>
                                    </div>
                                    <div class="flex-n BL-pad-a1">
                                        <label class="flex-1 ins-font-sm BL-col-999">开户行</label>
                                        <div class="flex-2 ins-font-sm">{{orderinfo.insData.bank_name_text}}</div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-wrap">
                <div class="input-item">
                    <label class="BL-col-999">签名提示</label>
                    <div class="BL-ub BL-ub-pj BL-ub-f1">
                        <div class="input-wrap BL-ub-f1">
                        </div>
                        <button class="right-btn orange" @click="getSignature(true)" v-show="!signflag">查看签名状态</button>
                        <button class="right-btn orange" v-show="signflag">签名已完成</button>
                    </div>
                </div>
                <div class="BL-pad-a1">
                    <p class="BL-ftz-46 BL-col-333"><i class="mui-icon mui-icon-info"></i>分享签名链接操作提示：</p>
                    <div class="BL-ftz-46 BL-pad-l-2_5">
                        1. 点击下方按钮，复制链接<br>
                        2. 切换到微信或QQ，选择好友并粘贴发送<br>
                        3. 待客户（投被保人）完成签名后，请在下方点击获取手机验证码<br>
                    </div>
                    <div class="BL-ub BL-ub-ac BL-ub-pc BL-pad-t-1">
                        <button class="form-btn ins-btn sm-btn btn-copy" :data-url="appSignAddress">复制投保人签名链接
                        </button>
                    </div>
                    <div class="BL-ub BL-ub-ac BL-ub-pc BL-pad-t-1" v-if="assured.rel_holder_insured!==ISASSURED">
                        <button class="form-btn ins-btn sm-btn btn-copy" :data-url="insuredSignAddress">复制被保人签名链接
                        </button>
                    </div>
                </div>
            </div>
            <div v-show="ispass">
                <div class="form-wrap margin-t_875">
                    <div class="border-b-e7e7e7">
                        <div class="item-title">信息确认</div>
                    </div>
                    <div class="BL-pad-a1">
                        <div class="mui-input-row mui-checkbox mui-left BL-mar-t-1">
                            <label style="padding-left: 3rem;line-height: 2rem;">本人已阅读
                                <a class="BL-col-3b9cf5" type="button" disabled @tap="showStatement(item.safe_id,item.name)" v-for="(item,index) in safegoods" v-show="item.name"><strong>《{{item.name}}条款》</strong></a>
                                、和<a type="button" id="safenotice"
                                    class="BL-col-3b9cf5"><strong>《客户声明与授权》</strong></a>、<a type="button" id="statement"
                                    class="BL-col-3b9cf5"><strong>《自动转账授权说明》</strong></a>、<a type="button" @tap="showNotice"
                                                                                             class="BL-col-3b9cf5"><strong>《投保提示书》</strong></a>，并确认上述信息无误
                                <input name="checkbox" v-model="agree" type="checkbox" style="top: 10px; left: 0px;">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-wrap margin-t_875">
                    <div class="border-b-e7e7e7">
                        <div class="item-title">身份验证</div>
                    </div>
                    <div class="input-item">
                        <label class="">验证码</label>
                        <div class="BL-ub BL-ub-pj BL-ub-f1">
                            <div class="input-wrap BL-ub-f1">
                                <input type="number" v-model="smscode">
                            </div>
                            <button class="right-btn orange" @click="getSignature(false)" :disabled="disabled">{{text}}</button>
                        </div>
                    </div>
                </div>
            </div>
            <div v-show="!ispass" class="form-wrap">
                <div class="input-item ins-font-xs BL-col-ff8201">您本次申请需要进行人工核保，完成电子签名后，公司会继续处理您的投保申请。</div>
            </div>

        </div>
    </div>
</div>
<!--弹窗 end-->

</body>
<script src="../js/mui.min.js" type="text/javascript"></script>
<script src="../js/vue.min.js" type="text/javascript"></script>
<script src="../js/copy.js" type="text/javascript"></script>
<script src="../js/pdf.js" type="text/javascript"></script>
<script src="method.js" type="text/javascript"></script>
<script type="text/javascript">
    mui.init();
    var popu;
    mui('body').on('tap', '#statement', function () {
        mui.openWindow({
            url: 'pay-statement.html',
            id: 'pay_statement',
            show: animateObj.aniDetal
        })
        return false
    })
    mui('body').on('tap', '#safenotice', function () {
        mui.openWindow({
            url: 'safe-notice.html',
            id: 'safe_notice',
            show: animateObj.aniDetal
        })
        return false
    })
    
    var img = new Vue({
        el: '#Js-content',
        data:function() {
            return {
            	isfa: false,
                safegoods: '',
                agree: false,
                pdfurl: '',
                main_insurance: '',
                war_id: '',
                appSignAddress: '', //投保人签名链接
                insuredSignAddress: '',//被保人签名链接
                signflag: false, //签名状态
                ispass: false, //是否自核通过
                smscode: '',
                assured: {},
                previewImg: [], //上传图片
                disabled: false,
                second: 60,
                time: 0,
                orderinfo: '' //保单详情
            }
        },
        //过滤器
        filters: {
            //保障期间
            safeYearFilter: function (value) {
                if (value > 50 && value !== '999' && value !== 999) {
                    return '至' + value + '周岁';
                } else if (value < 50 && value > 0) {
                    return value + '年';
                } else {
                    return '终身';
                }
            },
            //交费期间
            payYearFilter: function (value) {
                if (value === 1) {
                    return '趸交';
                } else if (value < 60) {
                    return value + '年交';
                } else {
                    return '至' + value + '周岁';
                }
            }
        },
        computed: {
            text: function () {
                return this.time > 0 ? this.time + 's后可重新获取' : '点击获取'
            }
        },
        methods: {
            getOrderinfo: function () {
                var vm = this
                luckyAjax({
                    data: {
                        data: JSON.stringify({policy_id: this.war_id}),
                        server: 'PolicyIns.edit',
                        device: 'mobile'
                    },
                    success: function (res) {
                        if (res.code) {
                            vm.orderinfo = res.data
                        } else {
                            mui.toast(res.msg, {duration: 'short', type: 'div'});
                            return false;
                        }
                    }
                });
            },
    	    //投保提示书
        	showNotice: function () {
				mui.openWindow({
	                url: '../pdf-modal.html',
	                id: 'pdf_modal',
	                show: animateObj.aniDetal,
	                extras: {
		    			pdf: config.domain + '/static/file/zstbtss.pdf',
		    			name:'投保提示书'
		    		},
		    		waiting:{
		    			auto:false,
		    		}
	            });
        	},
            //险种条款
            showStatement: function (id, name) {
                luckyAjax({
                    data: {
                        data: JSON.stringify({product_id: id}),
                        server: 'lifeProduct.getProductInfo'
                    },
                    success: function (data) {
                        plus.nativeUI.closeWaiting();
                        if (data.code === 1) {
                            if (data.data.statement) {
                                mui.openWindow({
                                    url: '../pdf-modal.html',
                                    id: 'pdf_modal',
                                    show: animateObj.aniDetal,
                                    extras: {
                                        pdf: data.data.statement,
                                        name: name
                                    },
                                    waiting: {
                                        auto: false,
                                    }
                                });
                            } else {
                                mui.toast('暂无条款详情', {duration: 'short', type: 'div'});
                                return false;
                            }
                        }
                    }
                })
            },
            //07发送验证码
            sendsms: function () {
                luckyAjax({
                    data: {
                        data: JSON.stringify({
                            msg: {policy_id: img.war_id},
                            company_code: 'ZhaoShang',
                            method: 'sendSms'
                        }),
                        server: 'PolicyIns.onlineInsured',
                        device: 'mobile'
                    },
                    timeout: 30000,
                    success: function (res) {
                        if (res.data.flag === 'Y') {
                            mui.toast(res.msg, {duration: 'long', type: 'div'})
                            img.isfa = true
                            img.sended()
                        } else if (res.data.flag === 'N') {
                            mui.toast(res.data.message, {duration: 'long', type: 'div'})
                        } else if (res.code === 0) {
                            mui.toast(res.msg, {duration: 'long', type: 'div'})
                            return false
                        } else {
                            mui.toast(res.data && res.data.message ? res.data.message : '网络出错，请稍后再试', {
                                duration: 'long',
                                type: 'div'
                            })
                            return false
                        }
                    }
                });
            },
            run: function () {
                this.time = this.second
                this.timer()
            },
            sended: function () {
                this.run()
                this.disabled = true
            },
            timer: function () {
                if (this.time > 0) {
                    this.time--
                    setTimeout(function () {
                        img.timer()
                    }, 1000)
                } else {
                    this.disabled = false
                }
            },
            // 03查看签名状态
            getSignature: function (notosend) {
                luckyAjax({
                    data: {
                        data: JSON.stringify({
                            msg: {policy_id: img.war_id},
                            company_code: 'ZhaoShang',
                            method: 'sign'
                        }),
                        server: 'PolicyIns.onlineInsured',
                        device: 'mobile'
                    },
                    timeout: 30000,
                    success: function (res) {
                        if (res.data.flag === 'Y') {
                            if (res.data.isSignFinish === 'Y') {
                                img.signflag = true
                                if (notosend){
                                    mui.toast('签名已完成', {duration: 'long', type: 'div'})
                                } else {
                                	img.sendsms()
                                }
                            } else {
                                mui.toast(res.msg, {duration: 'long', type: 'div'})
                                return false
                            }
                        } else if (res.data.flag === 'N') {
                            mui.toast('接口调用失败', {duration: 'long', type: 'div'})
                            return false
                        } else {
                            mui.toast('网络出错，请稍后再试', {
                                duration: 'long',
                                type: 'div'
                            })
                            return false
                        }
                    }
                });
            },
        }
    })
    
    mui.plusReady(function () {
        popu = new ClosePopu(); // 实例化关闭窗口对象

        var signdata = plus.webview.currentWebview().data;
        var war_id = signdata ? signdata.id : '';
        img.appSignAddress = signdata ? signdata.appSignAddress : '';
        img.insuredSignAddress = signdata ? signdata.insuredSignAddress : '';
        img.ispass = signdata.ispass
        console.log(img.appSignAddress)
        console.log(img.insuredSignAddress)
        if (war_id) {
            img.war_id = war_id
        } else {
            mui.toast("保单不存在", {duration: 'long', type: 'div'})
            return false;
        }
        img.getOrderinfo();
        var itemName = ['zhaos_applicant','zhaos_assured','zhaos_beneficiary','zhaos_safegoods','zhaos_healthinfo','zhaos_bank','zhaos_upload','zhaos_ids'];
        var assured = plus.storage.getItem('zhaos_assured') ? JSON.parse(plus.storage.getItem('zhaos_assured')): ''
        var safegoods = plus.storage.getItem('zhaos_safegoods') ? JSON.parse(plus.storage.getItem('zhaos_safegoods')): ''
        console.log(JSON.stringify(safegoods))
        img.safegoods = safegoods
        img.assured = assured
        //安卓监听返回事件
        plus.key.addEventListener("backbutton",function(){
            popu.closepop();
            mui.fire(plus.webview.getWebviewById('zs_insurance-index'), 'resetLoading');
        });

        document.querySelector('#closepass').addEventListener('tap', function () {
            afterPay(true)
        })
        //保存
        document.querySelector('#saveSign').addEventListener('tap', function () {
            if (!img.agree) {
                mui.toast("请确认阅读相关条款声明并同意转账授权与声明", {duration: 'short', type: 'div'})
                return false;
            }
             if (!img.isfa) {
            	mui.toast("请先获取验证码", {duration: 'short', type: 'div'})
                return false
            }
            if (!img.smscode) {
                mui.toast("请填写验证码", {duration: 'short', type: 'div'})
                return false
            }
            checksms()
        })
        //
        mui('body').on('tap', '#close-ins-pop', function () {
            // 关闭遮罩层，弹框
            popu.closepop();
            mui.fire(plus.webview.getWebviewById('zs_insurance-index'), 'resetLoading');
        });

        mui('body').on('tap', '.btn-copy', function (e) {
            var copy_url = this.getAttribute('data-url')
            if (Clipbord(copy_url)) {
                mui.toast("复制成功", {duration: 'short', type: 'div'})
            }
        });
        //
        //承保接口调完后
        function afterPay(clear, e) {
            if (clear) {
                //清除本地缓存
                for (var i = 0; i < itemName.length; i++) {
                    plus.storage.removeItem(itemName[i])
                }
            }
            if (e) { //承保成功
                setTimeout(function () {
                    mui.openWindow({
                        url: '../member-warranty-manage.html',
                        id: 'member_warranty_manage',
                        show: animateObj.aniDetal
                    })
                    plus.webview.close('member_life_order');
                    setTimeout(function () {
                        plus.webview.close('zs-insurance-sign');
                        plus.webview.close('zs_insurance-index');
                    }, 400)
                }, 3000)
            } else {
                setTimeout(function () {
                    mui.openWindow({
                        url: '../member-life-order.html',
                        id: 'member_life_order',
                        show: animateObj.aniDetal
                    })
                    setTimeout(function () {
                        plus.webview.close('zs-insurance-sign');
                        plus.webview.close('zs_insurance-index');
                        mui.fire(plus.webview.getWebviewById('member_life_order'), 'reload');
                    }, 400)
                }, 3000)
            }
        }
        //06承保
        function ins_pay() {
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {policy_id: img.war_id},
                        company_code: 'ZhaoShang',
                        method: 'accept'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 10000,
                success: function (res) {
                    if (res.data.flag === 'Y') {
                        if (res.data.isIssue === 'Y') {
                            mui.toast('承保成功', {duration: 'long', type: 'div'});
                            afterPay(true, true)
                        } else {
                            mui.toast(res.data.issueNotPassReason, {duration: 'long', type: 'div'});
                            return false
                        }
                    } else if (res.data.flag === 'N') {
                        mui.toast(res.data.message, {duration: 'long', type: 'div'});
                        return false
                    } else if (res.code === 0) {
                        mui.toast(res.msg, {duration: 'long', type: 'div'})
                        return false
                    } else {
                        mui.toast('网络出错，请稍后再试', {duration: 'long', type: 'div'})
                        return false
                    }

                }
            });
        };
        //
        //05验证码验证
        function checksms() {
            luckyAjax({
                data: {
                    data: JSON.stringify({
                        msg: {policy_id: img.war_id, smsCode:img.smscode},
                        company_code: 'ZhaoShang',
                        method: 'validateSms'
                    }),
                    server: 'PolicyIns.onlineInsured',
                    device: 'mobile'
                },
                timeout: 30000,
                success: function (res) {
                    if (res.data.flag === 'Y') {
                    	if (res.data.state  == 'S0000' || res.data.state == '700001') {
                            ins_pay()
                    	} else {
                    		mui.toast(res.data.error, {duration: 'long', type: 'div'})
                            return false
                    	}
                    } else if (res.data.flag === 'N') {
                        mui.toast(res.data.message, {duration: 'long', type: 'div'})
                        return false
                    } else {
                        mui.toast('网络出错，请稍后再试', {
                            duration: 'long',
                            type: 'div'
                        })
                        return false
                    }
                }
            });
        }
        //
    });

    
</script>
</html>